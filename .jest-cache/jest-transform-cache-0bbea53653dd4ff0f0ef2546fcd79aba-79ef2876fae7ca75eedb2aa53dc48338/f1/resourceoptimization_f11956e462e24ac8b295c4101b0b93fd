bc33008f92522e0c68cc5385d0bd11ea
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createResourcePreloadConfig = exports.createImageOptimizationConfig = exports.useResourcePreload = exports.useImageOptimization = exports.ResourcePreloader = exports.OptimizedImage = exports.preloadResource = exports.preloadImage = exports.createBlurHash = exports.generateResponsiveImageUrls = exports.compressImage = exports.resourceCache = exports.imageCache = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
/**
 * @file 资源优化模块
 * @description 提供图片压缩、预加载和资源优化功能
 * @module performance/resource-optimization
 * @author YYC³
 * @version 1.0.0
 * @created 2026-02-19
 */
const react_1 = require("react");
class ResourceCacheManager {
    constructor(maxSize = 100, defaultTTL = 3600000) {
        this.cache = new Map();
        this.maxSize = maxSize;
        this.defaultTTL = defaultTTL;
    }
    get(key) {
        const entry = this.cache.get(key);
        if (!entry)
            return null;
        if (Date.now() > entry.expiry) {
            this.cache.delete(key);
            return null;
        }
        return entry.value;
    }
    set(key, value, ttl = this.defaultTTL) {
        if (this.cache.size >= this.maxSize) {
            const firstKey = this.cache.keys().next().value;
            if (firstKey)
                this.cache.delete(firstKey);
        }
        this.cache.set(key, {
            value,
            expiry: Date.now() + ttl,
        });
    }
    has(key) {
        return this.get(key) !== null;
    }
    delete(key) {
        this.cache.delete(key);
    }
    clear() {
        this.cache.clear();
    }
    size() {
        return this.cache.size;
    }
}
exports.imageCache = new ResourceCacheManager(50, 1800000);
exports.resourceCache = new ResourceCacheManager(100, 3600000);
const compressImage = async (file, config = {}) => {
    const { maxWidth = 1920, maxHeight = 1080, quality = 0.8, format = 'jpeg' } = config;
    return new Promise((resolve, reject) => {
        const img = new Image();
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        img.onload = () => {
            let { width, height } = img;
            if (width > maxWidth || height > maxHeight) {
                const ratio = Math.min(maxWidth / width, maxHeight / height);
                width *= ratio;
                height *= ratio;
            }
            canvas.width = width;
            canvas.height = height;
            ctx?.drawImage(img, 0, 0, width, height);
            canvas.toBlob((blob) => {
                if (blob) {
                    resolve(blob);
                }
                else {
                    reject(new Error('Failed to compress image'));
                }
            }, `image/${format}`, quality);
        };
        img.onerror = () => reject(new Error('Failed to load image'));
        img.src = URL.createObjectURL(file);
    });
};
exports.compressImage = compressImage;
const generateResponsiveImageUrls = (baseUrl, breakpoints = [320, 640, 768, 1024, 1200, 1920], format = 'webp') => {
    const url = new URL(baseUrl, window.location.origin);
    return breakpoints.map((width) => {
        const searchParams = new URLSearchParams(url.search);
        searchParams.set('w', width.toString());
        searchParams.set('f', format);
        return {
            src: `${url.origin}${url.pathname}?${searchParams.toString()}`,
            width,
            media: `(max-width: ${width}px)`,
        };
    });
};
exports.generateResponsiveImageUrls = generateResponsiveImageUrls;
const createBlurHash = async (image, size = 32) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    if (!ctx)
        return '';
    canvas.width = size;
    canvas.height = size;
    ctx.drawImage(image, 0, 0, size, size);
    const imageData = ctx.getImageData(0, 0, size, size);
    const data = imageData.data;
    let hash = '';
    for (let i = 0; i < data.length; i += 4) {
        const r = data[i];
        const g = data[i + 1];
        const b = data[i + 2];
        const a = data[i + 3];
        const value = (r << 24) | (g << 16) | (b << 8) | a;
        hash += value.toString(16).padStart(8, '0');
    }
    return hash.substring(0, 20);
};
exports.createBlurHash = createBlurHash;
const preloadImage = (src, config = {}) => {
    const { retryCount = 3, retryDelay = 1000, cacheEnabled = true } = config;
    if (cacheEnabled && exports.imageCache.has(src)) {
        return Promise.resolve({
            success: true,
            resource: src,
            duration: 0,
            cached: true,
        });
    }
    return new Promise((resolve) => {
        const startTime = performance.now();
        let attempts = 0;
        const attemptLoad = () => {
            const img = new Image();
            img.onload = () => {
                const duration = performance.now() - startTime;
                if (cacheEnabled) {
                    exports.imageCache.set(src, img);
                }
                resolve({
                    success: true,
                    resource: src,
                    duration,
                    cached: false,
                });
            };
            img.onerror = () => {
                attempts++;
                if (attempts < retryCount) {
                    setTimeout(attemptLoad, retryDelay);
                }
                else {
                    resolve({
                        success: false,
                        resource: src,
                        duration: performance.now() - startTime,
                        cached: false,
                    });
                }
            };
            img.src = src;
        };
        attemptLoad();
    });
};
exports.preloadImage = preloadImage;
const preloadResource = (url, type, config = {}) => {
    const { retryCount = 3, retryDelay = 1000, cacheEnabled = true } = config;
    if (cacheEnabled && exports.resourceCache.has(url)) {
        return Promise.resolve({
            success: true,
            resource: url,
            duration: 0,
            cached: true,
        });
    }
    return new Promise((resolve) => {
        const startTime = performance.now();
        let attempts = 0;
        const attemptLoad = () => {
            switch (type) {
                case 'image':
                    (0, exports.preloadImage)(url, config).then(resolve);
                    break;
                case 'script':
                case 'style':
                case 'font': {
                    const link = document.createElement('link');
                    link.rel = 'preload';
                    link.as = type === 'font' ? 'font' : type;
                    link.href = url;
                    if (type === 'font') {
                        link.crossOrigin = 'anonymous';
                    }
                    link.onload = () => {
                        const duration = performance.now() - startTime;
                        if (cacheEnabled) {
                            exports.resourceCache.set(url, true);
                        }
                        resolve({
                            success: true,
                            resource: url,
                            duration,
                            cached: false,
                        });
                    };
                    link.onerror = () => {
                        attempts++;
                        if (attempts < retryCount) {
                            setTimeout(attemptLoad, retryDelay);
                        }
                        else {
                            resolve({
                                success: false,
                                resource: url,
                                duration: performance.now() - startTime,
                                cached: false,
                            });
                        }
                    };
                    document.head.appendChild(link);
                    break;
                }
                case 'fetch':
                    fetch(url)
                        .then(() => {
                        const duration = performance.now() - startTime;
                        if (cacheEnabled) {
                            exports.resourceCache.set(url, true);
                        }
                        resolve({
                            success: true,
                            resource: url,
                            duration,
                            cached: false,
                        });
                    })
                        .catch(() => {
                        attempts++;
                        if (attempts < retryCount) {
                            setTimeout(attemptLoad, retryDelay);
                        }
                        else {
                            resolve({
                                success: false,
                                resource: url,
                                duration: performance.now() - startTime,
                                cached: false,
                            });
                        }
                    });
                    break;
                default:
                    resolve({
                        success: false,
                        resource: url,
                        duration: performance.now() - startTime,
                        cached: false,
                    });
            }
        };
        attemptLoad();
    });
};
exports.preloadResource = preloadResource;
const OptimizedImage = ({ src, alt, width, height, config = {}, className = '', loading = 'lazy', fetchPriority = 'auto', decoding = 'async', onLoad, onError, }) => {
    const [isLoaded, setIsLoaded] = (0, react_1.useState)(false);
    const [currentSrc, setCurrentSrc] = (0, react_1.useState)(src);
    const imgRef = (0, react_1.useRef)(null);
    const { enableLazyLoading = true, enableResponsiveImages = true, breakpoints = [320, 640, 768, 1024, 1200, 1920], enablePlaceholder = true, } = config;
    const responsiveUrls = (0, react_1.useMemo)(() => {
        if (enableResponsiveImages) {
            return (0, exports.generateResponsiveImageUrls)(src, breakpoints);
        }
        return [];
    }, [src, enableResponsiveImages, breakpoints]);
    const srcSet = (0, react_1.useMemo)(() => {
        if (responsiveUrls.length > 0) {
            return responsiveUrls.map((r) => `${r.src} ${r.width}w`).join(', ');
        }
        return '';
    }, [responsiveUrls]);
    const sizes = (0, react_1.useMemo)(() => {
        if (responsiveUrls.length > 0) {
            return responsiveUrls.map((r) => r.media).join(', ');
        }
        return '';
    }, [responsiveUrls]);
    const shouldLazyLoad = enableLazyLoading && loading === 'lazy' && 'IntersectionObserver' in window;
    (0, react_1.useEffect)(() => {
        if (!shouldLazyLoad) {
            return;
        }
        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    setCurrentSrc(src);
                    observer.disconnect();
                }
            });
        }, { rootMargin: '50px' });
        if (imgRef.current) {
            observer.observe(imgRef.current);
        }
        return () => observer.disconnect();
    }, [src, shouldLazyLoad]);
    const handleLoad = (0, react_1.useCallback)(() => {
        setIsLoaded(true);
        onLoad?.();
    }, [onLoad]);
    const handleError = (0, react_1.useCallback)(() => {
        onError?.();
    }, [onError]);
    return ((0, jsx_runtime_1.jsxs)("picture", { children: [responsiveUrls.length > 0 &&
                responsiveUrls.map((url, index) => ((0, jsx_runtime_1.jsx)("source", { srcSet: `${url.src} 1x, ${url.src} 2x`, media: url.media }, index))), (0, jsx_runtime_1.jsx)("img", { ref: imgRef, src: currentSrc, srcSet: srcSet, sizes: sizes, alt: alt, width: width, height: height, className: className, loading: loading, fetchPriority: fetchPriority, decoding: decoding, onLoad: handleLoad, onError: handleError, style: {
                    opacity: isLoaded ? 1 : 0,
                    transition: 'opacity 0.3s ease-in-out',
                } }), !isLoaded && enablePlaceholder && ((0, jsx_runtime_1.jsx)("div", { className: `image-placeholder ${className}`, style: {
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    width: '100%',
                    height: '100%',
                    backgroundColor: '#f0f0f0',
                    backgroundImage: `linear-gradient(90deg, #f0f0f0 0%, #e0e0e0 50%, #f0f0f0 100%)`,
                    backgroundSize: '200% 100%',
                    animation: 'skeleton-loading 1.5s infinite',
                } }))] }));
};
exports.OptimizedImage = OptimizedImage;
const ResourcePreloader = ({ resources, config = {}, onProgress, onComplete }) => {
    const [loaded, setLoaded] = (0, react_1.useState)(0);
    (0, react_1.useEffect)(() => {
        const preloadResources = async () => {
            const preloadPromises = resources.map((resource) => (0, exports.preloadResource)(resource.url, resource.type, config));
            const preloadResults = await Promise.all(preloadPromises);
            setLoaded(resources.length);
            onComplete?.(preloadResults);
        };
        preloadResources();
    }, [resources, config, onComplete]);
    (0, react_1.useEffect)(() => {
        onProgress?.(loaded, resources.length);
    }, [loaded, resources.length, onProgress]);
    return null;
};
exports.ResourcePreloader = ResourcePreloader;
const useImageOptimization = (config = {}) => {
    const compress = (0, react_1.useCallback)((file) => (0, exports.compressImage)(file, config), [config]);
    const preload = (0, react_1.useCallback)((src, preloadConfig) => (0, exports.preloadImage)(src, preloadConfig), []);
    const generateResponsive = (0, react_1.useCallback)((baseUrl) => (0, exports.generateResponsiveImageUrls)(baseUrl, config.breakpoints, config.format), [config.breakpoints, config.format]);
    return {
        compress,
        preload,
        generateResponsive,
        createBlurHash: exports.createBlurHash,
    };
};
exports.useImageOptimization = useImageOptimization;
const useResourcePreload = (config = {}) => {
    const [preloading, setPreloading] = (0, react_1.useState)(false);
    const [progress, setProgress] = (0, react_1.useState)(0);
    const [results, setResults] = (0, react_1.useState)([]);
    const preload = (0, react_1.useCallback)(async (resources) => {
        setPreloading(true);
        setProgress(0);
        const preloadPromises = resources.map((resource, index) => (0, exports.preloadResource)(resource.url, resource.type, config).then((result) => {
            setProgress((prev) => Math.max(prev, index + 1));
            return result;
        }));
        const results = await Promise.all(preloadPromises);
        setResults(results);
        setPreloading(false);
        return results;
    }, [config]);
    const clearCache = (0, react_1.useCallback)(() => {
        exports.imageCache.clear();
        exports.resourceCache.clear();
    }, []);
    return {
        preload,
        preloading,
        progress,
        results,
        clearCache,
    };
};
exports.useResourcePreload = useResourcePreload;
const createImageOptimizationConfig = (overrides) => ({
    maxWidth: 1920,
    maxHeight: 1080,
    quality: 0.8,
    format: 'jpeg',
    enableLazyLoading: true,
    enableResponsiveImages: true,
    breakpoints: [320, 640, 768, 1024, 1200, 1920],
    enablePlaceholder: true,
    placeholderSize: 10,
    enableBlurHash: false,
    enableProgressiveLoading: true,
    cacheEnabled: true,
    cacheTimeout: 1800000,
    ...overrides,
});
exports.createImageOptimizationConfig = createImageOptimizationConfig;
const createResourcePreloadConfig = (overrides) => ({
    maxPreloadCount: 10,
    preloadPriority: 'auto',
    preloadTimeout: 5000,
    retryCount: 3,
    retryDelay: 1000,
    cacheEnabled: true,
    ...overrides,
});
exports.createResourcePreloadConfig = createResourcePreloadConfig;
exports.default = {
    compressImage: exports.compressImage,
    generateResponsiveImageUrls: exports.generateResponsiveImageUrls,
    createBlurHash: exports.createBlurHash,
    preloadImage: exports.preloadImage,
    preloadResource: exports.preloadResource,
    OptimizedImage: exports.OptimizedImage,
    ResourcePreloader: exports.ResourcePreloader,
    useImageOptimization: exports.useImageOptimization,
    useResourcePreload: exports.useResourcePreload,
    createImageOptimizationConfig: exports.createImageOptimizationConfig,
    createResourcePreloadConfig: exports.createResourcePreloadConfig,
    imageCache: exports.imageCache,
    resourceCache: exports.resourceCache,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3lhbnl1L0Rvd25sb2Fkcy95eWMzLURlc2lnbi1TeXN0ZW0vc3JjL3BlcmZvcm1hbmNlL3Jlc291cmNlLW9wdGltaXphdGlvbi50c3giLCJtYXBwaW5ncyI6Ijs7OztBQUFBOzs7Ozs7O0dBT0c7QUFFSCxpQ0FBaUY7QUF5RGpGLE1BQU0sb0JBQW9CO0lBS3hCLFlBQVksVUFBa0IsR0FBRyxFQUFFLGFBQXFCLE9BQU87UUFDN0QsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO0lBQy9CLENBQUM7SUFFRCxHQUFHLENBQUMsR0FBVztRQUNiLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxLQUFLO1lBQUUsT0FBTyxJQUFJLENBQUM7UUFFeEIsSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQzlCLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZCLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUNELE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FBQztJQUNyQixDQUFDO0lBRUQsR0FBRyxDQUFDLEdBQVcsRUFBRSxLQUFRLEVBQUUsTUFBYyxJQUFJLENBQUMsVUFBVTtRQUN0RCxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNwQyxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQztZQUNoRCxJQUFJLFFBQVE7Z0JBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENB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QUFDLEdBQUc7UUFBRSxPQUFPLEVBQUUsQ0FBQztJQUVwQixNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztJQUNwQixNQUFNLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztJQUVyQixHQUFHLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUV2QyxNQUFNLFNBQVMsR0FBRyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3JELE1BQU0sSUFBSSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUM7SUFFNUIsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQ2QsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ3hDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsQixNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3RCLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDdEIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUV0QixNQUFNLEtBQUssR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbkQsSUFBSSxJQUFJLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsRUFB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QUEyQjtJQUMzQixVQUFVLEVBQVYsa0JBQVU7SUFDVixhQUFhLEVBQWIscUJBQWE7Q0FDZCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy95YW55dS9Eb3dubG9hZHMveXljMy1EZXNpZ24tU3lzdGVtL3NyYy9wZXJmb3JtYW5jZS9yZXNvdXJjZS1vcHRpbWl6YXRpb24udHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUg6LWE5rqQ5LyY5YyW5qih5Z2XXG4gKiBAZGVzY3JpcHRpb24g5o+Q5L6b5Zu+54mH5Y6L57yp44CB6aKE5Yqg6L295ZKM6LWE5rqQ5LyY5YyW5Yqf6IO9XG4gKiBAbW9kdWxlIHBlcmZvcm1hbmNlL3Jlc291cmNlLW9wdGltaXphdGlvblxuICogQGF1dGhvciBZWUPCs1xuICogQHZlcnNpb24gMS4wLjBcbiAqIEBjcmVhdGVkIDIwMjYtMDItMTlcbiAqL1xuXG5pbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZUNhbGxiYWNrLCB1c2VSZWYsIHVzZUVmZmVjdCwgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JztcblxuZXhwb3J0IGludGVyZmFjZSBJbWFnZU9wdGltaXphdGlvbkNvbmZpZyB7XG4gIG1heFdpZHRoPzogbnVtYmVyO1xuICBtYXhIZWlnaHQ/OiBudW1iZXI7XG4gIHF1YWxpdHk/OiBudW1iZXI7XG4gIGZvcm1hdD86ICdqcGVnJyB8ICdwbmcnIHwgJ3dlYnAnIHwgJ2F2aWYnO1xuICBlbmFibGVMYXp5TG9hZGluZz86IGJvb2xlYW47XG4gIGVuYWJsZVJlc3BvbnNpdmVJbWFnZXM/OiBib29sZWFuO1xuICBicmVha3BvaW50cz86IG51bWJlcltdO1xuICBlbmFibGVQbGFjZWhvbGRlcj86IGJvb2xlYW47XG4gIHBsYWNlaG9sZGVyU2l6ZT86IG51bWJlcjtcbiAgZW5hYmxlQmx1ckhhc2g/OiBib29sZWFuO1xuICBlbmFibGVQcm9ncmVzc2l2ZUxvYWRpbmc/OiBib29sZWFuO1xuICBjYWNoZUVuYWJsZWQ/OiBib29sZWFuO1xuICBjYWNoZVRpbWVvdXQ/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3B0aW1pemVkSW1hZ2VPcHRpb25zIHtcbiAgc3JjOiBzdHJpbmc7XG4gIGFsdDogc3RyaW5nO1xuICB3aWR0aD86IG51bWJlcjtcbiAgaGVpZ2h0PzogbnVtYmVyO1xuICBjb25maWc/OiBJbWFnZU9wdGltaXphdGlvbkNvbmZpZztcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICBsb2FkaW5nPzogJ2xhenknIHwgJ2VhZ2VyJztcbiAgZmV0Y2hQcmlvcml0eT86ICdoaWdoJyB8ICdsb3cnIHwgJ2F1dG8nO1xuICBkZWNvZGluZz86ICdzeW5jJyB8ICdhc3luYycgfCAnYXV0byc7XG4gIG9uTG9hZD86ICgpID0+IHZvaWQ7XG4gIG9uRXJyb3I/OiAoKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlc291cmNlUHJlbG9hZENvbmZpZyB7XG4gIG1heFByZWxvYWRDb3VudD86IG51bWJlcjtcbiAgcHJlbG9hZFByaW9yaXR5PzogJ2hpZ2gnIHwgJ2xvdycgfCAnYXV0byc7XG4gIHByZWxvYWRUaW1lb3V0PzogbnVtYmVyO1xuICByZXRyeUNvdW50PzogbnVtYmVyO1xuICByZXRyeURlbGF5PzogbnVtYmVyO1xuICBjYWNoZUVuYWJsZWQ/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFByZWxvYWRSZXN1bHQge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICByZXNvdXJjZTogc3RyaW5nO1xuICBkdXJhdGlvbjogbnVtYmVyO1xuICBjYWNoZWQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVzb3VyY2VDYWNoZTxUID0gdW5rbm93bj4ge1xuICBnZXQ6IChrZXk6IHN0cmluZykgPT4gVCB8IG51bGw7XG4gIHNldDogKGtleTogc3RyaW5nLCB2YWx1ZTogVCwgdHRsPzogbnVtYmVyKSA9PiB2b2lkO1xuICBoYXM6IChrZXk6IHN0cmluZykgPT4gYm9vbGVhbjtcbiAgZGVsZXRlOiAoa2V5OiBzdHJpbmcpID0+IHZvaWQ7XG4gIGNsZWFyOiAoKSA9PiB2b2lkO1xuICBzaXplOiAoKSA9PiBudW1iZXI7XG59XG5cbmNsYXNzIFJlc291cmNlQ2FjaGVNYW5hZ2VyPFQgPSB1bmtub3duPiBpbXBsZW1lbnRzIFJlc291cmNlQ2FjaGU8VD4ge1xuICBwcml2YXRlIGNhY2hlOiBNYXA8c3RyaW5nLCB7IHZhbHVlOiBUOyBleHBpcnk6IG51bWJlciB9PjtcbiAgcHJpdmF0ZSBtYXhTaXplOiBudW1iZXI7XG4gIHByaXZhdGUgZGVmYXVsdFRUTDogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKG1heFNpemU6IG51bWJlciA9IDEwMCwgZGVmYXVsdFRUTDogbnVtYmVyID0gMzYwMDAwMCkge1xuICAgIHRoaXMuY2FjaGUgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5tYXhTaXplID0gbWF4U2l6ZTtcbiAgICB0aGlzLmRlZmF1bHRUVEwgPSBkZWZhdWx0VFRMO1xuICB9XG5cbiAgZ2V0KGtleTogc3RyaW5nKTogVCB8IG51bGwge1xuICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5jYWNoZS5nZXQoa2V5KTtcbiAgICBpZiAoIWVudHJ5KSByZXR1cm4gbnVsbDtcblxuICAgIGlmIChEYXRlLm5vdygpID4gZW50cnkuZXhwaXJ5KSB7XG4gICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiBlbnRyeS52YWx1ZTtcbiAgfVxuXG4gIHNldChrZXk6IHN0cmluZywgdmFsdWU6IFQsIHR0bDogbnVtYmVyID0gdGhpcy5kZWZhdWx0VFRMKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY2FjaGUuc2l6ZSA+PSB0aGlzLm1heFNpemUpIHtcbiAgICAgIGNvbnN0IGZpcnN0S2V5ID0gdGhpcy5jYWNoZS5rZXlzKCkubmV4dCgpLnZhbHVlO1xuICAgICAgaWYgKGZpcnN0S2V5KSB0aGlzLmNhY2hlLmRlbGV0ZShmaXJzdEtleSk7XG4gICAgfVxuXG4gICAgdGhpcy5jYWNoZS5zZXQoa2V5LCB7XG4gICAgICB2YWx1ZSxcbiAgICAgIGV4cGlyeTogRGF0ZS5ub3coKSArIHR0bCxcbiAgICB9KTtcbiAgfVxuXG4gIGhhcyhrZXk6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmdldChrZXkpICE9PSBudWxsO1xuICB9XG5cbiAgZGVsZXRlKGtleTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jYWNoZS5kZWxldGUoa2V5KTtcbiAgfVxuXG4gIGNsZWFyKCk6IHZvaWQge1xuICAgIHRoaXMuY2FjaGUuY2xlYXIoKTtcbiAgfVxuXG4gIHNpemUoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5jYWNoZS5zaXplO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBpbWFnZUNhY2hlID0gbmV3IFJlc291cmNlQ2FjaGVNYW5hZ2VyPEhUTUxJbWFnZUVsZW1lbnQ+KDUwLCAxODAwMDAwKTtcbmV4cG9ydCBjb25zdCByZXNvdXJjZUNhY2hlID0gbmV3IFJlc291cmNlQ2FjaGVNYW5hZ2VyPHVua25vd24+KDEwMCwgMzYwMDAwMCk7XG5cbmV4cG9ydCBjb25zdCBjb21wcmVzc0ltYWdlID0gYXN5bmMgKFxuICBmaWxlOiBGaWxlLFxuICBjb25maWc6IEltYWdlT3B0aW1pemF0aW9uQ29uZmlnID0ge31cbik6IFByb21pc2U8QmxvYj4gPT4ge1xuICBjb25zdCB7IG1heFdpZHRoID0gMTkyMCwgbWF4SGVpZ2h0ID0gMTA4MCwgcXVhbGl0eSA9IDAuOCwgZm9ybWF0ID0gJ2pwZWcnIH0gPSBjb25maWc7XG5cbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICBsZXQgeyB3aWR0aCwgaGVpZ2h0IH0gPSBpbWc7XG5cbiAgICAgIGlmICh3aWR0aCA+IG1heFdpZHRoIHx8IGhlaWdodCA+IG1heEhlaWdodCkge1xuICAgICAgICBjb25zdCByYXRpbyA9IE1hdGgubWluKG1heFdpZHRoIC8gd2lkdGgsIG1heEhlaWdodCAvIGhlaWdodCk7XG4gICAgICAgIHdpZHRoICo9IHJhdGlvO1xuICAgICAgICBoZWlnaHQgKj0gcmF0aW87XG4gICAgICB9XG5cbiAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcblxuICAgICAgY3R4Py5kcmF3SW1hZ2UoaW1nLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcblxuICAgICAgY2FudmFzLnRvQmxvYihcbiAgICAgICAgKGJsb2IpID0+IHtcbiAgICAgICAgICBpZiAoYmxvYikge1xuICAgICAgICAgICAgcmVzb2x2ZShibG9iKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignRmFpbGVkIHRvIGNvbXByZXNzIGltYWdlJykpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgYGltYWdlLyR7Zm9ybWF0fWAsXG4gICAgICAgIHF1YWxpdHlcbiAgICAgICk7XG4gICAgfTtcblxuICAgIGltZy5vbmVycm9yID0gKCkgPT4gcmVqZWN0KG5ldyBFcnJvcignRmFpbGVkIHRvIGxvYWQgaW1hZ2UnKSk7XG4gICAgaW1nLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSk7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGdlbmVyYXRlUmVzcG9uc2l2ZUltYWdlVXJscyA9IChcbiAgYmFzZVVybDogc3RyaW5nLFxuICBicmVha3BvaW50czogbnVtYmVyW10gPSBbMzIwLCA2NDAsIDc2OCwgMTAyNCwgMTIwMCwgMTkyMF0sXG4gIGZvcm1hdDogc3RyaW5nID0gJ3dlYnAnXG4pOiBBcnJheTx7IHNyYzogc3RyaW5nOyB3aWR0aDogbnVtYmVyOyBtZWRpYT86IHN0cmluZyB9PiA9PiB7XG4gIGNvbnN0IHVybCA9IG5ldyBVUkwoYmFzZVVybCwgd2luZG93LmxvY2F0aW9uLm9yaWdpbik7XG5cbiAgcmV0dXJuIGJyZWFrcG9pbnRzLm1hcCgod2lkdGgpID0+IHtcbiAgICBjb25zdCBzZWFyY2hQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHVybC5zZWFyY2gpO1xuICAgIHNlYXJjaFBhcmFtcy5zZXQoJ3cnLCB3aWR0aC50b1N0cmluZygpKTtcbiAgICBzZWFyY2hQYXJhbXMuc2V0KCdmJywgZm9ybWF0KTtcblxuICAgIHJldHVybiB7XG4gICAgICBzcmM6IGAke3VybC5vcmlnaW59JHt1cmwucGF0aG5hbWV9PyR7c2VhcmNoUGFyYW1zLnRvU3RyaW5nKCl9YCxcbiAgICAgIHdpZHRoLFxuICAgICAgbWVkaWE6IGAobWF4LXdpZHRoOiAke3dpZHRofXB4KWAsXG4gICAgfTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgY3JlYXRlQmx1ckhhc2ggPSBhc3luYyAoXG4gIGltYWdlOiBIVE1MSW1hZ2VFbGVtZW50LFxuICBzaXplOiBudW1iZXIgPSAzMlxuKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcbiAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuXG4gIGlmICghY3R4KSByZXR1cm4gJyc7XG5cbiAgY2FudmFzLndpZHRoID0gc2l6ZTtcbiAgY2FudmFzLmhlaWdodCA9IHNpemU7XG5cbiAgY3R4LmRyYXdJbWFnZShpbWFnZSwgMCwgMCwgc2l6ZSwgc2l6ZSk7XG5cbiAgY29uc3QgaW1hZ2VEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBzaXplLCBzaXplKTtcbiAgY29uc3QgZGF0YSA9IGltYWdlRGF0YS5kYXRhO1xuXG4gIGxldCBoYXNoID0gJyc7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKz0gNCkge1xuICAgIGNvbnN0IHIgPSBkYXRhW2ldO1xuICAgIGNvbnN0IGcgPSBkYXRhW2kgKyAxXTtcbiAgICBjb25zdCBiID0gZGF0YVtpICsgMl07XG4gICAgY29uc3QgYSA9IGRhdGFbaSArIDNdO1xuXG4gICAgY29uc3QgdmFsdWUgPSAociA8PCAyNCkgfCAoZyA8PCAxNikgfCAoYiA8PCA4KSB8IGE7XG4gICAgaGFzaCArPSB2YWx1ZS50b1N0cmluZygxNikucGFkU3RhcnQoOCwgJzAnKTtcbiAgfVxuXG4gIHJldHVybiBoYXNoLnN1YnN0cmluZygwLCAyMCk7XG59O1xuXG5leHBvcnQgY29uc3QgcHJlbG9hZEltYWdlID0gKFxuICBzcmM6IHN0cmluZyxcbiAgY29uZmlnOiBSZXNvdXJjZVByZWxvYWRDb25maWcgPSB7fVxuKTogUHJvbWlzZTxQcmVsb2FkUmVzdWx0PiA9PiB7XG4gIGNvbnN0IHsgcmV0cnlDb3VudCA9IDMsIHJldHJ5RGVsYXkgPSAxMDAwLCBjYWNoZUVuYWJsZWQgPSB0cnVlIH0gPSBjb25maWc7XG5cbiAgaWYgKGNhY2hlRW5hYmxlZCAmJiBpbWFnZUNhY2hlLmhhcyhzcmMpKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgcmVzb3VyY2U6IHNyYyxcbiAgICAgIGR1cmF0aW9uOiAwLFxuICAgICAgY2FjaGVkOiB0cnVlLFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgbGV0IGF0dGVtcHRzID0gMDtcblxuICAgIGNvbnN0IGF0dGVtcHRMb2FkID0gKCkgPT4ge1xuICAgICAgY29uc3QgaW1nID0gbmV3IEltYWdlKCk7XG5cbiAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGR1cmF0aW9uID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG5cbiAgICAgICAgaWYgKGNhY2hlRW5hYmxlZCkge1xuICAgICAgICAgIGltYWdlQ2FjaGUuc2V0KHNyYywgaW1nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc29sdmUoe1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgcmVzb3VyY2U6IHNyYyxcbiAgICAgICAgICBkdXJhdGlvbixcbiAgICAgICAgICBjYWNoZWQ6IGZhbHNlLFxuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIGltZy5vbmVycm9yID0gKCkgPT4ge1xuICAgICAgICBhdHRlbXB0cysrO1xuXG4gICAgICAgIGlmIChhdHRlbXB0cyA8IHJldHJ5Q291bnQpIHtcbiAgICAgICAgICBzZXRUaW1lb3V0KGF0dGVtcHRMb2FkLCByZXRyeURlbGF5KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgcmVzb3VyY2U6IHNyYyxcbiAgICAgICAgICAgIGR1cmF0aW9uOiBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZSxcbiAgICAgICAgICAgIGNhY2hlZDogZmFsc2UsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGltZy5zcmMgPSBzcmM7XG4gICAgfTtcblxuICAgIGF0dGVtcHRMb2FkKCk7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IHByZWxvYWRSZXNvdXJjZSA9IChcbiAgdXJsOiBzdHJpbmcsXG4gIHR5cGU6ICdpbWFnZScgfCAnc2NyaXB0JyB8ICdzdHlsZScgfCAnZm9udCcgfCAnZmV0Y2gnLFxuICBjb25maWc6IFJlc291cmNlUHJlbG9hZENvbmZpZyA9IHt9XG4pOiBQcm9taXNlPFByZWxvYWRSZXN1bHQ+ID0+IHtcbiAgY29uc3QgeyByZXRyeUNvdW50ID0gMywgcmV0cnlEZWxheSA9IDEwMDAsIGNhY2hlRW5hYmxlZCA9IHRydWUgfSA9IGNvbmZpZztcblxuICBpZiAoY2FjaGVFbmFibGVkICYmIHJlc291cmNlQ2FjaGUuaGFzKHVybCkpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICByZXNvdXJjZTogdXJsLFxuICAgICAgZHVyYXRpb246IDAsXG4gICAgICBjYWNoZWQ6IHRydWUsXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBsZXQgYXR0ZW1wdHMgPSAwO1xuXG4gICAgY29uc3QgYXR0ZW1wdExvYWQgPSAoKSA9PiB7XG4gICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSAnaW1hZ2UnOlxuICAgICAgICAgIHByZWxvYWRJbWFnZSh1cmwsIGNvbmZpZykudGhlbihyZXNvbHZlKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnc2NyaXB0JzpcbiAgICAgICAgY2FzZSAnc3R5bGUnOlxuICAgICAgICBjYXNlICdmb250Jzoge1xuICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7XG4gICAgICAgICAgbGluay5yZWwgPSAncHJlbG9hZCc7XG4gICAgICAgICAgbGluay5hcyA9IHR5cGUgPT09ICdmb250JyA/ICdmb250JyA6IHR5cGU7XG4gICAgICAgICAgbGluay5ocmVmID0gdXJsO1xuXG4gICAgICAgICAgaWYgKHR5cGUgPT09ICdmb250Jykge1xuICAgICAgICAgICAgbGluay5jcm9zc09yaWdpbiA9ICdhbm9ueW1vdXMnO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGxpbmsub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTtcblxuICAgICAgICAgICAgaWYgKGNhY2hlRW5hYmxlZCkge1xuICAgICAgICAgICAgICByZXNvdXJjZUNhY2hlLnNldCh1cmwsIHRydWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgcmVzb3VyY2U6IHVybCxcbiAgICAgICAgICAgICAgZHVyYXRpb24sXG4gICAgICAgICAgICAgIGNhY2hlZDogZmFsc2UsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgbGluay5vbmVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgYXR0ZW1wdHMrKztcblxuICAgICAgICAgICAgaWYgKGF0dGVtcHRzIDwgcmV0cnlDb3VudCkge1xuICAgICAgICAgICAgICBzZXRUaW1lb3V0KGF0dGVtcHRMb2FkLCByZXRyeURlbGF5KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlc29sdmUoe1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJlc291cmNlOiB1cmwsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lLFxuICAgICAgICAgICAgICAgIGNhY2hlZDogZmFsc2UsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGxpbmspO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgJ2ZldGNoJzpcbiAgICAgICAgICBmZXRjaCh1cmwpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG5cbiAgICAgICAgICAgICAgaWYgKGNhY2hlRW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIHJlc291cmNlQ2FjaGUuc2V0KHVybCwgdHJ1ZSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIHJlc291cmNlOiB1cmwsXG4gICAgICAgICAgICAgICAgZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgY2FjaGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAgICAgYXR0ZW1wdHMrKztcblxuICAgICAgICAgICAgICBpZiAoYXR0ZW1wdHMgPCByZXRyeUNvdW50KSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChhdHRlbXB0TG9hZCwgcmV0cnlEZWxheSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgIHJlc291cmNlOiB1cmwsXG4gICAgICAgICAgICAgICAgICBkdXJhdGlvbjogcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICAgICAgICAgICAgICBjYWNoZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgcmVzb3VyY2U6IHVybCxcbiAgICAgICAgICAgIGR1cmF0aW9uOiBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZSxcbiAgICAgICAgICAgIGNhY2hlZDogZmFsc2UsXG4gICAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGF0dGVtcHRMb2FkKCk7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IE9wdGltaXplZEltYWdlOiBSZWFjdC5GQzxPcHRpbWl6ZWRJbWFnZU9wdGlvbnM+ID0gKHtcbiAgc3JjLFxuICBhbHQsXG4gIHdpZHRoLFxuICBoZWlnaHQsXG4gIGNvbmZpZyA9IHt9LFxuICBjbGFzc05hbWUgPSAnJyxcbiAgbG9hZGluZyA9ICdsYXp5JyxcbiAgZmV0Y2hQcmlvcml0eSA9ICdhdXRvJyxcbiAgZGVjb2RpbmcgPSAnYXN5bmMnLFxuICBvbkxvYWQsXG4gIG9uRXJyb3IsXG59KSA9PiB7XG4gIGNvbnN0IFtpc0xvYWRlZCwgc2V0SXNMb2FkZWRdID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbY3VycmVudFNyYywgc2V0Q3VycmVudFNyY10gPSB1c2VTdGF0ZShzcmMpO1xuICBjb25zdCBpbWdSZWYgPSB1c2VSZWY8SFRNTEltYWdlRWxlbWVudD4obnVsbCk7XG5cbiAgY29uc3Qge1xuICAgIGVuYWJsZUxhenlMb2FkaW5nID0gdHJ1ZSxcbiAgICBlbmFibGVSZXNwb25zaXZlSW1hZ2VzID0gdHJ1ZSxcbiAgICBicmVha3BvaW50cyA9IFszMjAsIDY0MCwgNzY4LCAxMDI0LCAxMjAwLCAxOTIwXSxcbiAgICBlbmFibGVQbGFjZWhvbGRlciA9IHRydWUsXG4gIH0gPSBjb25maWc7XG5cbiAgY29uc3QgcmVzcG9uc2l2ZVVybHMgPSB1c2VNZW1vKCgpID0+IHtcbiAgICBpZiAoZW5hYmxlUmVzcG9uc2l2ZUltYWdlcykge1xuICAgICAgcmV0dXJuIGdlbmVyYXRlUmVzcG9uc2l2ZUltYWdlVXJscyhzcmMsIGJyZWFrcG9pbnRzKTtcbiAgICB9XG4gICAgcmV0dXJuIFtdO1xuICB9LCBbc3JjLCBlbmFibGVSZXNwb25zaXZlSW1hZ2VzLCBicmVha3BvaW50c10pO1xuXG4gIGNvbnN0IHNyY1NldCA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIGlmIChyZXNwb25zaXZlVXJscy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gcmVzcG9uc2l2ZVVybHMubWFwKChyKSA9PiBgJHtyLnNyY30gJHtyLndpZHRofXdgKS5qb2luKCcsICcpO1xuICAgIH1cbiAgICByZXR1cm4gJyc7XG4gIH0sIFtyZXNwb25zaXZlVXJsc10pO1xuXG4gIGNvbnN0IHNpemVzID0gdXNlTWVtbygoKSA9PiB7XG4gICAgaWYgKHJlc3BvbnNpdmVVcmxzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiByZXNwb25zaXZlVXJscy5tYXAoKHIpID0+IHIubWVkaWEpLmpvaW4oJywgJyk7XG4gICAgfVxuICAgIHJldHVybiAnJztcbiAgfSwgW3Jlc3BvbnNpdmVVcmxzXSk7XG5cbiAgY29uc3Qgc2hvdWxkTGF6eUxvYWQgPVxuICAgIGVuYWJsZUxhenlMb2FkaW5nICYmIGxvYWRpbmcgPT09ICdsYXp5JyAmJiAnSW50ZXJzZWN0aW9uT2JzZXJ2ZXInIGluIHdpbmRvdztcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmICghc2hvdWxkTGF6eUxvYWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihcbiAgICAgIChlbnRyaWVzKSA9PiB7XG4gICAgICAgIGVudHJpZXMuZm9yRWFjaCgoZW50cnkpID0+IHtcbiAgICAgICAgICBpZiAoZW50cnkuaXNJbnRlcnNlY3RpbmcpIHtcbiAgICAgICAgICAgIHNldEN1cnJlbnRTcmMoc3JjKTtcbiAgICAgICAgICAgIG9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIHsgcm9vdE1hcmdpbjogJzUwcHgnIH1cbiAgICApO1xuXG4gICAgaWYgKGltZ1JlZi5jdXJyZW50KSB7XG4gICAgICBvYnNlcnZlci5vYnNlcnZlKGltZ1JlZi5jdXJyZW50KTtcbiAgICB9XG5cbiAgICByZXR1cm4gKCkgPT4gb2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICB9LCBbc3JjLCBzaG91bGRMYXp5TG9hZF0pO1xuXG4gIGNvbnN0IGhhbmRsZUxvYWQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgc2V0SXNMb2FkZWQodHJ1ZSk7XG4gICAgb25Mb2FkPy4oKTtcbiAgfSwgW29uTG9hZF0pO1xuXG4gIGNvbnN0IGhhbmRsZUVycm9yID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIG9uRXJyb3I/LigpO1xuICB9LCBbb25FcnJvcl0pO1xuXG4gIHJldHVybiAoXG4gICAgPHBpY3R1cmU+XG4gICAgICB7cmVzcG9uc2l2ZVVybHMubGVuZ3RoID4gMCAmJlxuICAgICAgICByZXNwb25zaXZlVXJscy5tYXAoKHVybCwgaW5kZXgpID0+IChcbiAgICAgICAgICA8c291cmNlIGtleT17aW5kZXh9IHNyY1NldD17YCR7dXJsLnNyY30gMXgsICR7dXJsLnNyY30gMnhgfSBtZWRpYT17dXJsLm1lZGlhfSAvPlxuICAgICAgICApKX1cbiAgICAgIDxpbWdcbiAgICAgICAgcmVmPXtpbWdSZWZ9XG4gICAgICAgIHNyYz17Y3VycmVudFNyY31cbiAgICAgICAgc3JjU2V0PXtzcmNTZXR9XG4gICAgICAgIHNpemVzPXtzaXplc31cbiAgICAgICAgYWx0PXthbHR9XG4gICAgICAgIHdpZHRoPXt3aWR0aH1cbiAgICAgICAgaGVpZ2h0PXtoZWlnaHR9XG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lfVxuICAgICAgICBsb2FkaW5nPXtsb2FkaW5nfVxuICAgICAgICBmZXRjaFByaW9yaXR5PXtmZXRjaFByaW9yaXR5fVxuICAgICAgICBkZWNvZGluZz17ZGVjb2Rpbmd9XG4gICAgICAgIG9uTG9hZD17aGFuZGxlTG9hZH1cbiAgICAgICAgb25FcnJvcj17aGFuZGxlRXJyb3J9XG4gICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgb3BhY2l0eTogaXNMb2FkZWQgPyAxIDogMCxcbiAgICAgICAgICB0cmFuc2l0aW9uOiAnb3BhY2l0eSAwLjNzIGVhc2UtaW4tb3V0JyxcbiAgICAgICAgfX1cbiAgICAgIC8+XG4gICAgICB7IWlzTG9hZGVkICYmIGVuYWJsZVBsYWNlaG9sZGVyICYmIChcbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzTmFtZT17YGltYWdlLXBsYWNlaG9sZGVyICR7Y2xhc3NOYW1lfWB9XG4gICAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgICBoZWlnaHQ6ICcxMDAlJyxcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyNmMGYwZjAnLFxuICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiBgbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZjBmMGYwIDAlLCAjZTBlMGUwIDUwJSwgI2YwZjBmMCAxMDAlKWAsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogJzIwMCUgMTAwJScsXG4gICAgICAgICAgICBhbmltYXRpb246ICdza2VsZXRvbi1sb2FkaW5nIDEuNXMgaW5maW5pdGUnLFxuICAgICAgICAgIH19XG4gICAgICAgIC8+XG4gICAgICApfVxuICAgIDwvcGljdHVyZT5cbiAgKTtcbn07XG5cbmV4cG9ydCBjb25zdCBSZXNvdXJjZVByZWxvYWRlcjogUmVhY3QuRkM8e1xuICByZXNvdXJjZXM6IEFycmF5PHsgdXJsOiBzdHJpbmc7IHR5cGU6ICdpbWFnZScgfCAnc2NyaXB0JyB8ICdzdHlsZScgfCAnZm9udCcgfCAnZmV0Y2gnIH0+O1xuICBjb25maWc/OiBSZXNvdXJjZVByZWxvYWRDb25maWc7XG4gIG9uUHJvZ3Jlc3M/OiAobG9hZGVkOiBudW1iZXIsIHRvdGFsOiBudW1iZXIpID0+IHZvaWQ7XG4gIG9uQ29tcGxldGU/OiAocmVzdWx0czogUHJlbG9hZFJlc3VsdFtdKSA9PiB2b2lkO1xufT4gPSAoeyByZXNvdXJjZXMsIGNvbmZpZyA9IHt9LCBvblByb2dyZXNzLCBvbkNvbXBsZXRlIH0pID0+IHtcbiAgY29uc3QgW2xvYWRlZCwgc2V0TG9hZGVkXSA9IHVzZVN0YXRlKDApO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgcHJlbG9hZFJlc291cmNlcyA9IGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByZWxvYWRQcm9taXNlcyA9IHJlc291cmNlcy5tYXAoKHJlc291cmNlKSA9PlxuICAgICAgICBwcmVsb2FkUmVzb3VyY2UocmVzb3VyY2UudXJsLCByZXNvdXJjZS50eXBlLCBjb25maWcpXG4gICAgICApO1xuXG4gICAgICBjb25zdCBwcmVsb2FkUmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKHByZWxvYWRQcm9taXNlcyk7XG4gICAgICBzZXRMb2FkZWQocmVzb3VyY2VzLmxlbmd0aCk7XG4gICAgICBvbkNvbXBsZXRlPy4ocHJlbG9hZFJlc3VsdHMpO1xuICAgIH07XG5cbiAgICBwcmVsb2FkUmVzb3VyY2VzKCk7XG4gIH0sIFtyZXNvdXJjZXMsIGNvbmZpZywgb25Db21wbGV0ZV0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgb25Qcm9ncmVzcz8uKGxvYWRlZCwgcmVzb3VyY2VzLmxlbmd0aCk7XG4gIH0sIFtsb2FkZWQsIHJlc291cmNlcy5sZW5ndGgsIG9uUHJvZ3Jlc3NdKTtcblxuICByZXR1cm4gbnVsbDtcbn07XG5cbmV4cG9ydCBjb25zdCB1c2VJbWFnZU9wdGltaXphdGlvbiA9IChjb25maWc6IEltYWdlT3B0aW1pemF0aW9uQ29uZmlnID0ge30pID0+IHtcbiAgY29uc3QgY29tcHJlc3MgPSB1c2VDYWxsYmFjaygoZmlsZTogRmlsZSkgPT4gY29tcHJlc3NJbWFnZShmaWxlLCBjb25maWcpLCBbY29uZmlnXSk7XG5cbiAgY29uc3QgcHJlbG9hZCA9IHVzZUNhbGxiYWNrKFxuICAgIChzcmM6IHN0cmluZywgcHJlbG9hZENvbmZpZz86IFJlc291cmNlUHJlbG9hZENvbmZpZykgPT4gcHJlbG9hZEltYWdlKHNyYywgcHJlbG9hZENvbmZpZyksXG4gICAgW11cbiAgKTtcblxuICBjb25zdCBnZW5lcmF0ZVJlc3BvbnNpdmUgPSB1c2VDYWxsYmFjayhcbiAgICAoYmFzZVVybDogc3RyaW5nKSA9PiBnZW5lcmF0ZVJlc3BvbnNpdmVJbWFnZVVybHMoYmFzZVVybCwgY29uZmlnLmJyZWFrcG9pbnRzLCBjb25maWcuZm9ybWF0KSxcbiAgICBbY29uZmlnLmJyZWFrcG9pbnRzLCBjb25maWcuZm9ybWF0XVxuICApO1xuXG4gIHJldHVybiB7XG4gICAgY29tcHJlc3MsXG4gICAgcHJlbG9hZCxcbiAgICBnZW5lcmF0ZVJlc3BvbnNpdmUsXG4gICAgY3JlYXRlQmx1ckhhc2gsXG4gIH07XG59O1xuXG5leHBvcnQgY29uc3QgdXNlUmVzb3VyY2VQcmVsb2FkID0gKGNvbmZpZzogUmVzb3VyY2VQcmVsb2FkQ29uZmlnID0ge30pID0+IHtcbiAgY29uc3QgW3ByZWxvYWRpbmcsIHNldFByZWxvYWRpbmddID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbcHJvZ3Jlc3MsIHNldFByb2dyZXNzXSA9IHVzZVN0YXRlKDApO1xuICBjb25zdCBbcmVzdWx0cywgc2V0UmVzdWx0c10gPSB1c2VTdGF0ZTxQcmVsb2FkUmVzdWx0W10+KFtdKTtcblxuICBjb25zdCBwcmVsb2FkID0gdXNlQ2FsbGJhY2soXG4gICAgYXN5bmMgKFxuICAgICAgcmVzb3VyY2VzOiBBcnJheTx7IHVybDogc3RyaW5nOyB0eXBlOiAnaW1hZ2UnIHwgJ3NjcmlwdCcgfCAnc3R5bGUnIHwgJ2ZvbnQnIHwgJ2ZldGNoJyB9PlxuICAgICkgPT4ge1xuICAgICAgc2V0UHJlbG9hZGluZyh0cnVlKTtcbiAgICAgIHNldFByb2dyZXNzKDApO1xuXG4gICAgICBjb25zdCBwcmVsb2FkUHJvbWlzZXMgPSByZXNvdXJjZXMubWFwKChyZXNvdXJjZSwgaW5kZXgpID0+XG4gICAgICAgIHByZWxvYWRSZXNvdXJjZShyZXNvdXJjZS51cmwsIHJlc291cmNlLnR5cGUsIGNvbmZpZykudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgc2V0UHJvZ3Jlc3MoKHByZXYpID0+IE1hdGgubWF4KHByZXYsIGluZGV4ICsgMSkpO1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJlbG9hZFByb21pc2VzKTtcbiAgICAgIHNldFJlc3VsdHMocmVzdWx0cyk7XG4gICAgICBzZXRQcmVsb2FkaW5nKGZhbHNlKTtcblxuICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfSxcbiAgICBbY29uZmlnXVxuICApO1xuXG4gIGNvbnN0IGNsZWFyQ2FjaGUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgaW1hZ2VDYWNoZS5jbGVhcigpO1xuICAgIHJlc291cmNlQ2FjaGUuY2xlYXIoKTtcbiAgfSwgW10pO1xuXG4gIHJldHVybiB7XG4gICAgcHJlbG9hZCxcbiAgICBwcmVsb2FkaW5nLFxuICAgIHByb2dyZXNzLFxuICAgIHJlc3VsdHMsXG4gICAgY2xlYXJDYWNoZSxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVJbWFnZU9wdGltaXphdGlvbkNvbmZpZyA9IChcbiAgb3ZlcnJpZGVzPzogUGFydGlhbDxJbWFnZU9wdGltaXphdGlvbkNvbmZpZz5cbik6IEltYWdlT3B0aW1pemF0aW9uQ29uZmlnID0+ICh7XG4gIG1heFdpZHRoOiAxOTIwLFxuICBtYXhIZWlnaHQ6IDEwODAsXG4gIHF1YWxpdHk6IDAuOCxcbiAgZm9ybWF0OiAnanBlZycsXG4gIGVuYWJsZUxhenlMb2FkaW5nOiB0cnVlLFxuICBlbmFibGVSZXNwb25zaXZlSW1hZ2VzOiB0cnVlLFxuICBicmVha3BvaW50czogWzMyMCwgNjQwLCA3NjgsIDEwMjQsIDEyMDAsIDE5MjBdLFxuICBlbmFibGVQbGFjZWhvbGRlcjogdHJ1ZSxcbiAgcGxhY2Vob2xkZXJTaXplOiAxMCxcbiAgZW5hYmxlQmx1ckhhc2g6IGZhbHNlLFxuICBlbmFibGVQcm9ncmVzc2l2ZUxvYWRpbmc6IHRydWUsXG4gIGNhY2hlRW5hYmxlZDogdHJ1ZSxcbiAgY2FjaGVUaW1lb3V0OiAxODAwMDAwLFxuICAuLi5vdmVycmlkZXMsXG59KTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZVJlc291cmNlUHJlbG9hZENvbmZpZyA9IChcbiAgb3ZlcnJpZGVzPzogUGFydGlhbDxSZXNvdXJjZVByZWxvYWRDb25maWc+XG4pOiBSZXNvdXJjZVByZWxvYWRDb25maWcgPT4gKHtcbiAgbWF4UHJlbG9hZENvdW50OiAxMCxcbiAgcHJlbG9hZFByaW9yaXR5OiAnYXV0bycsXG4gIHByZWxvYWRUaW1lb3V0OiA1MDAwLFxuICByZXRyeUNvdW50OiAzLFxuICByZXRyeURlbGF5OiAxMDAwLFxuICBjYWNoZUVuYWJsZWQ6IHRydWUsXG4gIC4uLm92ZXJyaWRlcyxcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGNvbXByZXNzSW1hZ2UsXG4gIGdlbmVyYXRlUmVzcG9uc2l2ZUltYWdlVXJscyxcbiAgY3JlYXRlQmx1ckhhc2gsXG4gIHByZWxvYWRJbWFnZSxcbiAgcHJlbG9hZFJlc291cmNlLFxuICBPcHRpbWl6ZWRJbWFnZSxcbiAgUmVzb3VyY2VQcmVsb2FkZXIsXG4gIHVzZUltYWdlT3B0aW1pemF0aW9uLFxuICB1c2VSZXNvdXJjZVByZWxvYWQsXG4gIGNyZWF0ZUltYWdlT3B0aW1pemF0aW9uQ29uZmlnLFxuICBjcmVhdGVSZXNvdXJjZVByZWxvYWRDb25maWcsXG4gIGltYWdlQ2FjaGUsXG4gIHJlc291cmNlQ2FjaGUsXG59O1xuIl0sInZlcnNpb24iOjN9