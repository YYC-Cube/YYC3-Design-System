ada67f7c98d68d1a7fa38aa5101037f4
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createPermissiveConfig = exports.createModerateConfig = exports.createStrictConfig = exports.validateCSRFToken = exports.createCSRFMiddleware = exports.withCSRFProtection = exports.CSRFProtectedFetch = exports.CSRFProtectedForm = exports.useCSRF = exports.CSRFProvider = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
/**
 * @file CSRF 防护模块
 * @description 提供跨站请求伪造防护功能
 * @module security/CSRFProtection
 * @author YYC³
 * @version 1.0.0
 * @created 2026-02-19
 */
const react_1 = require("react");
const CSRFContext = (0, react_1.createContext)(undefined);
const DEFAULT_CONFIG = {
    tokenName: 'csrf-token',
    headerName: 'X-CSRF-Token',
    parameterName: 'csrf_token',
    tokenLength: 32,
    expirationTime: 3600000,
    storageType: 'memory',
    regenerateOnLoad: true,
    doubleSubmitCookie: true,
    requireSamesite: 'strict',
    requireSecure: true,
    allowMethodOverride: ['GET', 'HEAD', 'OPTIONS', 'TRACE'],
    ignorePaths: [],
};
const generateRandomToken = (length = 32) => {
    const array = new Uint8Array(length);
    crypto.getRandomValues(array);
    return Array.from(array, (byte) => byte.toString(16).padStart(2, '0')).join('');
};
const CSRFProvider = ({ children, config = {}, serverEndpoint }) => {
    const currentConfig = (0, react_1.useRef)({ ...DEFAULT_CONFIG, ...config });
    const [token, setToken] = (0, react_1.useState)(null);
    const [tokens, setTokens] = (0, react_1.useState)(new Map());
    const tokenRef = (0, react_1.useRef)(null);
    const generateToken = (0, react_1.useCallback)(async () => {
        if (serverEndpoint) {
            try {
                const response = await fetch(serverEndpoint, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });
                if (response.ok) {
                    const data = await response.json();
                    const newToken = data.token || data.csrf_token;
                    setToken(newToken);
                    tokenRef.current = newToken;
                    return newToken;
                }
            }
            catch (error) {
                console.error('Failed to fetch CSRF token from server:', error);
            }
        }
        const newToken = generateRandomToken(currentConfig.current.tokenLength);
        const expires = Date.now() + currentConfig.current.expirationTime;
        setToken(newToken);
        tokenRef.current = newToken;
        const tokenData = {
            value: newToken,
            expires,
            headerName: currentConfig.current.headerName,
            parameterName: currentConfig.current.parameterName,
        };
        setTokens((prev) => new Map(prev).set(newToken, tokenData));
        return newToken;
    }, [serverEndpoint]);
    const validateToken = (0, react_1.useCallback)((inputToken) => {
        if (!inputToken) {
            const error = {
                type: 'missing_token',
                message: 'CSRF token is missing',
                timestamp: Date.now(),
            };
            currentConfig.current.onValidationError?.(error);
            return false;
        }
        const tokenData = tokens.get(inputToken);
        if (!tokenData) {
            const error = {
                type: 'invalid_token',
                token: inputToken,
                message: 'CSRF token is invalid',
                timestamp: Date.now(),
            };
            currentConfig.current.onValidationError?.(error);
            return false;
        }
        if (Date.now() > tokenData.expires) {
            const error = {
                type: 'expired_token',
                token: inputToken,
                message: 'CSRF token has expired',
                timestamp: Date.now(),
            };
            currentConfig.current.onValidationError?.(error);
            currentConfig.current.onTokenExpiry?.();
            return false;
        }
        if (tokenData.value !== inputToken) {
            const error = {
                type: 'mismatch',
                token: inputToken,
                expected: tokenData.value,
                message: 'CSRF token does not match',
                timestamp: Date.now(),
            };
            currentConfig.current.onValidationError?.(error);
            return false;
        }
        if (currentConfig.current.customValidator) {
            return currentConfig.current.customValidator(inputToken);
        }
        return true;
    }, [tokens]);
    const refreshTokens = (0, react_1.useCallback)(() => {
        generateToken();
    }, [generateToken]);
    const clearTokens = (0, react_1.useCallback)(() => {
        setToken(null);
        tokenRef.current = null;
        setTokens(new Map());
    }, []);
    const addToRequest = (0, react_1.useCallback)((request) => {
        const currentToken = tokenRef.current || token;
        if (!currentToken)
            return request;
        return {
            ...request,
            headers: {
                ...request.headers,
                [currentConfig.current.headerName]: currentToken,
            },
        };
    }, [token]);
    const addToForm = (0, react_1.useCallback)((form) => {
        const currentToken = tokenRef.current || token;
        if (!currentToken)
            return;
        let input = form.querySelector(`input[name="${currentConfig.current.parameterName}"]`);
        if (!input) {
            input = document.createElement('input');
            input.type = 'hidden';
            input.name = currentConfig.current.parameterName;
            form.appendChild(input);
        }
        input.value = currentToken;
    }, [token]);
    const addToURL = (0, react_1.useCallback)((url) => {
        const currentToken = tokenRef.current || token;
        if (!currentToken)
            return url;
        try {
            const urlObj = new URL(url, window.location.origin);
            urlObj.searchParams.set(currentConfig.current.parameterName, currentToken);
            return urlObj.toString();
        }
        catch {
            return url;
        }
    }, [token]);
    const contextValue = {
        token,
        generateToken,
        validateToken,
        refreshTokens,
        clearTokens,
        addToRequest,
        addToForm,
        addToURL,
        config: currentConfig.current,
    };
    (0, react_1.useEffect)(() => {
        if (currentConfig.current.regenerateOnLoad) {
            generateToken();
        }
    }, [generateToken]);
    (0, react_1.useEffect)(() => {
        if (currentConfig.current.storageType === 'session') {
            sessionStorage.setItem(currentConfig.current.tokenName, token || '');
        }
        else if (currentConfig.current.storageType === 'local') {
            localStorage.setItem(currentConfig.current.tokenName, token || '');
        }
    }, [token]);
    (0, react_1.useEffect)(() => {
        const interval = setInterval(() => {
            const now = Date.now();
            let needsRefresh = false;
            tokens.forEach((tokenData, tokenKey) => {
                if (now > tokenData.expires) {
                    setTokens((prev) => {
                        const next = new Map(prev);
                        next.delete(tokenKey);
                        return next;
                    });
                    needsRefresh = true;
                }
            });
            if (needsRefresh) {
                generateToken();
            }
        }, currentConfig.current.expirationTime / 2);
        return () => clearInterval(interval);
    }, [tokens, generateToken]);
    return (0, jsx_runtime_1.jsx)(CSRFContext.Provider, { value: contextValue, children: children });
};
exports.CSRFProvider = CSRFProvider;
const useCSRF = () => {
    const context = (0, react_1.useContext)(CSRFContext);
    if (!context) {
        throw new Error('useCSRF must be used within a CSRFProvider');
    }
    return context;
};
exports.useCSRF = useCSRF;
const CSRFProtectedForm = ({ children, onSubmit, method = 'POST', action, className, ...props }) => {
    const { addToForm } = (0, exports.useCSRF)();
    const formRef = (0, react_1.useRef)(null);
    (0, react_1.useEffect)(() => {
        if (formRef.current) {
            addToForm(formRef.current);
        }
    }, [addToForm]);
    const handleSubmit = (0, react_1.useCallback)((e) => {
        e.preventDefault();
        onSubmit(e);
    }, [onSubmit]);
    return ((0, jsx_runtime_1.jsx)("form", { ref: formRef, method: method, action: action, onSubmit: handleSubmit, className: className, ...props, children: children }));
};
exports.CSRFProtectedForm = CSRFProtectedForm;
const CSRFProtectedFetch = async (url, options = {}, csrfContext) => {
    const protectedOptions = csrfContext.addToRequest(options);
    return fetch(url, protectedOptions);
};
exports.CSRFProtectedFetch = CSRFProtectedFetch;
const withCSRFProtection = (Component, config) => {
    const WrappedComponent = (props) => ((0, jsx_runtime_1.jsx)(exports.CSRFProvider, { config: config, children: (0, jsx_runtime_1.jsx)(Component, { ...props }) }));
    WrappedComponent.displayName = `withCSRFProtection(${Component.displayName || Component.name})`;
    return WrappedComponent;
};
exports.withCSRFProtection = withCSRFProtection;
const createCSRFMiddleware = (csrfContext) => {
    return {
        fetch: (url, options) => {
            return (0, exports.CSRFProtectedFetch)(url, options || {}, csrfContext);
        },
        XMLHttpRequest: () => {
            const xhr = new XMLHttpRequest();
            const originalOpen = xhr.open.bind(xhr);
            const originalSetRequestHeader = xhr.setRequestHeader.bind(xhr);
            xhr.open = function (method, url, async, user, password) {
                let urlStr;
                if (typeof url === 'string') {
                    urlStr = url;
                }
                else {
                    urlStr = url.toString();
                }
                return originalOpen(method, urlStr, async ?? true, user ?? null, password ?? null);
            };
            xhr.setRequestHeader = function (name, value) {
                return originalSetRequestHeader(name, value);
            };
            const originalSend = xhr.send.bind(xhr);
            xhr.send = function (body) {
                const token = csrfContext.token;
                if (token) {
                    this.setRequestHeader(csrfContext.config.headerName, token);
                }
                return originalSend(body ?? null);
            };
            return xhr;
        },
    };
};
exports.createCSRFMiddleware = createCSRFMiddleware;
const validateCSRFToken = (request, token, config) => {
    const method = request.method.toUpperCase();
    const safeMethods = ['GET', 'HEAD', 'OPTIONS', 'TRACE'];
    if (safeMethods.includes(method)) {
        return true;
    }
    if (!token) {
        return false;
    }
    const headerToken = request.headers.get(config.headerName);
    const url = new URL(request.url);
    const paramToken = url.searchParams.get(config.parameterName);
    return headerToken === token || paramToken === token;
};
exports.validateCSRFToken = validateCSRFToken;
const createStrictConfig = () => ({
    tokenLength: 64,
    expirationTime: 1800000,
    requireSamesite: 'strict',
    requireSecure: true,
    doubleSubmitCookie: true,
    regenerateOnLoad: true,
    storageType: 'session',
});
exports.createStrictConfig = createStrictConfig;
const createModerateConfig = () => ({
    tokenLength: 32,
    expirationTime: 3600000,
    requireSamesite: 'lax',
    requireSecure: true,
    doubleSubmitCookie: true,
    regenerateOnLoad: false,
    storageType: 'memory',
});
exports.createModerateConfig = createModerateConfig;
const createPermissiveConfig = () => ({
    tokenLength: 16,
    expirationTime: 7200000,
    requireSamesite: 'lax',
    requireSecure: false,
    doubleSubmitCookie: false,
    regenerateOnLoad: false,
    storageType: 'local',
});
exports.createPermissiveConfig = createPermissiveConfig;
exports.default = {
    CSRFProvider: exports.CSRFProvider,
    useCSRF: exports.useCSRF,
    CSRFProtectedForm: exports.CSRFProtectedForm,
    CSRFProtectedFetch: exports.CSRFProtectedFetch,
    withCSRFProtection: exports.withCSRFProtection,
    createCSRFMiddleware: exports.createCSRFMiddleware,
    validateCSRFToken: exports.validateCSRFToken,
    createStrictConfig: exports.createStrictConfig,
    createModerateConfig: exports.createModerateConfig,
    createPermissiveConfig: exports.createPermissiveConfig,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3lhbnl1L0Rvd25sb2Fkcy95eWMzLURlc2lnbi1TeXN0ZW0vc3JjL3NlY3VyaXR5L0NTUkZQcm90ZWN0aW9uLnRzeCIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7Ozs7Ozs7R0FPRztBQUVILGlDQUFtRztBQTZGbkcsTUFBTSxXQUFXLEdBQUcsSUFBQSxxQkFBYSxFQUE4QixTQUFTLENBQUMsQ0FBQztBQUUxRSxNQUFNLGNBQWMsR0FBZTtJQUNqQyxTQUFTLEVBQUUsWUFBWTtJQUN2QixVQUFVLEVBQUUsY0FBYztJQUMxQixhQUFhLEVBQUUsWUFBWTtJQUMzQixXQUFXLEVBQUUsRUFBRTtJQUNmLGNBQWMsRUFBRSxPQUFPO0lBQ3ZCLFdBQVcsRUFBRSxRQUFRO0lBQ3JCLGdCQUFnQixFQUFFLElBQUk7SUFDdEIsa0JBQWtCLEVBQUUsSUFBSTtJQUN4QixlQUFlLEVBQUUsUUFBUTtJQUN6QixhQUFhLEVBQUUsSUFBSTtJQUNuQixtQkFBbUIsRUFBRSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQztJQUN4RCxXQUFXLEVBQUUsRUFBRTtDQUNoQixDQUFDO0FBRUYsTUFBTSxtQkFBbUIsR0FBRyxDQUFDLFNBQWlCLEVBQUUsRUFBVSxFQUFFO0lBQzFELE1BQU0sS0FBSyxHQUFHLElBQUksVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3JDLE1BQU0sQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDOUIsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ2xGLENBQUMsQ0FBQztBQUVLLE1BQU0sWUFBWSxHQUlwQixDQUFDLEVBQUUsUUFBUSxFQUFFLE1BQU0sR0FBRyxFQUFFLEVBQUUsY0FBYyxF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TztJQUN2QixlQUFlLEVBQUUsS0FBSztJQUN0QixhQUFhLEVBQUUsS0FBSztJQUNwQixrQkFBa0IsRUFBRSxLQUFLO0lBQ3pCLGdCQUFnQixFQUFFLEtBQUs7SUFDdkIsV0FBVyxFQUFFLE9BQU87Q0FDckIsQ0FBQyxDQUFDO0FBUlUsUUFBQSxzQkFBc0IsMEJBUWhDO0FBRUgsa0JBQWU7SUFDYixZQUFZLEVBQVosb0JBQVk7SUFDWixPQUFPLEVBQVAsZUFBTztJQUNQLGlCQUFpQixFQUFqQix5QkFBaUI7SUFDakIsa0JBQWtCLEVBQWxCLDBCQUFrQjtJQUNsQixrQkFBa0IsRUFBbEIsMEJBQWtCO0lBQ2xCLG9CQUFvQixFQUFwQiw0QkFBb0I7SUFDcEIsaUJBQWlCLEVBQWpCLHlCQUFpQjtJQUNqQixrQkFBa0IsRUFBbEIsMEJBQWtCO0lBQ2xCLG9CQUFvQixFQUFwQiw0QkFBb0I7SUFDcEIsc0JBQXNCLEVBQXRCLDhCQUFzQjtDQUN2QixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy95YW55dS9Eb3dubG9hZHMveXljMy1EZXNpZ24tU3lzdGVtL3NyYy9zZWN1cml0eS9DU1JGUHJvdGVjdGlvbi50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBDU1JGIOmYsuaKpOaooeWdl1xuICogQGRlc2NyaXB0aW9uIOaPkOS+m+i3qOermeivt+axguS8qumAoOmYsuaKpOWKn+iDvVxuICogQG1vZHVsZSBzZWN1cml0eS9DU1JGUHJvdGVjdGlvblxuICogQGF1dGhvciBZWUPCs1xuICogQHZlcnNpb24gMS4wLjBcbiAqIEBjcmVhdGVkIDIwMjYtMDItMTlcbiAqL1xuXG5pbXBvcnQgUmVhY3QsIHsgY3JlYXRlQ29udGV4dCwgdXNlQ29udGV4dCwgdXNlU3RhdGUsIHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZVJlZiB9IGZyb20gJ3JlYWN0JztcblxudHlwZSBDU1JGUmVxdWVzdEJvZHkgPSBzdHJpbmcgfCBEb2N1bWVudCB8IEJsb2IgfCBBcnJheUJ1ZmZlciB8IEZvcm1EYXRhIHwgVVJMU2VhcmNoUGFyYW1zIHwgbnVsbDtcblxuZXhwb3J0IGludGVyZmFjZSBDU1JGVG9rZW4ge1xuICB2YWx1ZTogc3RyaW5nO1xuICBleHBpcmVzOiBudW1iZXI7XG4gIGhlYWRlck5hbWU6IHN0cmluZztcbiAgcGFyYW1ldGVyTmFtZTogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENTUkZDb25maWcge1xuICB0b2tlbk5hbWU/OiBzdHJpbmc7XG4gIGhlYWRlck5hbWU/OiBzdHJpbmc7XG4gIHBhcmFtZXRlck5hbWU/OiBzdHJpbmc7XG4gIHRva2VuTGVuZ3RoPzogbnVtYmVyO1xuICBleHBpcmF0aW9uVGltZT86IG51bWJlcjtcbiAgc3RvcmFnZVR5cGU/OiAnbWVtb3J5JyB8ICdzZXNzaW9uJyB8ICdsb2NhbCcgfCAnY29va2llJztcbiAgcmVnZW5lcmF0ZU9uTG9hZD86IGJvb2xlYW47XG4gIGRvdWJsZVN1Ym1pdENvb2tpZT86IGJvb2xlYW47XG4gIHJlcXVpcmVTYW1lc2l0ZT86ICdzdHJpY3QnIHwgJ2xheCcgfCAnbm9uZSc7XG4gIHJlcXVpcmVTZWN1cmU/OiBib29sZWFuO1xuICBhbGxvd01ldGhvZE92ZXJyaWRlPzogc3RyaW5nW107XG4gIGlnbm9yZVBhdGhzPzogc3RyaW5nW107XG4gIGN1c3RvbVZhbGlkYXRvcj86ICh0b2tlbjogc3RyaW5nKSA9PiBib29sZWFuO1xuICBvblRva2VuRXhwaXJ5PzogKCkgPT4gdm9pZDtcbiAgb25WYWxpZGF0aW9uRXJyb3I/OiAoZXJyb3I6IENTUkZWYWxpZGF0aW9uRXJyb3IpID0+IHZvaWQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ1NSRlZhbGlkYXRpb25FcnJvciB7XG4gIHR5cGU6ICdtaXNzaW5nX3Rva2VuJyB8ICdpbnZhbGlkX3Rva2VuJyB8ICdleHBpcmVkX3Rva2VuJyB8ICdtaXNtYXRjaCc7XG4gIHRva2VuPzogc3RyaW5nO1xuICBleHBlY3RlZD86IHN0cmluZztcbiAgbWVzc2FnZTogc3RyaW5nO1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZXF1ZXN0Q29uZmlnIHtcbiAgbWV0aG9kPzogc3RyaW5nO1xuICBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAgYm9keT86IEJvZHlJbml0IHwgbnVsbDtcbiAgY2FjaGU/OiBSZXF1ZXN0Q2FjaGU7XG4gIGNyZWRlbnRpYWxzPzogUmVxdWVzdENyZWRlbnRpYWxzO1xuICBtb2RlPzogUmVxdWVzdE1vZGU7XG4gIHJlZGlyZWN0PzogUmVxdWVzdFJlZGlyZWN0O1xuICByZWZlcnJlcj86IHN0cmluZztcbiAgcmVmZXJyZXJQb2xpY3k/OiBSZWZlcnJlclBvbGljeTtcbiAgaW50ZWdyaXR5Pzogc3RyaW5nO1xuICBrZWVwYWxpdmU/OiBib29sZWFuO1xuICBzaWduYWw/OiBBYm9ydFNpZ25hbCB8IG51bGw7XG59XG5cbnR5cGUgQm9keUluaXQgPVxuICB8IEJsb2JcbiAgfCBBcnJheUJ1ZmZlclxuICB8IEFycmF5QnVmZmVyVmlld1xuICB8IEZvcm1EYXRhXG4gIHwgVVJMU2VhcmNoUGFyYW1zXG4gIHwgUmVhZGFibGVTdHJlYW08VWludDhBcnJheT5cbiAgfCBzdHJpbmc7XG50eXBlIFJlcXVlc3RDYWNoZSA9XG4gIHwgJ2RlZmF1bHQnXG4gIHwgJ2ZvcmNlLWNhY2hlJ1xuICB8ICduby1jYWNoZSdcbiAgfCAnbm8tc3RvcmUnXG4gIHwgJ29ubHktaWYtY2FjaGVkJ1xuICB8ICdyZWxvYWQnO1xudHlwZSBSZXF1ZXN0Q3JlZGVudGlhbHMgPSAnaW5jbHVkZScgfCAnb21pdCcgfCAnc2FtZS1vcmlnaW4nO1xudHlwZSBSZXF1ZXN0TW9kZSA9ICdjb3JzJyB8ICduYXZpZ2F0ZScgfCAnbm8tY29ycycgfCAnc2FtZS1vcmlnaW4nO1xudHlwZSBSZXF1ZXN0UmVkaXJlY3QgPSAnZXJyb3InIHwgJ2ZvbGxvdycgfCAnbWFudWFsJztcbnR5cGUgUmVmZXJyZXJQb2xpY3kgPVxuICB8ICcnXG4gIHwgJ25vLXJlZmVycmVyJ1xuICB8ICduby1yZWZlcnJlci13aGVuLWRvd25ncmFkZSdcbiAgfCAnb3JpZ2luJ1xuICB8ICdvcmlnaW4td2hlbi1jcm9zcy1vcmlnaW4nXG4gIHwgJ3NhbWUtb3JpZ2luJ1xuICB8ICdzdHJpY3Qtb3JpZ2luJ1xuICB8ICdzdHJpY3Qtb3JpZ2luLXdoZW4tY3Jvc3Mtb3JpZ2luJ1xuICB8ICd1bnNhZmUtdXJsJztcblxuZXhwb3J0IGludGVyZmFjZSBDU1JGQ29udGV4dFR5cGUge1xuICB0b2tlbjogc3RyaW5nIHwgbnVsbDtcbiAgZ2VuZXJhdGVUb2tlbjogKCkgPT4gUHJvbWlzZTxzdHJpbmc+O1xuICB2YWxpZGF0ZVRva2VuOiAodG9rZW46IHN0cmluZykgPT4gYm9vbGVhbjtcbiAgcmVmcmVzaFRva2VuczogKCkgPT4gdm9pZDtcbiAgY2xlYXJUb2tlbnM6ICgpID0+IHZvaWQ7XG4gIGFkZFRvUmVxdWVzdDogKHJlcXVlc3Q6IFJlcXVlc3RDb25maWcpID0+IFJlcXVlc3RDb25maWc7XG4gIGFkZFRvRm9ybTogKGZvcm06IEhUTUxGb3JtRWxlbWVudCkgPT4gdm9pZDtcbiAgYWRkVG9VUkw6ICh1cmw6IHN0cmluZykgPT4gc3RyaW5nO1xuICBjb25maWc6IENTUkZDb25maWc7XG59XG5cbmNvbnN0IENTUkZDb250ZXh0ID0gY3JlYXRlQ29udGV4dDxDU1JGQ29udGV4dFR5cGUgfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCk7XG5cbmNvbnN0IERFRkFVTFRfQ09ORklHOiBDU1JGQ29uZmlnID0ge1xuICB0b2tlbk5hbWU6ICdjc3JmLXRva2VuJyxcbiAgaGVhZGVyTmFtZTogJ1gtQ1NSRi1Ub2tlbicsXG4gIHBhcmFtZXRlck5hbWU6ICdjc3JmX3Rva2VuJyxcbiAgdG9rZW5MZW5ndGg6IDMyLFxuICBleHBpcmF0aW9uVGltZTogMzYwMDAwMCxcbiAgc3RvcmFnZVR5cGU6ICdtZW1vcnknLFxuICByZWdlbmVyYXRlT25Mb2FkOiB0cnVlLFxuICBkb3VibGVTdWJtaXRDb29raWU6IHRydWUsXG4gIHJlcXVpcmVTYW1lc2l0ZTogJ3N0cmljdCcsXG4gIHJlcXVpcmVTZWN1cmU6IHRydWUsXG4gIGFsbG93TWV0aG9kT3ZlcnJpZGU6IFsnR0VUJywgJ0hFQUQnLCAnT1BUSU9OUycsICdUUkFDRSddLFxuICBpZ25vcmVQYXRoczogW10sXG59O1xuXG5jb25zdCBnZW5lcmF0ZVJhbmRvbVRva2VuID0gKGxlbmd0aDogbnVtYmVyID0gMzIpOiBzdHJpbmcgPT4ge1xuICBjb25zdCBhcnJheSA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7XG4gIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMoYXJyYXkpO1xuICByZXR1cm4gQXJyYXkuZnJvbShhcnJheSwgKGJ5dGUpID0+IGJ5dGUudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICcwJykpLmpvaW4oJycpO1xufTtcblxuZXhwb3J0IGNvbnN0IENTUkZQcm92aWRlcjogUmVhY3QuRkM8e1xuICBjaGlsZHJlbjogUmVhY3QuUmVhY3ROb2RlO1xuICBjb25maWc/OiBQYXJ0aWFsPENTUkZDb25maWc+O1xuICBzZXJ2ZXJFbmRwb2ludD86IHN0cmluZztcbn0+ID0gKHsgY2hpbGRyZW4sIGNvbmZpZyA9IHt9LCBzZXJ2ZXJFbmRwb2ludCB9KSA9PiB7XG4gIGNvbnN0IGN1cnJlbnRDb25maWcgPSB1c2VSZWY8Q1NSRkNvbmZpZz4oeyAuLi5ERUZBVUxUX0NPTkZJRywgLi4uY29uZmlnIH0pO1xuICBjb25zdCBbdG9rZW4sIHNldFRva2VuXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpO1xuICBjb25zdCBbdG9rZW5zLCBzZXRUb2tlbnNdID0gdXNlU3RhdGU8TWFwPHN0cmluZywgQ1NSRlRva2VuPj4obmV3IE1hcCgpKTtcbiAgY29uc3QgdG9rZW5SZWYgPSB1c2VSZWY8c3RyaW5nIHwgbnVsbD4obnVsbCk7XG5cbiAgY29uc3QgZ2VuZXJhdGVUb2tlbiA9IHVzZUNhbGxiYWNrKGFzeW5jICgpOiBQcm9taXNlPHN0cmluZz4gPT4ge1xuICAgIGlmIChzZXJ2ZXJFbmRwb2ludCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChzZXJ2ZXJFbmRwb2ludCwge1xuICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgIGNyZWRlbnRpYWxzOiAnaW5jbHVkZScsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgIGNvbnN0IG5ld1Rva2VuID0gZGF0YS50b2tlbiB8fCBkYXRhLmNzcmZfdG9rZW47XG4gICAgICAgICAgc2V0VG9rZW4obmV3VG9rZW4pO1xuICAgICAgICAgIHRva2VuUmVmLmN1cnJlbnQgPSBuZXdUb2tlbjtcbiAgICAgICAgICByZXR1cm4gbmV3VG9rZW47XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCBDU1JGIHRva2VuIGZyb20gc2VydmVyOicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBuZXdUb2tlbiA9IGdlbmVyYXRlUmFuZG9tVG9rZW4oY3VycmVudENvbmZpZy5jdXJyZW50LnRva2VuTGVuZ3RoKTtcbiAgICBjb25zdCBleHBpcmVzID0gRGF0ZS5ub3coKSArIGN1cnJlbnRDb25maWcuY3VycmVudC5leHBpcmF0aW9uVGltZSE7XG5cbiAgICBzZXRUb2tlbihuZXdUb2tlbik7XG4gICAgdG9rZW5SZWYuY3VycmVudCA9IG5ld1Rva2VuO1xuXG4gICAgY29uc3QgdG9rZW5EYXRhOiBDU1JGVG9rZW4gPSB7XG4gICAgICB2YWx1ZTogbmV3VG9rZW4sXG4gICAgICBleHBpcmVzLFxuICAgICAgaGVhZGVyTmFtZTogY3VycmVudENvbmZpZy5jdXJyZW50LmhlYWRlck5hbWUhLFxuICAgICAgcGFyYW1ldGVyTmFtZTogY3VycmVudENvbmZpZy5jdXJyZW50LnBhcmFtZXRlck5hbWUhLFxuICAgIH07XG5cbiAgICBzZXRUb2tlbnMoKHByZXYpID0+IG5ldyBNYXAocHJldikuc2V0KG5ld1Rva2VuLCB0b2tlbkRhdGEpKTtcblxuICAgIHJldHVybiBuZXdUb2tlbjtcbiAgfSwgW3NlcnZlckVuZHBvaW50XSk7XG5cbiAgY29uc3QgdmFsaWRhdGVUb2tlbiA9IHVzZUNhbGxiYWNrKFxuICAgIChpbnB1dFRva2VuOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICAgIGlmICghaW5wdXRUb2tlbikge1xuICAgICAgICBjb25zdCBlcnJvcjogQ1NSRlZhbGlkYXRpb25FcnJvciA9IHtcbiAgICAgICAgICB0eXBlOiAnbWlzc2luZ190b2tlbicsXG4gICAgICAgICAgbWVzc2FnZTogJ0NTUkYgdG9rZW4gaXMgbWlzc2luZycsXG4gICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICB9O1xuICAgICAgICBjdXJyZW50Q29uZmlnLmN1cnJlbnQub25WYWxpZGF0aW9uRXJyb3I/LihlcnJvcik7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdG9rZW5EYXRhID0gdG9rZW5zLmdldChpbnB1dFRva2VuKTtcblxuICAgICAgaWYgKCF0b2tlbkRhdGEpIHtcbiAgICAgICAgY29uc3QgZXJyb3I6IENTUkZWYWxpZGF0aW9uRXJyb3IgPSB7XG4gICAgICAgICAgdHlwZTogJ2ludmFsaWRfdG9rZW4nLFxuICAgICAgICAgIHRva2VuOiBpbnB1dFRva2VuLFxuICAgICAgICAgIG1lc3NhZ2U6ICdDU1JGIHRva2VuIGlzIGludmFsaWQnLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgfTtcbiAgICAgICAgY3VycmVudENvbmZpZy5jdXJyZW50Lm9uVmFsaWRhdGlvbkVycm9yPy4oZXJyb3IpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGlmIChEYXRlLm5vdygpID4gdG9rZW5EYXRhLmV4cGlyZXMpIHtcbiAgICAgICAgY29uc3QgZXJyb3I6IENTUkZWYWxpZGF0aW9uRXJyb3IgPSB7XG4gICAgICAgICAgdHlwZTogJ2V4cGlyZWRfdG9rZW4nLFxuICAgICAgICAgIHRva2VuOiBpbnB1dFRva2VuLFxuICAgICAgICAgIG1lc3NhZ2U6ICdDU1JGIHRva2VuIGhhcyBleHBpcmVkJyxcbiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgIH07XG4gICAgICAgIGN1cnJlbnRDb25maWcuY3VycmVudC5vblZhbGlkYXRpb25FcnJvcj8uKGVycm9yKTtcbiAgICAgICAgY3VycmVudENvbmZpZy5jdXJyZW50Lm9uVG9rZW5FeHBpcnk/LigpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGlmICh0b2tlbkRhdGEudmFsdWUgIT09IGlucHV0VG9rZW4pIHtcbiAgICAgICAgY29uc3QgZXJyb3I6IENTUkZWYWxpZGF0aW9uRXJyb3IgPSB7XG4gICAgICAgICAgdHlwZTogJ21pc21hdGNoJyxcbiAgICAgICAgICB0b2tlbjogaW5wdXRUb2tlbixcbiAgICAgICAgICBleHBlY3RlZDogdG9rZW5EYXRhLnZhbHVlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdDU1JGIHRva2VuIGRvZXMgbm90IG1hdGNoJyxcbiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgIH07XG4gICAgICAgIGN1cnJlbnRDb25maWcuY3VycmVudC5vblZhbGlkYXRpb25FcnJvcj8uKGVycm9yKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAoY3VycmVudENvbmZpZy5jdXJyZW50LmN1c3RvbVZhbGlkYXRvcikge1xuICAgICAgICByZXR1cm4gY3VycmVudENvbmZpZy5jdXJyZW50LmN1c3RvbVZhbGlkYXRvcihpbnB1dFRva2VuKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgICBbdG9rZW5zXVxuICApO1xuXG4gIGNvbnN0IHJlZnJlc2hUb2tlbnMgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgZ2VuZXJhdGVUb2tlbigpO1xuICB9LCBbZ2VuZXJhdGVUb2tlbl0pO1xuXG4gIGNvbnN0IGNsZWFyVG9rZW5zID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldFRva2VuKG51bGwpO1xuICAgIHRva2VuUmVmLmN1cnJlbnQgPSBudWxsO1xuICAgIHNldFRva2VucyhuZXcgTWFwKCkpO1xuICB9LCBbXSk7XG5cbiAgY29uc3QgYWRkVG9SZXF1ZXN0ID0gdXNlQ2FsbGJhY2soXG4gICAgKHJlcXVlc3Q6IFJlcXVlc3RDb25maWcpOiBSZXF1ZXN0Q29uZmlnID0+IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRUb2tlbiA9IHRva2VuUmVmLmN1cnJlbnQgfHwgdG9rZW47XG4gICAgICBpZiAoIWN1cnJlbnRUb2tlbikgcmV0dXJuIHJlcXVlc3Q7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnJlcXVlc3QsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAuLi5yZXF1ZXN0LmhlYWRlcnMsXG4gICAgICAgICAgW2N1cnJlbnRDb25maWcuY3VycmVudC5oZWFkZXJOYW1lIV06IGN1cnJlbnRUb2tlbixcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfSxcbiAgICBbdG9rZW5dXG4gICk7XG5cbiAgY29uc3QgYWRkVG9Gb3JtID0gdXNlQ2FsbGJhY2soXG4gICAgKGZvcm06IEhUTUxGb3JtRWxlbWVudCk6IHZvaWQgPT4ge1xuICAgICAgY29uc3QgY3VycmVudFRva2VuID0gdG9rZW5SZWYuY3VycmVudCB8fCB0b2tlbjtcbiAgICAgIGlmICghY3VycmVudFRva2VuKSByZXR1cm47XG5cbiAgICAgIGxldCBpbnB1dCA9IGZvcm0ucXVlcnlTZWxlY3RvcihcbiAgICAgICAgYGlucHV0W25hbWU9XCIke2N1cnJlbnRDb25maWcuY3VycmVudC5wYXJhbWV0ZXJOYW1lfVwiXWBcbiAgICAgICkgYXMgSFRNTElucHV0RWxlbWVudDtcblxuICAgICAgaWYgKCFpbnB1dCkge1xuICAgICAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICAgIGlucHV0LnR5cGUgPSAnaGlkZGVuJztcbiAgICAgICAgaW5wdXQubmFtZSA9IGN1cnJlbnRDb25maWcuY3VycmVudC5wYXJhbWV0ZXJOYW1lITtcbiAgICAgICAgZm9ybS5hcHBlbmRDaGlsZChpbnB1dCk7XG4gICAgICB9XG5cbiAgICAgIGlucHV0LnZhbHVlID0gY3VycmVudFRva2VuO1xuICAgIH0sXG4gICAgW3Rva2VuXVxuICApO1xuXG4gIGNvbnN0IGFkZFRvVVJMID0gdXNlQ2FsbGJhY2soXG4gICAgKHVybDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRUb2tlbiA9IHRva2VuUmVmLmN1cnJlbnQgfHwgdG9rZW47XG4gICAgICBpZiAoIWN1cnJlbnRUb2tlbikgcmV0dXJuIHVybDtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXJsT2JqID0gbmV3IFVSTCh1cmwsIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4pO1xuICAgICAgICB1cmxPYmouc2VhcmNoUGFyYW1zLnNldChjdXJyZW50Q29uZmlnLmN1cnJlbnQucGFyYW1ldGVyTmFtZSEsIGN1cnJlbnRUb2tlbik7XG4gICAgICAgIHJldHVybiB1cmxPYmoudG9TdHJpbmcoKTtcbiAgICAgIH0gY2F0Y2gge1xuICAgICAgICByZXR1cm4gdXJsO1xuICAgICAgfVxuICAgIH0sXG4gICAgW3Rva2VuXVxuICApO1xuXG4gIGNvbnN0IGNvbnRleHRWYWx1ZTogQ1NSRkNvbnRleHRUeXBlID0ge1xuICAgIHRva2VuLFxuICAgIGdlbmVyYXRlVG9rZW4sXG4gICAgdmFsaWRhdGVUb2tlbixcbiAgICByZWZyZXNoVG9rZW5zLFxuICAgIGNsZWFyVG9rZW5zLFxuICAgIGFkZFRvUmVxdWVzdCxcbiAgICBhZGRUb0Zvcm0sXG4gICAgYWRkVG9VUkwsXG4gICAgY29uZmlnOiBjdXJyZW50Q29uZmlnLmN1cnJlbnQsXG4gIH07XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoY3VycmVudENvbmZpZy5jdXJyZW50LnJlZ2VuZXJhdGVPbkxvYWQpIHtcbiAgICAgIGdlbmVyYXRlVG9rZW4oKTtcbiAgICB9XG4gIH0sIFtnZW5lcmF0ZVRva2VuXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoY3VycmVudENvbmZpZy5jdXJyZW50LnN0b3JhZ2VUeXBlID09PSAnc2Vzc2lvbicpIHtcbiAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oY3VycmVudENvbmZpZy5jdXJyZW50LnRva2VuTmFtZSEsIHRva2VuIHx8ICcnKTtcbiAgICB9IGVsc2UgaWYgKGN1cnJlbnRDb25maWcuY3VycmVudC5zdG9yYWdlVHlwZSA9PT0gJ2xvY2FsJykge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oY3VycmVudENvbmZpZy5jdXJyZW50LnRva2VuTmFtZSEsIHRva2VuIHx8ICcnKTtcbiAgICB9XG4gIH0sIFt0b2tlbl0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgbGV0IG5lZWRzUmVmcmVzaCA9IGZhbHNlO1xuXG4gICAgICB0b2tlbnMuZm9yRWFjaCgodG9rZW5EYXRhLCB0b2tlbktleSkgPT4ge1xuICAgICAgICBpZiAobm93ID4gdG9rZW5EYXRhLmV4cGlyZXMpIHtcbiAgICAgICAgICBzZXRUb2tlbnMoKHByZXYpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5leHQgPSBuZXcgTWFwKHByZXYpO1xuICAgICAgICAgICAgbmV4dC5kZWxldGUodG9rZW5LZXkpO1xuICAgICAgICAgICAgcmV0dXJuIG5leHQ7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgbmVlZHNSZWZyZXNoID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChuZWVkc1JlZnJlc2gpIHtcbiAgICAgICAgZ2VuZXJhdGVUb2tlbigpO1xuICAgICAgfVxuICAgIH0sIGN1cnJlbnRDb25maWcuY3VycmVudC5leHBpcmF0aW9uVGltZSEgLyAyKTtcblxuICAgIHJldHVybiAoKSA9PiBjbGVhckludGVydmFsKGludGVydmFsKTtcbiAgfSwgW3Rva2VucywgZ2VuZXJhdGVUb2tlbl0pO1xuXG4gIHJldHVybiA8Q1NSRkNvbnRleHQuUHJvdmlkZXIgdmFsdWU9e2NvbnRleHRWYWx1ZX0+e2NoaWxkcmVufTwvQ1NSRkNvbnRleHQuUHJvdmlkZXI+O1xufTtcblxuZXhwb3J0IGNvbnN0IHVzZUNTUkYgPSAoKTogQ1NSRkNvbnRleHRUeXBlID0+IHtcbiAgY29uc3QgY29udGV4dCA9IHVzZUNvbnRleHQoQ1NSRkNvbnRleHQpO1xuICBpZiAoIWNvbnRleHQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3VzZUNTUkYgbXVzdCBiZSB1c2VkIHdpdGhpbiBhIENTUkZQcm92aWRlcicpO1xuICB9XG4gIHJldHVybiBjb250ZXh0O1xufTtcblxuZXhwb3J0IGNvbnN0IENTUkZQcm90ZWN0ZWRGb3JtOiBSZWFjdC5GQzxcbiAge1xuICAgIGNoaWxkcmVuOiBSZWFjdC5SZWFjdE5vZGU7XG4gICAgb25TdWJtaXQ6IChlOiBSZWFjdC5Gb3JtRXZlbnQ8SFRNTEZvcm1FbGVtZW50PikgPT4gdm9pZDtcbiAgICBtZXRob2Q/OiAnR0VUJyB8ICdQT1NUJyB8ICdQVVQnIHwgJ0RFTEVURScgfCAnUEFUQ0gnO1xuICAgIGFjdGlvbj86IHN0cmluZztcbiAgICBjbGFzc05hbWU/OiBzdHJpbmc7XG4gIH0gJiBSZWFjdC5Gb3JtSFRNTEF0dHJpYnV0ZXM8SFRNTEZvcm1FbGVtZW50PlxuPiA9ICh7IGNoaWxkcmVuLCBvblN1Ym1pdCwgbWV0aG9kID0gJ1BPU1QnLCBhY3Rpb24sIGNsYXNzTmFtZSwgLi4ucHJvcHMgfSkgPT4ge1xuICBjb25zdCB7IGFkZFRvRm9ybSB9ID0gdXNlQ1NSRigpO1xuICBjb25zdCBmb3JtUmVmID0gdXNlUmVmPEhUTUxGb3JtRWxlbWVudD4obnVsbCk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoZm9ybVJlZi5jdXJyZW50KSB7XG4gICAgICBhZGRUb0Zvcm0oZm9ybVJlZi5jdXJyZW50KTtcbiAgICB9XG4gIH0sIFthZGRUb0Zvcm1dKTtcblxuICBjb25zdCBoYW5kbGVTdWJtaXQgPSB1c2VDYWxsYmFjayhcbiAgICAoZTogUmVhY3QuRm9ybUV2ZW50PEhUTUxGb3JtRWxlbWVudD4pID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIG9uU3VibWl0KGUpO1xuICAgIH0sXG4gICAgW29uU3VibWl0XVxuICApO1xuXG4gIHJldHVybiAoXG4gICAgPGZvcm1cbiAgICAgIHJlZj17Zm9ybVJlZn1cbiAgICAgIG1ldGhvZD17bWV0aG9kfVxuICAgICAgYWN0aW9uPXthY3Rpb259XG4gICAgICBvblN1Ym1pdD17aGFuZGxlU3VibWl0fVxuICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWV9XG4gICAgICB7Li4ucHJvcHN9XG4gICAgPlxuICAgICAge2NoaWxkcmVufVxuICAgIDwvZm9ybT5cbiAgKTtcbn07XG5cbmV4cG9ydCBjb25zdCBDU1JGUHJvdGVjdGVkRmV0Y2ggPSBhc3luYyAoXG4gIHVybDogc3RyaW5nLFxuICBvcHRpb25zOiBSZXF1ZXN0Q29uZmlnID0ge30sXG4gIGNzcmZDb250ZXh0OiBDU1JGQ29udGV4dFR5cGVcbik6IFByb21pc2U8UmVzcG9uc2U+ID0+IHtcbiAgY29uc3QgcHJvdGVjdGVkT3B0aW9ucyA9IGNzcmZDb250ZXh0LmFkZFRvUmVxdWVzdChvcHRpb25zKTtcbiAgcmV0dXJuIGZldGNoKHVybCwgcHJvdGVjdGVkT3B0aW9ucyBhcyBSZXF1ZXN0SW5pdCk7XG59O1xuXG5leHBvcnQgY29uc3Qgd2l0aENTUkZQcm90ZWN0aW9uID0gPFAgZXh0ZW5kcyBvYmplY3Q+KFxuICBDb21wb25lbnQ6IFJlYWN0LkNvbXBvbmVudFR5cGU8UD4sXG4gIGNvbmZpZz86IFBhcnRpYWw8Q1NSRkNvbmZpZz5cbikgPT4ge1xuICBjb25zdCBXcmFwcGVkQ29tcG9uZW50ID0gKHByb3BzOiBQKSA9PiAoXG4gICAgPENTUkZQcm92aWRlciBjb25maWc9e2NvbmZpZ30+XG4gICAgICA8Q29tcG9uZW50IHsuLi5wcm9wc30gLz5cbiAgICA8L0NTUkZQcm92aWRlcj5cbiAgKTtcblxuICBXcmFwcGVkQ29tcG9uZW50LmRpc3BsYXlOYW1lID0gYHdpdGhDU1JGUHJvdGVjdGlvbigke0NvbXBvbmVudC5kaXNwbGF5TmFtZSB8fCBDb21wb25lbnQubmFtZX0pYDtcbiAgcmV0dXJuIFdyYXBwZWRDb21wb25lbnQ7XG59O1xuXG5leHBvcnQgY29uc3QgY3JlYXRlQ1NSRk1pZGRsZXdhcmUgPSAoY3NyZkNvbnRleHQ6IENTUkZDb250ZXh0VHlwZSkgPT4ge1xuICByZXR1cm4ge1xuICAgIGZldGNoOiAodXJsOiBzdHJpbmcsIG9wdGlvbnM/OiBSZXF1ZXN0Q29uZmlnKTogUHJvbWlzZTxSZXNwb25zZT4gPT4ge1xuICAgICAgcmV0dXJuIENTUkZQcm90ZWN0ZWRGZXRjaCh1cmwsIG9wdGlvbnMgfHwge30sIGNzcmZDb250ZXh0KTtcbiAgICB9LFxuICAgIFhNTEh0dHBSZXF1ZXN0OiAoKSA9PiB7XG4gICAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgIGNvbnN0IG9yaWdpbmFsT3BlbiA9IHhoci5vcGVuLmJpbmQoeGhyKTtcbiAgICAgIGNvbnN0IG9yaWdpbmFsU2V0UmVxdWVzdEhlYWRlciA9IHhoci5zZXRSZXF1ZXN0SGVhZGVyLmJpbmQoeGhyKTtcblxuICAgICAgeGhyLm9wZW4gPSBmdW5jdGlvbiAoXG4gICAgICAgIG1ldGhvZDogc3RyaW5nLFxuICAgICAgICB1cmw6IHN0cmluZyB8IFVSTCxcbiAgICAgICAgYXN5bmM/OiBib29sZWFuLFxuICAgICAgICB1c2VyPzogc3RyaW5nIHwgbnVsbCxcbiAgICAgICAgcGFzc3dvcmQ/OiBzdHJpbmcgfCBudWxsXG4gICAgICApIHtcbiAgICAgICAgbGV0IHVybFN0cjogc3RyaW5nO1xuICAgICAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICB1cmxTdHIgPSB1cmw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdXJsU3RyID0gdXJsLnRvU3RyaW5nKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsT3BlbihtZXRob2QsIHVybFN0ciwgYXN5bmMgPz8gdHJ1ZSwgdXNlciA/PyBudWxsLCBwYXNzd29yZCA/PyBudWxsKTtcbiAgICAgIH07XG5cbiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyID0gZnVuY3Rpb24gKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gb3JpZ2luYWxTZXRSZXF1ZXN0SGVhZGVyKG5hbWUsIHZhbHVlKTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG9yaWdpbmFsU2VuZCA9IHhoci5zZW5kLmJpbmQoeGhyKTtcbiAgICAgIHhoci5zZW5kID0gZnVuY3Rpb24gKGJvZHk/OiBDU1JGUmVxdWVzdEJvZHkpIHtcbiAgICAgICAgY29uc3QgdG9rZW4gPSBjc3JmQ29udGV4dC50b2tlbjtcbiAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgdGhpcy5zZXRSZXF1ZXN0SGVhZGVyKGNzcmZDb250ZXh0LmNvbmZpZy5oZWFkZXJOYW1lISwgdG9rZW4pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvcmlnaW5hbFNlbmQoYm9keSA/PyBudWxsKTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiB4aHI7XG4gICAgfSxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCB2YWxpZGF0ZUNTUkZUb2tlbiA9IChcbiAgcmVxdWVzdDogUmVxdWVzdCxcbiAgdG9rZW46IHN0cmluZyB8IG51bGwsXG4gIGNvbmZpZzogQ1NSRkNvbmZpZ1xuKTogYm9vbGVhbiA9PiB7XG4gIGNvbnN0IG1ldGhvZCA9IHJlcXVlc3QubWV0aG9kLnRvVXBwZXJDYXNlKCk7XG4gIGNvbnN0IHNhZmVNZXRob2RzID0gWydHRVQnLCAnSEVBRCcsICdPUFRJT05TJywgJ1RSQUNFJ107XG5cbiAgaWYgKHNhZmVNZXRob2RzLmluY2x1ZGVzKG1ldGhvZCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGlmICghdG9rZW4pIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBoZWFkZXJUb2tlbiA9IHJlcXVlc3QuaGVhZGVycy5nZXQoY29uZmlnLmhlYWRlck5hbWUhKTtcbiAgY29uc3QgdXJsID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XG4gIGNvbnN0IHBhcmFtVG9rZW4gPSB1cmwuc2VhcmNoUGFyYW1zLmdldChjb25maWcucGFyYW1ldGVyTmFtZSEpO1xuXG4gIHJldHVybiBoZWFkZXJUb2tlbiA9PT0gdG9rZW4gfHwgcGFyYW1Ub2tlbiA9PT0gdG9rZW47XG59O1xuXG5leHBvcnQgY29uc3QgY3JlYXRlU3RyaWN0Q29uZmlnID0gKCk6IFBhcnRpYWw8Q1NSRkNvbmZpZz4gPT4gKHtcbiAgdG9rZW5MZW5ndGg6IDY0LFxuICBleHBpcmF0aW9uVGltZTogMTgwMDAwMCxcbiAgcmVxdWlyZVNhbWVzaXRlOiAnc3RyaWN0JyxcbiAgcmVxdWlyZVNlY3VyZTogdHJ1ZSxcbiAgZG91YmxlU3VibWl0Q29va2llOiB0cnVlLFxuICByZWdlbmVyYXRlT25Mb2FkOiB0cnVlLFxuICBzdG9yYWdlVHlwZTogJ3Nlc3Npb24nLFxufSk7XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVNb2RlcmF0ZUNvbmZpZyA9ICgpOiBQYXJ0aWFsPENTUkZDb25maWc+ID0+ICh7XG4gIHRva2VuTGVuZ3RoOiAzMixcbiAgZXhwaXJhdGlvblRpbWU6IDM2MDAwMDAsXG4gIHJlcXVpcmVTYW1lc2l0ZTogJ2xheCcsXG4gIHJlcXVpcmVTZWN1cmU6IHRydWUsXG4gIGRvdWJsZVN1Ym1pdENvb2tpZTogdHJ1ZSxcbiAgcmVnZW5lcmF0ZU9uTG9hZDogZmFsc2UsXG4gIHN0b3JhZ2VUeXBlOiAnbWVtb3J5Jyxcbn0pO1xuXG5leHBvcnQgY29uc3QgY3JlYXRlUGVybWlzc2l2ZUNvbmZpZyA9ICgpOiBQYXJ0aWFsPENTUkZDb25maWc+ID0+ICh7XG4gIHRva2VuTGVuZ3RoOiAxNixcbiAgZXhwaXJhdGlvblRpbWU6IDcyMDAwMDAsXG4gIHJlcXVpcmVTYW1lc2l0ZTogJ2xheCcsXG4gIHJlcXVpcmVTZWN1cmU6IGZhbHNlLFxuICBkb3VibGVTdWJtaXRDb29raWU6IGZhbHNlLFxuICByZWdlbmVyYXRlT25Mb2FkOiBmYWxzZSxcbiAgc3RvcmFnZVR5cGU6ICdsb2NhbCcsXG59KTtcblxuZXhwb3J0IGRlZmF1bHQge1xuICBDU1JGUHJvdmlkZXIsXG4gIHVzZUNTUkYsXG4gIENTUkZQcm90ZWN0ZWRGb3JtLFxuICBDU1JGUHJvdGVjdGVkRmV0Y2gsXG4gIHdpdGhDU1JGUHJvdGVjdGlvbixcbiAgY3JlYXRlQ1NSRk1pZGRsZXdhcmUsXG4gIHZhbGlkYXRlQ1NSRlRva2VuLFxuICBjcmVhdGVTdHJpY3RDb25maWcsXG4gIGNyZWF0ZU1vZGVyYXRlQ29uZmlnLFxuICBjcmVhdGVQZXJtaXNzaXZlQ29uZmlnLFxufTtcbiJdLCJ2ZXJzaW9uIjozfQ==