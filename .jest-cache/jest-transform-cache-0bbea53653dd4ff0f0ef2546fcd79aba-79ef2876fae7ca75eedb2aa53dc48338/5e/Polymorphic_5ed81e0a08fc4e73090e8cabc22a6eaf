3cd1371b344c29a3d1af47ca1d6fb2e3
"use strict";
/**
 * @file 多态组件基础设施
 * @description 提供多态组件支持，允许组件使用 asChild 模式和动态元素类型
 * @module components/Polymorphic
 * @author YYC³
 * @version 1.0.0
 * @created 2026-02-19
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.withAsChild = exports.polymorphic = exports.createAsChildComponent = exports.overrideProps = exports.mergeProps = exports.createSlot = exports.Slot = exports.createPolymorphicComponent = void 0;
const react_1 = __importStar(require("react"));
const createPolymorphicComponent = (displayName) => {
    const Component = (0, react_1.forwardRef)((props, ref) => {
        const { as, children, ...rest } = props;
        const ElementType = (as || 'div');
        return react_1.default.createElement(ElementType, { ...rest, ref }, children);
    });
    Component.displayName = displayName;
    return Component;
};
exports.createPolymorphicComponent = createPolymorphicComponent;
const Slot = ({ asChild = false, as, children, ...rest }) => {
    const ElementType = asChild ? children?.type : as || 'div';
    const Child = asChild
        ? children
        : react_1.default.createElement(ElementType, rest, children);
    if (!react_1.default.isValidElement(Child)) {
        return Child;
    }
    const childRef = Child.ref;
    return react_1.default.cloneElement(Child, {
        ...rest,
        ref: (refValue) => {
            if (childRef) {
                if (typeof childRef === 'function') {
                    childRef(refValue);
                }
                else {
                    childRef.current = refValue;
                }
            }
        },
    });
};
exports.Slot = Slot;
exports.Slot.displayName = 'Slot';
const createSlot = (displayName) => {
    const SlotComponent = exports.Slot;
    SlotComponent.displayName =
        displayName;
    return SlotComponent;
};
exports.createSlot = createSlot;
const mergeProps = (source, target) => {
    return { ...source, ...target };
};
exports.mergeProps = mergeProps;
const overrideProps = (base, overrides) => {
    return { ...base, ...overrides };
};
exports.overrideProps = overrideProps;
const createAsChildComponent = (displayName, render) => {
    const Component = (0, react_1.forwardRef)((props, ref) => {
        return render({ ...props, ref });
    });
    Component.displayName = displayName;
    return Component;
};
exports.createAsChildComponent = createAsChildComponent;
const polymorphic = (displayName) => {
    return (0, exports.createPolymorphicComponent)(displayName);
};
exports.polymorphic = polymorphic;
const withAsChild = (_WrappedComponent, displayName) => {
    const Wrapped = react_1.default.forwardRef((props, ref) => {
        const propsRecord = props;
        const { asChild, as, ...rest } = propsRecord;
        const restProps = rest;
        if (asChild && react_1.default.isValidElement(propsRecord.children)) {
            const child = propsRecord.children;
            const childRef = child.ref;
            return react_1.default.cloneElement(child, {
                ...restProps,
                ref: (childRefValue) => {
                    if (childRefValue) {
                        if (typeof childRef === 'function') {
                            childRef(childRefValue);
                        }
                        else if (childRef) {
                            childRef.current = childRefValue;
                        }
                    }
                },
            });
        }
        const ElementType = (as || 'div');
        return react_1.default.createElement(ElementType, { ...restProps, ref }, propsRecord.children);
    });
    Wrapped.displayName = displayName;
    return Wrapped;
};
exports.withAsChild = withAsChild;
exports.default = {
    createPolymorphicComponent: exports.createPolymorphicComponent,
    Slot: exports.Slot,
    createSlot: exports.createSlot,
    mergeProps: exports.mergeProps,
    overrideProps: exports.overrideProps,
    createAsChildComponent: exports.createAsChildComponent,
    polymorphic: exports.polymorphic,
    withAsChild: exports.withAsChild,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3lhbnl1L0Rvd25sb2Fkcy95eWMzLURlc2lnbi1TeXN0ZW0vc3JjL2NvbXBvbmVudHMvUG9seW1vcnBoaWMudHN4IiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCwrQ0FBdUQ7QUFpQmhELE1BQU0sMEJBQTBCLEdBQUcsQ0FBQyxXQUFtQixFQUFFLEVBQUU7SUFDaEUsTUFBTSxTQUFTLEdBQUcsSUFBQSxrQkFBVSxFQUMxQixDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUNiLE1BQU0sRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDO1FBQ3hDLE1BQU0sV0FBVyxHQUFHLENBQUMsRUFBRSxJQUFJLEtBQUssQ0FBZ0IsQ0FBQztRQUVqRCxPQUFPLGVBQUssQ0FBQyxhQUFhLENBQUMsV0FBVyxFQUFFLEVBQUUsR0FBRyxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUUsUUFBMkIsQ0FBQyxDQUFDO0lBQ3pGLENBQUMsQ0FDRixDQUFDO0lBRUYsU0FBUyxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7SUFFcEMsT0FBTyxTQUdOLENBQUM7QUFDSixDQUFDLENBQUM7QUFoQlcsUUFBQSwwQkFBMEIsOEJBZ0JyQztBQUVLLE1BQU0sSUFBSSxHQUFHLENBQWdDLEVBQ2xELE9BQU8sR0FBRyxLQUFLLEVBQ2YsRUFBRSxFQUNGLFFBQVEsRUFDUixHQUFHLElBQUksRUFDZ0MsRUFBRSxFQUFFO0lBQzNDLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUUsUUFBK0IsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxLQUFLLENBQUM7SUFDbkYsTUFBTSxLQUFLLEdBQUcsT0FBTztRQUNuQixDQUFDLENBQUMsUUFBUTtRQUNWLENBQUMsQ0FBQyxlQUFLLENBQUMsYUFBYSxDQUFDLFdBQVcsRUFBRSxJQUFJLEVBQUUsUUFBMkIsQ0FBQyxDQUFDO0lBRXhFLElBQUksQ0FBQyxlQUFLLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDakMsT0FBTyxLQUEyQixDQUFDO0lBQ3JDLENBQUM7SUFFRCxNQUFNLFFBQVEsR0FBSSxLQUEyRCxDQUFDLEdBQUcsQ0FBQztJQUVsRixPQUFPLGVBQUssQ0FBQyxZQUFZLENBQUMsS0FBb0QsRUFBRTtRQUM5RSxHQUFHLElBQUk7UUFDUCxHQUFHLEVBQUUsQ0FBQyxRQUE0QixFQUFFLEVBQUU7WUFDcEMsSUFBSSxRQUFRLEVBQUUsQ0FBQztnQkFDYixJQUFJLE9BQU8sUUFBUSxLQUFLLFVBQVUsRUFBRSxDQUFDO29CQUNuQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3JCLENBQUM7cUJBQU0sQ0FBQztvQkFDTCxRQUE0QyxDQUFDLE9BQU8sR0FBRyxRQUFRLENBQUM7Z0JBQ25FLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQztLQUNGLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQztBQTdCVyxRQUFBLElBQUksUUE2QmY7QUFFRixZQUFJLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQztBQUVuQixNQUFNLFVBQVUsR0FBRyxDQUFnQyxXQUFtQixFQUFFLEVBQUU7SUFDL0UsTUFBTSxhQUFhLEdBQUcsWUFBbUUsQ0FBQztJQUN6RixhQUE2RSxDQUFDLFdBQVc7UUFDeEYsV0FBVyxDQUFDO0lBQ2QsT0FBTyxhQUFhLENBQUM7QUFDdkIsQ0FBQyxDQUFDO0FBTFcsUUFBQSxVQUFVLGNBS3JCO0FBRUssTUFBTSxVQUFVLEdBQUcsQ0FBTyxNQUFTLEVBQUUsTUFBUyxFQUFvQixFQUFFO0lBQ3pFLE9BQU8sRUFBRSxHQUFHLE1BQU0sRUFBRSxHQUFHLE1BQU0sRUFBc0IsQ0FBQztBQUN0RCxDQUFDLENBQUM7QUFGVyxRQUFBLFVBQVUsY0FFckI7QUFFSyxNQUFNLGFBQWEsR0FBRyxDQUFPLElBQU8sRUFBRSxTQUFxQixFQUF1QixFQUFFO0lBQ3pGLE9BQU8sRUFBRSxHQUFHLElBQUksRUFBRSxHQUFHLFNBQVMsRUFBeUIsQ0FBQztBQUMxRCxDQUFDLENBQUM7QUFGVyxRQUFBLGFBQWEsaUJBRXhCO0FBRUssTUFBTSxzQkFBc0IsR0FBRyxDQUNwQyxXQUFtQixFQUNuQixNQUF3QyxFQUN4QyxFQUFFO0lBQ0YsTUFBTSxTQUFTLEdBQUcsSUFBQSxrQkFBVSxFQUFpQixDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUMxRCxPQUFPLE1BQU0sQ0FBQyxFQUFFLEdBQUcsS0FBSyxFQUFFLEdBQUcsRUFBTyxDQUFDLENBQUM7SUFDeEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztJQUVwQyxPQUFPLFNBQWlELENBQUM7QUFDM0QsQ0FBQyxDQUFDO0FBWFcsUUFBQSxzQkFBc0IsMEJBV2pDO0FBRUssTUFBTSxXQUFXLEdBQUcsQ0FDekIsV0FBbUIsRUFDUyxFQUFFO0lBQzlCLE9BQU8sSUFBQSxrQ0FBMEIsRUFBQyxXQUFXLENBQStCLENBQUM7QUFDL0UsQ0FBQyxDQUFDO0FBSlcsUUFBQSxXQUFXLGVBSXRCO0FBRUssTUFBTSxXQUFXLEdBQUcsQ0FDekIsaUJBQXlDLEVBQ3pDLFdBQW1CLEVBQ25CLEVBQUU7SUFDRixNQUFNLE9BQU8sR0FBRyxlQUFLLENBQUMsVUFBVSxDQUFpQixDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUM5RCxNQUFNLFdBQVcsR0FBRyxLQUFnQyxDQUFDO1FBQ3JELE1BQU0sRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFLEdBQUcsSUFBSSxFQUFFLEdBQUcsV0FBVyxDQUFDO1FBQzdDLE1BQU0sU0FBUyxHQUFHLElBQWlDLENBQUM7UUFFcEQsSUFBSSxPQUFPLElBQUksZUFBSyxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztZQUMxRCxNQUFNLEtBQUssR0FBRyxXQUFXLENBQUMsUUFBOEIsQ0FBQztZQUN6RCxNQUFNLFFBQVEsR0FBSSxLQUEyRCxDQUFDLEdBQUcsQ0FBQztZQUVsRixPQUFPLGVBQUssQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFO2dCQUMvQixHQUFHLFNBQVM7Z0JBQ1osR0FBRyxFQUFFLENBQUMsYUFBaUMsRUFBRSxFQUFFO29CQUN6QyxJQUFJLGFBQWEsRUFBRSxDQUFDO3dCQUNsQixJQUFJLE9BQU8sUUFBUSxLQUFLLFVBQVUsRUFBRSxDQUFDOzRCQUNuQyxRQUFRLENBQUMsYUFBYSxDQUFDLENBQUM7d0JBQzFCLENBQUM7NkJBQU0sSUFBSSxRQUFRLEVBQUUsQ0FBQzs0QkFDbkIsUUFBNEMsQ0FBQyxPQUFPLEdBQUcsYUFBYSxDQUFDO3dCQUN4RSxDQUFDO29CQUNILENBQUM7Z0JBQ0gsQ0FBQzthQUNGLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCxNQUFNLFdBQVcsR0FBRyxDQUFDLEVBQUUsSUFBSSxLQUFLLENBQWdCLENBQUM7UUFDakQsT0FBTyxlQUFLLENBQUMsYUFBYSxDQUN4QixXQUFXLEVBQ1gsRUFBRSxHQUFHLFNBQVMsRUFBRSxHQUFHLEVBQUUsRUFDckIsV0FBVyxDQUFDLFFBQTJCLENBQ3hDLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO0lBRWxDLE9BQU8sT0FBcUMsQ0FBQztBQUMvQyxDQUFDLENBQUM7QUF0Q1csUUFBQSxXQUFXLGVBc0N0QjtBQUVGLGtCQUFlO0lBQ2IsMEJBQTBCLEVBQTFCLGtDQUEwQjtJQUMxQixJQUFJLEVBQUosWUFBSTtJQUNKLFVBQVUsRUFBVixrQkFBVTtJQUNWLFVBQVUsRUFBVixrQkFBVTtJQUNWLGFBQWEsRUFBYixxQkFBYTtJQUNiLHNCQUFzQixFQUF0Qiw4QkFBc0I7SUFDdEIsV0FBVyxFQUFYLG1CQUFXO0lBQ1gsV0FBVyxFQUFYLG1CQUFXO0NBQ1osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMveWFueXUvRG93bmxvYWRzL3l5YzMtRGVzaWduLVN5c3RlbS9zcmMvY29tcG9uZW50cy9Qb2x5bW9ycGhpYy50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSDlpJrmgIHnu4Tku7bln7rnoYDorr7mlr1cbiAqIEBkZXNjcmlwdGlvbiDmj5DkvpvlpJrmgIHnu4Tku7bmlK/mjIHvvIzlhYHorrjnu4Tku7bkvb/nlKggYXNDaGlsZCDmqKHlvI/lkozliqjmgIHlhYPntKDnsbvlnotcbiAqIEBtb2R1bGUgY29tcG9uZW50cy9Qb2x5bW9ycGhpY1xuICogQGF1dGhvciBZWUPCs1xuICogQHZlcnNpb24gMS4wLjBcbiAqIEBjcmVhdGVkIDIwMjYtMDItMTlcbiAqL1xuXG5pbXBvcnQgUmVhY3QsIHsgRWxlbWVudFR5cGUsIGZvcndhcmRSZWYgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgdHlwZSB7IENvbXBvbmVudFdpdGhSZWYsIE1lcmdlUHJvcHMsIE92ZXJyaWRlUHJvcHMgfSBmcm9tICcuLi90eXBlcy9hZHZhbmNlZC10eXBlcyc7XG5cbmV4cG9ydCB0eXBlIEFzQ2hpbGRQcm9wczxUIGV4dGVuZHMgRWxlbWVudFR5cGU+ID0ge1xuICBhc0NoaWxkPzogYm9vbGVhbjtcbiAgYXM/OiBUO1xufTtcblxuZXhwb3J0IHR5cGUgU2xvdFByb3BzPFQgZXh0ZW5kcyBFbGVtZW50VHlwZSA9ICdkaXYnPiA9IHtcbiAgY2hpbGRyZW4/OiBSZWFjdC5SZWFjdE5vZGU7XG59ICYgQXNDaGlsZFByb3BzPFQ+O1xuXG5leHBvcnQgdHlwZSBQb2x5bW9ycGhpY0NvbXBvbmVudDxcbiAgVCBleHRlbmRzIEVsZW1lbnRUeXBlID0gJ2RpdicsXG4gIFAgZXh0ZW5kcyBvYmplY3QgPSBvYmplY3QsXG4+ID0gQ29tcG9uZW50V2l0aFJlZjxULCBQPjtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZVBvbHltb3JwaGljQ29tcG9uZW50ID0gKGRpc3BsYXlOYW1lOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgQ29tcG9uZW50ID0gZm9yd2FyZFJlZjxFbGVtZW50VHlwZSwgU2xvdFByb3BzPEVsZW1lbnRUeXBlPiAmIFJlY29yZDxzdHJpbmcsIHVua25vd24+PihcbiAgICAocHJvcHMsIHJlZikgPT4ge1xuICAgICAgY29uc3QgeyBhcywgY2hpbGRyZW4sIC4uLnJlc3QgfSA9IHByb3BzO1xuICAgICAgY29uc3QgRWxlbWVudFR5cGUgPSAoYXMgfHwgJ2RpdicpIGFzIEVsZW1lbnRUeXBlO1xuXG4gICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChFbGVtZW50VHlwZSwgeyAuLi5yZXN0LCByZWYgfSwgY2hpbGRyZW4gYXMgUmVhY3QuUmVhY3ROb2RlKTtcbiAgICB9XG4gICk7XG5cbiAgQ29tcG9uZW50LmRpc3BsYXlOYW1lID0gZGlzcGxheU5hbWU7XG5cbiAgcmV0dXJuIENvbXBvbmVudCBhcyBQb2x5bW9ycGhpY0NvbXBvbmVudDxcbiAgICBFbGVtZW50VHlwZSxcbiAgICBTbG90UHJvcHM8RWxlbWVudFR5cGU+ICYgUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbiAgPjtcbn07XG5cbmV4cG9ydCBjb25zdCBTbG90ID0gPFQgZXh0ZW5kcyBFbGVtZW50VHlwZSA9ICdkaXYnPih7XG4gIGFzQ2hpbGQgPSBmYWxzZSxcbiAgYXMsXG4gIGNoaWxkcmVuLFxuICAuLi5yZXN0XG59OiBTbG90UHJvcHM8VD4gJiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikgPT4ge1xuICBjb25zdCBFbGVtZW50VHlwZSA9IGFzQ2hpbGQgPyAoY2hpbGRyZW4gYXMgUmVhY3QuUmVhY3RFbGVtZW50KT8udHlwZSA6IGFzIHx8ICdkaXYnO1xuICBjb25zdCBDaGlsZCA9IGFzQ2hpbGRcbiAgICA/IGNoaWxkcmVuXG4gICAgOiBSZWFjdC5jcmVhdGVFbGVtZW50KEVsZW1lbnRUeXBlLCByZXN0LCBjaGlsZHJlbiBhcyBSZWFjdC5SZWFjdE5vZGUpO1xuXG4gIGlmICghUmVhY3QuaXNWYWxpZEVsZW1lbnQoQ2hpbGQpKSB7XG4gICAgcmV0dXJuIENoaWxkIGFzIFJlYWN0LlJlYWN0RWxlbWVudDtcbiAgfVxuXG4gIGNvbnN0IGNoaWxkUmVmID0gKENoaWxkIGFzIFJlYWN0LlJlYWN0RWxlbWVudCAmIHsgcmVmPzogUmVhY3QuUmVmPHVua25vd24+IH0pLnJlZjtcblxuICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KENoaWxkIGFzIFJlYWN0LlJlYWN0RWxlbWVudDxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4sIHtcbiAgICAuLi5yZXN0LFxuICAgIHJlZjogKHJlZlZhbHVlOiBSZWFjdC5SZWY8dW5rbm93bj4pID0+IHtcbiAgICAgIGlmIChjaGlsZFJlZikge1xuICAgICAgICBpZiAodHlwZW9mIGNoaWxkUmVmID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgY2hpbGRSZWYocmVmVmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIChjaGlsZFJlZiBhcyBSZWFjdC5NdXRhYmxlUmVmT2JqZWN0PHVua25vd24+KS5jdXJyZW50ID0gcmVmVmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICB9KTtcbn07XG5cblNsb3QuZGlzcGxheU5hbWUgPSAnU2xvdCc7XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVTbG90ID0gPFQgZXh0ZW5kcyBFbGVtZW50VHlwZSA9ICdkaXYnPihkaXNwbGF5TmFtZTogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IFNsb3RDb21wb25lbnQgPSBTbG90IGFzIFJlYWN0LkNvbXBvbmVudFR5cGU8U2xvdFByb3BzPFQ+ICYgUmVjb3JkPHN0cmluZywgdW5rbm93bj4+O1xuICAoU2xvdENvbXBvbmVudCBhcyBSZWFjdC5Db21wb25lbnRUeXBlPFNsb3RQcm9wczxUPiAmIFJlY29yZDxzdHJpbmcsIHVua25vd24+PikuZGlzcGxheU5hbWUgPVxuICAgIGRpc3BsYXlOYW1lO1xuICByZXR1cm4gU2xvdENvbXBvbmVudDtcbn07XG5cbmV4cG9ydCBjb25zdCBtZXJnZVByb3BzID0gPFQsIFU+KHNvdXJjZTogVCwgdGFyZ2V0OiBVKTogTWVyZ2VQcm9wczxULCBVPiA9PiB7XG4gIHJldHVybiB7IC4uLnNvdXJjZSwgLi4udGFyZ2V0IH0gYXMgTWVyZ2VQcm9wczxULCBVPjtcbn07XG5cbmV4cG9ydCBjb25zdCBvdmVycmlkZVByb3BzID0gPFQsIE8+KGJhc2U6IFQsIG92ZXJyaWRlczogUGFydGlhbDxPPik6IE92ZXJyaWRlUHJvcHM8VCwgTz4gPT4ge1xuICByZXR1cm4geyAuLi5iYXNlLCAuLi5vdmVycmlkZXMgfSBhcyBPdmVycmlkZVByb3BzPFQsIE8+O1xufTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUFzQ2hpbGRDb21wb25lbnQgPSA8UCBleHRlbmRzIG9iamVjdCA9IG9iamVjdD4oXG4gIGRpc3BsYXlOYW1lOiBzdHJpbmcsXG4gIHJlbmRlcjogKHByb3BzOiBQKSA9PiBSZWFjdC5SZWFjdEVsZW1lbnRcbikgPT4ge1xuICBjb25zdCBDb21wb25lbnQgPSBmb3J3YXJkUmVmPEVsZW1lbnRUeXBlLCBQPigocHJvcHMsIHJlZikgPT4ge1xuICAgIHJldHVybiByZW5kZXIoeyAuLi5wcm9wcywgcmVmIH0gYXMgUCk7XG4gIH0pO1xuXG4gIENvbXBvbmVudC5kaXNwbGF5TmFtZSA9IGRpc3BsYXlOYW1lO1xuXG4gIHJldHVybiBDb21wb25lbnQgYXMgUG9seW1vcnBoaWNDb21wb25lbnQ8RWxlbWVudFR5cGUsIFA+O1xufTtcblxuZXhwb3J0IGNvbnN0IHBvbHltb3JwaGljID0gPFQgZXh0ZW5kcyBFbGVtZW50VHlwZSA9ICdkaXYnLCBQIGV4dGVuZHMgb2JqZWN0ID0gb2JqZWN0PihcbiAgZGlzcGxheU5hbWU6IHN0cmluZ1xuKTogUG9seW1vcnBoaWNDb21wb25lbnQ8VCwgUD4gPT4ge1xuICByZXR1cm4gY3JlYXRlUG9seW1vcnBoaWNDb21wb25lbnQoZGlzcGxheU5hbWUpIGFzIFBvbHltb3JwaGljQ29tcG9uZW50PFQsIFA+O1xufTtcblxuZXhwb3J0IGNvbnN0IHdpdGhBc0NoaWxkID0gPFQgZXh0ZW5kcyBFbGVtZW50VHlwZSA9ICdkaXYnLCBQIGV4dGVuZHMgb2JqZWN0ID0gb2JqZWN0PihcbiAgX1dyYXBwZWRDb21wb25lbnQ6IFJlYWN0LkNvbXBvbmVudFR5cGU8UD4sXG4gIGRpc3BsYXlOYW1lOiBzdHJpbmdcbikgPT4ge1xuICBjb25zdCBXcmFwcGVkID0gUmVhY3QuZm9yd2FyZFJlZjxFbGVtZW50VHlwZSwgUD4oKHByb3BzLCByZWYpID0+IHtcbiAgICBjb25zdCBwcm9wc1JlY29yZCA9IHByb3BzIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgIGNvbnN0IHsgYXNDaGlsZCwgYXMsIC4uLnJlc3QgfSA9IHByb3BzUmVjb3JkO1xuICAgIGNvbnN0IHJlc3RQcm9wcyA9IHJlc3QgYXMgT21pdDxQLCAnYXNDaGlsZCcgfCAnYXMnPjtcblxuICAgIGlmIChhc0NoaWxkICYmIFJlYWN0LmlzVmFsaWRFbGVtZW50KHByb3BzUmVjb3JkLmNoaWxkcmVuKSkge1xuICAgICAgY29uc3QgY2hpbGQgPSBwcm9wc1JlY29yZC5jaGlsZHJlbiBhcyBSZWFjdC5SZWFjdEVsZW1lbnQ7XG4gICAgICBjb25zdCBjaGlsZFJlZiA9IChjaGlsZCBhcyBSZWFjdC5SZWFjdEVsZW1lbnQgJiB7IHJlZj86IFJlYWN0LlJlZjx1bmtub3duPiB9KS5yZWY7XG5cbiAgICAgIHJldHVybiBSZWFjdC5jbG9uZUVsZW1lbnQoY2hpbGQsIHtcbiAgICAgICAgLi4ucmVzdFByb3BzLFxuICAgICAgICByZWY6IChjaGlsZFJlZlZhbHVlOiBSZWFjdC5SZWY8dW5rbm93bj4pID0+IHtcbiAgICAgICAgICBpZiAoY2hpbGRSZWZWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGlsZFJlZiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICBjaGlsZFJlZihjaGlsZFJlZlZhbHVlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hpbGRSZWYpIHtcbiAgICAgICAgICAgICAgKGNoaWxkUmVmIGFzIFJlYWN0Lk11dGFibGVSZWZPYmplY3Q8dW5rbm93bj4pLmN1cnJlbnQgPSBjaGlsZFJlZlZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IEVsZW1lbnRUeXBlID0gKGFzIHx8ICdkaXYnKSBhcyBFbGVtZW50VHlwZTtcbiAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgIEVsZW1lbnRUeXBlLFxuICAgICAgeyAuLi5yZXN0UHJvcHMsIHJlZiB9LFxuICAgICAgcHJvcHNSZWNvcmQuY2hpbGRyZW4gYXMgUmVhY3QuUmVhY3ROb2RlXG4gICAgKTtcbiAgfSk7XG5cbiAgV3JhcHBlZC5kaXNwbGF5TmFtZSA9IGRpc3BsYXlOYW1lO1xuXG4gIHJldHVybiBXcmFwcGVkIGFzIFBvbHltb3JwaGljQ29tcG9uZW50PFQsIFA+O1xufTtcblxuZXhwb3J0IGRlZmF1bHQge1xuICBjcmVhdGVQb2x5bW9ycGhpY0NvbXBvbmVudCxcbiAgU2xvdCxcbiAgY3JlYXRlU2xvdCxcbiAgbWVyZ2VQcm9wcyxcbiAgb3ZlcnJpZGVQcm9wcyxcbiAgY3JlYXRlQXNDaGlsZENvbXBvbmVudCxcbiAgcG9seW1vcnBoaWMsXG4gIHdpdGhBc0NoaWxkLFxufTtcbiJdLCJ2ZXJzaW9uIjozfQ==