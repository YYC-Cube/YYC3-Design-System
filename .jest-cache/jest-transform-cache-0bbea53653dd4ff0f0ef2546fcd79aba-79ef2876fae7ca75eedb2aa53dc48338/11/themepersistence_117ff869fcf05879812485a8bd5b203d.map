{"file":"/Users/yanyu/Downloads/yyc3-Design-System/src/utils/theme-persistence.ts","mappings":"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","names":[],"sources":["/Users/yanyu/Downloads/yyc3-Design-System/src/utils/theme-persistence.ts"],"sourcesContent":["/**\n * @file 主题持久化工具\n * @description YYC³ 设计系统主题持久化工具，提供localStorage主题存储和管理\n * @module utils/theme-persistence\n * @author YYC³\n * @version 1.0.0\n * @created 2026-02-21\n */\n\nconst THEME_KEY = 'yyc3-theme';\nconst THEME_VERSION_KEY = 'yyc3-theme-version';\nconst CURRENT_THEME_VERSION = '1.0.0';\n\nexport type ThemeMode = 'light' | 'dark' | 'system';\n\nexport interface ThemeConfig {\n  mode: ThemeMode;\n  version: string;\n  timestamp: number;\n}\n\nexport const getSystemTheme = (): ThemeMode => {\n  if (typeof window === 'undefined') return 'light';\n\n  const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n  return mediaQuery.matches ? 'dark' : 'light';\n};\n\nexport const getStoredTheme = (): ThemeMode => {\n  if (typeof window === 'undefined') return 'light';\n\n  try {\n    const stored = localStorage.getItem(THEME_KEY);\n    if (stored) {\n      const config: ThemeConfig = JSON.parse(stored);\n\n      if (config.version !== CURRENT_THEME_VERSION) {\n        migrateTheme(config.version);\n        return 'light';\n      }\n\n      if (config.mode === 'system') {\n        return getSystemTheme();\n      }\n\n      return config.mode;\n    }\n  } catch (e) {\n    console.warn('Failed to read theme from localStorage:', e);\n  }\n\n  return 'light';\n};\n\nexport const setStoredTheme = (mode: ThemeMode): void => {\n  if (typeof window === 'undefined') return;\n\n  try {\n    const config: ThemeConfig = {\n      mode,\n      version: CURRENT_THEME_VERSION,\n      timestamp: Date.now(),\n    };\n\n    localStorage.setItem(THEME_KEY, JSON.stringify(config));\n    localStorage.setItem(THEME_VERSION_KEY, CURRENT_THEME_VERSION);\n\n    document.documentElement.setAttribute('data-theme', mode);\n\n    if (mode === 'system') {\n      const systemTheme = getSystemTheme();\n      document.documentElement.setAttribute('data-theme', systemTheme);\n    }\n  } catch (e) {\n    console.warn('Failed to save theme to localStorage:', e);\n  }\n};\n\nexport const clearStoredTheme = (): void => {\n  if (typeof window === 'undefined') return;\n\n  try {\n    localStorage.removeItem(THEME_KEY);\n    localStorage.removeItem(THEME_VERSION_KEY);\n    document.documentElement.removeAttribute('data-theme');\n  } catch (e) {\n    console.warn('Failed to clear theme from localStorage:', e);\n  }\n};\n\nexport const migrateTheme = (fromVersion: string): void => {\n  console.warn(`Migrating theme from version ${fromVersion} to ${CURRENT_THEME_VERSION}`);\n\n  try {\n    const stored = localStorage.getItem(THEME_KEY);\n    if (stored) {\n      const config: ThemeConfig = JSON.parse(stored);\n      config.version = CURRENT_THEME_VERSION;\n      localStorage.setItem(THEME_KEY, JSON.stringify(config));\n    }\n  } catch (e) {\n    console.warn('Failed to migrate theme:', e);\n  }\n};\n\nexport const syncThemeWithSystem = (): void => {\n  if (typeof window === 'undefined') return;\n\n  const stored = localStorage.getItem(THEME_KEY);\n  if (stored) {\n    const config: ThemeConfig = JSON.parse(stored);\n    if (config.mode === 'system') {\n      const systemTheme = getSystemTheme();\n      document.documentElement.setAttribute('data-theme', systemTheme);\n    }\n  }\n};\n\nexport const initThemePersistence = (() => {\n  if (typeof window === 'undefined') return () => {};\n\n  const mode = getStoredTheme();\n  setStoredTheme(mode);\n\n  const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n\n  const handleSystemThemeChange = (e: MediaQueryListEvent): void => {\n    const stored = localStorage.getItem(THEME_KEY);\n    if (stored) {\n      const config: ThemeConfig = JSON.parse(stored);\n      if (config.mode === 'system') {\n        const newTheme = e.matches ? 'dark' : 'light';\n        document.documentElement.setAttribute('data-theme', newTheme);\n        window.dispatchEvent(new CustomEvent('theme-change', { detail: newTheme }));\n      }\n    }\n  };\n\n  mediaQuery.addEventListener('change', handleSystemThemeChange);\n\n  return () => {\n    mediaQuery.removeEventListener('change', handleSystemThemeChange);\n  };\n})();\n\nexport const getThemeInfo = (): ThemeConfig | null => {\n  if (typeof window === 'undefined') return null;\n\n  try {\n    const stored = localStorage.getItem(THEME_KEY);\n    if (stored) {\n      return JSON.parse(stored);\n    }\n  } catch (e) {\n    console.warn('Failed to read theme info from localStorage:', e);\n  }\n\n  return null;\n};\n\nexport const isThemePersisted = (): boolean => {\n  if (typeof window === 'undefined') return false;\n\n  try {\n    return localStorage.getItem(THEME_KEY) !== null;\n  } catch {\n    return false;\n  }\n};\n\nexport default {\n  getSystemTheme,\n  getStoredTheme,\n  setStoredTheme,\n  clearStoredTheme,\n  migrateTheme,\n  syncThemeWithSystem,\n  initThemePersistence,\n  getThemeInfo,\n  isThemePersisted,\n};\n"],"version":3}