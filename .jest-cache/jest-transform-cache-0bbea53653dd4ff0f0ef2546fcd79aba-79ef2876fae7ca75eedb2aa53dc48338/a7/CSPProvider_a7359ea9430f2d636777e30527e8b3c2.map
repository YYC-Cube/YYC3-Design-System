{"file":"/Users/yanyu/Downloads/yyc3-Design-System/src/security/CSPProvider.tsx","mappings":"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","names":[],"sources":["/Users/yanyu/Downloads/yyc3-Design-System/src/security/CSPProvider.tsx"],"sourcesContent":["/**\n * @file CSP Provider 组件\n * @description 内容安全策略提供者，保护应用免受 XSS 攻击\n * @module security/CSPProvider\n * @author YYC³\n * @version 1.0.0\n * @created 2026-02-19\n */\n\nimport React, { createContext, useContext, useEffect, useMemo, useCallback } from 'react';\n\ninterface ExtendedSecurityPolicyViolationEvent extends SecurityPolicyViolationEvent {\n  sourceFile?: string;\n  sourceURI?: string;\n}\n\nexport interface CSPConfig {\n  'default-src'?: string;\n  'script-src'?: string;\n  'style-src'?: string;\n  'img-src'?: string;\n  'font-src'?: string;\n  'connect-src'?: string;\n  'media-src'?: string;\n  'object-src'?: string;\n  'frame-src'?: string;\n  'base-uri'?: string;\n  'form-action'?: string;\n  'frame-ancestors'?: string;\n  'report-uri'?: string;\n  'report-to'?: string;\n  'require-trusted-types-for'?: string;\n  'trusted-types'?: string;\n  'upgrade-insecure-requests'?: boolean;\n  'block-all-mixed-content'?: boolean;\n  [key: string]: string | boolean | undefined;\n}\n\nexport interface CSPProviderProps {\n  children: React.ReactNode;\n  config?: Partial<CSPConfig>;\n  nonce?: string;\n  reportOnly?: boolean;\n  enabled?: boolean;\n  onViolation?: (violation: CSPViolationReport) => void;\n}\n\nexport interface SecurityPolicyViolationEvent extends Event {\n  blockedURI?: string;\n  columnNumber?: number;\n  disposition?: string;\n  documentURI?: string;\n  effectiveDirective?: string;\n  lineNumber?: number;\n  originalPolicy?: string;\n  referrer?: string;\n  sample?: string;\n  statusCode?: number;\n  violatedDirective?: string;\n}\n\nexport interface CSPViolationReport {\n  'csp-report': {\n    'document-uri'?: string;\n    referrer?: string;\n    'blocked-uri'?: string;\n    'violated-directive'?: string;\n    'effective-directive'?: string;\n    'original-policy'?: string;\n    disposition?: string;\n    'script-sample'?: string;\n    'status-code'?: number;\n    'source-file'?: string;\n    'line-number'?: number;\n    'column-number'?: number;\n  };\n}\n\ninterface CSPContextType {\n  nonce?: string;\n  config: CSPConfig;\n  enabled: boolean;\n  updateConfig: (config: Partial<CSPConfig>) => void;\n}\n\nconst CSPContext = createContext<CSPContextType | undefined>(undefined);\n\nconst DEFAULT_CSP_CONFIG: CSPConfig = {\n  'default-src': \"'self'\",\n  'script-src': \"'self' 'unsafe-inline' 'unsafe-eval' https:\",\n  'style-src': \"'self' 'unsafe-inline' https:\",\n  'img-src': \"'self' data: https: http:\",\n  'font-src': \"'self' data: https:\",\n  'connect-src': \"'self' https: wss:\",\n  'media-src': \"'self' https:\",\n  'object-src': \"'none'\",\n  'frame-src': \"'self' https:\",\n  'base-uri': \"'self'\",\n  'form-action': \"'self'\",\n  'frame-ancestors': \"'none'\",\n  'require-trusted-types-for': \"'script'\",\n  'trusted-types': '*',\n};\n\nconst generateCSPMetaTag = (config: CSPConfig, nonce?: string): string => {\n  const directives: string[] = [];\n\n  for (const [directive, value] of Object.entries(config)) {\n    if (value === true) {\n      directives.push(directive);\n    } else if (value !== undefined && value !== false) {\n      directives.push(`${directive} ${value}`);\n    }\n  }\n\n  if (nonce) {\n    directives.push(`script-src 'nonce-${nonce}'`);\n  }\n\n  return directives.join('; ');\n};\n\nexport const CSPProvider: React.FC<CSPProviderProps> = ({\n  children,\n  config = {},\n  nonce,\n  reportOnly = false,\n  enabled = true,\n  onViolation,\n}) => {\n  const [currentConfig, setCurrentConfig] = React.useState<CSPConfig>({\n    ...DEFAULT_CSP_CONFIG,\n    ...config,\n  });\n\n  const updateConfig = useCallback((newConfig: Partial<CSPConfig>) => {\n    setCurrentConfig((prev) => ({ ...prev, ...newConfig }));\n  }, []);\n\n  const contextValue = useMemo(\n    () => ({\n      nonce,\n      config: currentConfig,\n      enabled,\n      updateConfig,\n    }),\n    [nonce, currentConfig, enabled, updateConfig]\n  );\n\n  useEffect(() => {\n    if (!enabled) return;\n\n    const cspContent = generateCSPMetaTag(currentConfig, nonce);\n    const httpEquiv = reportOnly\n      ? 'Content-Security-Policy-Report-Only'\n      : 'Content-Security-Policy';\n\n    let metaTag: HTMLMetaElement | null = document.querySelector(`meta[http-equiv=\"${httpEquiv}\"]`);\n\n    if (!metaTag) {\n      metaTag = document.createElement('meta');\n      metaTag.setAttribute('http-equiv', httpEquiv);\n      document.head.appendChild(metaTag);\n    }\n\n    metaTag.setAttribute('content', cspContent);\n\n    return () => {\n      if (metaTag && metaTag.parentNode) {\n        metaTag.parentNode.removeChild(metaTag);\n      }\n    };\n  }, [currentConfig, nonce, reportOnly, enabled]);\n\n  useEffect(() => {\n    if (!onViolation || !enabled) return;\n\n    const handleViolation = (event: Event) => {\n      const violation = event as SecurityPolicyViolationEvent;\n\n      const report: CSPViolationReport = {\n        'csp-report': {\n          'document-uri': violation.documentURI,\n          referrer: violation.referrer,\n          'blocked-uri': violation.blockedURI,\n          'violated-directive': violation.violatedDirective,\n          'effective-directive': violation.effectiveDirective,\n          'original-policy': violation.originalPolicy,\n          disposition: violation.disposition,\n          'script-sample': violation.sample,\n          'status-code': violation.statusCode,\n          'source-file':\n            (violation as ExtendedSecurityPolicyViolationEvent).sourceFile ||\n            (violation as ExtendedSecurityPolicyViolationEvent).sourceURI ||\n            '',\n          'line-number': violation.lineNumber,\n          'column-number': violation.columnNumber,\n        },\n      };\n\n      onViolation(report);\n\n      console.warn('CSP Violation detected:', violation);\n    };\n\n    document.addEventListener('securitypolicyviolation', handleViolation);\n\n    return () => {\n      document.removeEventListener('securitypolicyviolation', handleViolation);\n    };\n  }, [onViolation, enabled]);\n\n  return <CSPContext.Provider value={contextValue}>{children}</CSPContext.Provider>;\n};\n\nexport const useCSP = (): CSPContextType => {\n  const context = useContext(CSPContext);\n  if (!context) {\n    throw new Error('useCSP must be used within a CSPProvider');\n  }\n  return context;\n};\n\nexport const CSPScript: React.FC<React.HTMLAttributes<HTMLScriptElement>> = ({\n  children,\n  ...props\n}) => {\n  const { nonce, enabled } = useCSP();\n\n  if (!enabled || !nonce) {\n    return <script {...props}>{children}</script>;\n  }\n\n  return (\n    <script nonce={nonce} {...props}>\n      {children}\n    </script>\n  );\n};\n\nexport const CSPStyle: React.FC<React.HTMLAttributes<HTMLStyleElement>> = ({\n  children,\n  ...props\n}) => {\n  const { nonce, enabled } = useCSP();\n\n  if (!enabled || !nonce) {\n    return <style {...props}>{children}</style>;\n  }\n\n  return (\n    <style nonce={nonce} {...props}>\n      {children}\n    </style>\n  );\n};\n\nexport const CSPImg: React.FC<React.ImgHTMLAttributes<HTMLImageElement>> = ({ ...props }) => {\n  const { config, enabled } = useCSP();\n\n  if (!enabled) {\n    return <img {...props} />;\n  }\n\n  const imgSrc = props.src;\n  const allowedDomains = config['img-src'] || '';\n\n  if (imgSrc && !isURLAllowed(imgSrc, allowedDomains)) {\n    console.warn(`Image source ${imgSrc} may not be allowed by CSP`);\n  }\n\n  return <img {...props} />;\n};\n\nconst isURLAllowed = (url: string, cspDirective: string): boolean => {\n  if (\n    cspDirective.includes(\"'self'\") &&\n    (url.startsWith('/') || url.startsWith(window.location.origin))\n  ) {\n    return true;\n  }\n\n  if (cspDirective.includes('data:') && url.startsWith('data:')) {\n    return true;\n  }\n\n  const httpsAllowed = cspDirective.includes('https:');\n  const httpAllowed = cspDirective.includes('http:');\n\n  if ((httpsAllowed && url.startsWith('https://')) || (httpAllowed && url.startsWith('http://'))) {\n    return true;\n  }\n\n  return false;\n};\n\nexport const createStrictCSPConfig = (): CSPConfig => ({\n  'default-src': \"'self'\",\n  'script-src': \"'self' 'nonce-{nonce}'\",\n  'style-src': \"'self' 'nonce-{nonce}'\",\n  'img-src': \"'self' data: https:\",\n  'font-src': \"'self' data: https:\",\n  'connect-src': \"'self' https: wss:\",\n  'media-src': \"'self'\",\n  'object-src': \"'none'\",\n  'frame-src': \"'none'\",\n  'base-uri': \"'self'\",\n  'form-action': \"'self'\",\n  'frame-ancestors': \"'none'\",\n  'upgrade-insecure-requests': true,\n  'block-all-mixed-content': true,\n});\n\nexport const createModerateCSPConfig = (): CSPConfig => ({\n  'default-src': \"'self'\",\n  'script-src': \"'self' 'unsafe-inline' 'unsafe-eval' https:\",\n  'style-src': \"'self' 'unsafe-inline' https:\",\n  'img-src': \"'self' data: https: http:\",\n  'font-src': \"'self' data: https:\",\n  'connect-src': \"'self' https: wss:\",\n  'media-src': \"'self' https:\",\n  'object-src': \"'none'\",\n  'frame-src': \"'self' https:\",\n  'base-uri': \"'self'\",\n  'form-action': \"'self'\",\n  'frame-ancestors': \"'self'\",\n});\n\nexport const createPermissiveCSPConfig = (): CSPConfig => ({\n  'default-src': \"'self'\",\n  'script-src': \"'self' 'unsafe-inline' 'unsafe-eval' https: http:\",\n  'style-src': \"'self' 'unsafe-inline' https: http:\",\n  'img-src': \"'self' data: https: http: blob:\",\n  'font-src': \"'self' data: https: http:\",\n  'connect-src': \"'self' https: http: wss: ws:\",\n  'media-src': \"'self' https: http:\",\n  'object-src': \"'none'\",\n  'frame-src': \"'self' https: http:\",\n  'base-uri': \"'self'\",\n  'form-action': \"'self'\",\n});\n\nexport const generateNonce = (): string => {\n  return window.crypto.getRandomValues(new Uint32Array(1))[0].toString(36);\n};\n\nexport const withCSP = <P extends object>(\n  Component: React.ComponentType<P>,\n  config?: Partial<CSPConfig>\n) => {\n  const WrappedComponent = (props: P) => (\n    <CSPProvider config={config}>\n      <Component {...props} />\n    </CSPProvider>\n  );\n\n  WrappedComponent.displayName = `withCSP(${Component.displayName || Component.name})`;\n  return WrappedComponent;\n};\n\nexport default {\n  CSPProvider,\n  useCSP,\n  CSPScript,\n  CSPStyle,\n  CSPImg,\n  createStrictCSPConfig,\n  createModerateCSPConfig,\n  createPermissiveCSPConfig,\n  generateNonce,\n  withCSP,\n};\n"],"version":3}