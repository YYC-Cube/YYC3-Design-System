d1c2896d42c7453aa85186d72c318e84
"use strict";
/**
 * @file Service Worker测试
 * @description 测试PWA Service Worker功能
 * @module __tests__/pwa/service-worker.test
 * @author YYC³
 * @version 1.0.0
 * @created 2026-02-19
 */
Object.defineProperty(exports, "__esModule", { value: true });
describe('Service Worker Module', () => {
    beforeEach(() => {
        jest.resetAllMocks();
    });
    afterEach(() => {
        jest.restoreAllMocks();
    });
    describe('CacheStrategy Interface', () => {
        it('应该定义正确的缓存策略接口', () => {
            const strategy = {
                name: 'test-strategy',
                urlPattern: '/api/*',
                strategy: 'cache-first',
                maxAge: 3600000,
                maxEntries: 100,
                cacheableResponse: {
                    statuses: [0, 200],
                    headers: {
                        'Content-Type': 'application/json',
                    },
                },
            };
            expect(strategy.name).toBe('test-strategy');
            expect(strategy.urlPattern).toBe('/api/*');
            expect(strategy.strategy).toBe('cache-first');
            expect(strategy.maxAge).toBe(3600000);
            expect(strategy.maxEntries).toBe(100);
        });
        it('应该支持不同的缓存策略', () => {
            const strategies = [
                'cache-first',
                'network-first',
                'cache-only',
                'network-only',
                'stale-while-revalidate',
            ];
            strategies.forEach((strategy) => {
                const cacheStrategy = {
                    name: `test-${strategy}`,
                    urlPattern: '/test/*',
                    strategy: strategy,
                };
                expect(cacheStrategy.strategy).toBeDefined();
            });
        });
        it('应该支持可选配置', () => {
            const minimalStrategy = {
                name: 'minimal',
                urlPattern: '/minimal/*',
                strategy: 'network-first',
            };
            expect(minimalStrategy.name).toBe('minimal');
            expect(minimalStrategy.urlPattern).toBe('/minimal/*');
            expect(minimalStrategy.strategy).toBe('network-first');
        });
    });
    describe('Service Worker生命周期', () => {
        it('应该处理install事件', () => {
            const mockEvent = {
                waitUntil: jest.fn(),
            };
            expect(mockEvent.waitUntil).toBeDefined();
        });
        it('应该处理activate事件', () => {
            const mockEvent = {
                waitUntil: jest.fn(),
            };
            expect(mockEvent.waitUntil).toBeDefined();
        });
        it('应该处理fetch事件', () => {
            const mockEvent = {
                request: { url: 'https://example.com/test' },
                respondWith: jest.fn(),
            };
            expect(mockEvent.request).toBeDefined();
            expect(mockEvent.respondWith).toBeDefined();
        });
    });
    describe('缓存策略实现', () => {
        it('应该实现cache-first策略', async () => {
            const mockCache = {
                match: jest.fn(),
                put: jest.fn(),
            };
            mockCache.match.mockResolvedValueOnce(new Response('cached', { status: 200 }));
            const request = new Request('https://example.com/api/data');
            const response = await mockCache.match(request);
            expect(response).toBeDefined();
            expect(mockCache.match).toHaveBeenCalledWith(request);
        });
        it('应该实现network-first策略', async () => {
            const mockFetch = jest.fn().mockResolvedValueOnce(new Response('network', { status: 200 }));
            const request = new Request('https://example.com/api/data');
            const response = await mockFetch(request);
            expect(response).toBeDefined();
            expect(mockFetch).toHaveBeenCalledWith(request);
        });
        it('应该实现stale-while-revalidate策略', async () => {
            const mockCache = {
                match: jest.fn(),
                put: jest.fn(),
            };
            mockCache.match.mockResolvedValueOnce(new Response('stale', { status: 200 }));
            const request = new Request('https://example.com/api/data');
            const cachedResponse = await mockCache.match(request);
            expect(cachedResponse).toBeDefined();
            expect(mockCache.match).toHaveBeenCalledWith(request);
        });
    });
    describe('缓存管理', () => {
        it('应该支持maxAge过期', () => {
            const now = Date.now();
            const cacheEntry = {
                response: new Response('data'),
                timestamp: now - 3600001,
                maxAge: 3600000,
            };
            const isExpired = now - cacheEntry.timestamp > cacheEntry.maxAge;
            expect(isExpired).toBe(true);
        });
        it('应该支持maxEntries限制', () => {
            const cacheEntries = Array.from({ length: 150 }, (_, i) => ({
                url: `/api/data/${i}`,
                data: `data-${i}`,
            }));
            const maxEntries = 100;
            const limitedCache = cacheEntries.slice(0, maxEntries);
            expect(limitedCache.length).toBe(maxEntries);
        });
        it('应该支持LRU缓存淘汰', () => {
            const cache = new Map();
            cache.set('/api/1', 'data1');
            cache.set('/api/2', 'data2');
            cache.set('/api/3', 'data3');
            cache.delete('/api/1');
            expect(cache.has('/api/1')).toBe(false);
            expect(cache.has('/api/2')).toBe(true);
            expect(cache.has('/api/3')).toBe(true);
        });
    });
    describe('Service Worker注册', () => {
        it('应该正确注册Service Worker', () => {
            const mockRegistration = {
                scope: '/',
                updateViaCache: '/sw.js',
            };
            expect(mockRegistration.scope).toBe('/');
            expect(mockRegistration.updateViaCache).toBeDefined();
        });
        it('应该处理注册成功', () => {
            const registration = {
                active: {
                    state: 'activated',
                    scriptURL: '/sw.js',
                },
            };
            expect(registration.active.state).toBe('activated');
            expect(registration.active.scriptURL).toBe('/sw.js');
        });
        it('应该处理注册失败', () => {
            const error = new Error('Service Worker registration failed');
            expect(error.message).toBe('Service Worker registration failed');
        });
    });
    describe('离线支持', () => {
        it('应该缓存离线资源', () => {
            const offlineResources = ['/index.html', '/manifest.json', '/styles.css', '/app.js'];
            const cacheStrategy = {
                name: 'offline-assets',
                urlPattern: offlineResources.map((r) => r),
                strategy: 'cache-only',
            };
            expect(cacheStrategy.urlPattern.length).toBe(offlineResources.length);
        });
        it('应该提供离线页面', () => {
            const offlinePage = '/offline.html';
            expect(offlinePage).toBeDefined();
        });
    });
    describe('推送通知', () => {
        it('应该支持显示通知', () => {
            const notification = {
                title: 'Test Notification',
                body: 'This is a test notification',
                icon: '/icon.png',
                data: {
                    url: '/details',
                },
            };
            expect(notification.title).toBe('Test Notification');
            expect(notification.body).toBe('This is a test notification');
            expect(notification.icon).toBe('/icon.png');
        });
        it('应该支持通知权限', () => {
            const mockNotification = {
                requestPermission: jest.fn().mockResolvedValue('granted'),
            };
            expect(mockNotification.requestPermission).toBeDefined();
        });
    });
    describe('Service Worker更新', () => {
        it('应该检测新版本', () => {
            const currentVersion = '1.0.0';
            const newVersion = '1.1.0';
            const hasUpdate = newVersion !== currentVersion;
            expect(hasUpdate).toBe(true);
        });
        it('应该提示用户更新', () => {
            const updateAvailable = {
                newVersion: '1.1.0',
                message: 'New version available',
            };
            expect(updateAvailable.newVersion).toBe('1.1.0');
            expect(updateAvailable.message).toBe('New version available');
        });
    });
    describe('缓存响应处理', () => {
        it('应该验证缓存响应状态', () => {
            const responses = [
                { status: 200, statusText: 'OK' },
                { status: 404, statusText: 'Not Found' },
                { status: 500, statusText: 'Internal Server Error' },
            ];
            responses.forEach((response) => {
                expect(response.status).toBeDefined();
                expect(response.statusText).toBeDefined();
            });
        });
        it('应该验证缓存响应头', () => {
            const headers = new Headers({
                'Content-Type': 'application/json',
                'Cache-Control': 'max-age=3600',
                ETag: 'abc123',
            });
            expect(headers.get('Content-Type')).toBe('application/json');
            expect(headers.get('Cache-Control')).toBe('max-age=3600');
            expect(headers.get('ETag')).toBe('abc123');
        });
    });
    describe('性能优化', () => {
        it('应该支持预缓存关键资源', () => {
            const criticalResources = ['/index.html', '/main.js', '/styles.css', '/logo.png'];
            const preCacheStrategy = {
                name: 'precache',
                urlPattern: criticalResources,
                strategy: 'cache-first',
                maxAge: Infinity,
            };
            expect(preCacheStrategy.urlPattern.length).toBe(criticalResources.length);
            expect(preCacheStrategy.maxAge).toBe(Infinity);
        });
        it('应该支持后台同步', () => {
            const syncConfig = {
                url: '/api/sync',
                interval: 300000,
            };
            expect(syncConfig.url).toBe('/api/sync');
            expect(syncConfig.interval).toBe(300000);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3lhbnl1L0Rvd25sb2Fkcy95eWMzLURlc2lnbi1TeXN0ZW0vc3JjL3B3YS9fX3Rlc3RzX18vc2VydmljZS13b3JrZXIudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7R0FPRzs7QUFJSCxRQUFRLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQ3JDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO0lBQ3pCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHlCQUF5QixFQUFFLEdBQUcsRUFBRTtRQUN2QyxFQUFFLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtZQUN2QixNQUFNLFFBQVEsR0FBRztnQkFDZixJQUFJLEVBQUUsZUFBZTtnQkFDckIsVUFBVSxFQUFFLFFBQVE7Z0JBQ3BCLFFBQVEsRUFBRSxhQUFhO2dCQUN2QixNQUFNLEVBQUUsT0FBTztnQkFDZixVQUFVLEVBQUUsR0FBRztnQkFDZixpQkFBaUIsRUFBRTtvQkFDakIsUUFBUSxFQUFFLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQztvQkFDbEIsT0FBTyxFQUFFO3dCQUNQLGNBQWMsRUFBRSxrQkFBa0I7cUJBQ25DO2lCQUNGO2FBQ0YsQ0FBQztZQUVGLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBQzVDLE1BQU0sQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzNDLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFD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LGdCQUFnQixDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDMUUsTUFBTSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNqRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFO1lBQ2xCLE1BQU0sVUFBVSxHQUFHO2dCQUNqQixHQUFHLEVBQUUsV0FBVztnQkFDaEIsUUFBUSxFQUFFLE1BQU07YUFDakIsQ0FBQztZQUVGLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3pDLE1BQU0sQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzNDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMveWFueXUvRG93bmxvYWRzL3l5YzMtRGVzaWduLVN5c3RlbS9zcmMvcHdhL19fdGVzdHNfXy9zZXJ2aWNlLXdvcmtlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgU2VydmljZSBXb3JrZXLmtYvor5VcbiAqIEBkZXNjcmlwdGlvbiDmtYvor5VQV0EgU2VydmljZSBXb3JrZXLlip/og71cbiAqIEBtb2R1bGUgX190ZXN0c19fL3B3YS9zZXJ2aWNlLXdvcmtlci50ZXN0XG4gKiBAYXV0aG9yIFlZQ8KzXG4gKiBAdmVyc2lvbiAxLjAuMFxuICogQGNyZWF0ZWQgMjAyNi0wMi0xOVxuICovXG5cbmltcG9ydCB0eXBlIHsgQ2FjaGVTdHJhdGVneSB9IGZyb20gJy4uL3NlcnZpY2Utd29ya2VyJztcblxuZGVzY3JpYmUoJ1NlcnZpY2UgV29ya2VyIE1vZHVsZScsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5yZXNldEFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NhY2hlU3RyYXRlZ3kgSW50ZXJmYWNlJywgKCkgPT4ge1xuICAgIGl0KCflupTor6XlrprkuYnmraPnoa7nmoTnvJPlrZjnrZbnlaXmjqXlj6MnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdHJhdGVneSA9IHtcbiAgICAgICAgbmFtZTogJ3Rlc3Qtc3RyYXRlZ3knLFxuICAgICAgICB1cmxQYXR0ZXJuOiAnL2FwaS8qJyxcbiAgICAgICAgc3RyYXRlZ3k6ICdjYWNoZS1maXJzdCcsXG4gICAgICAgIG1heEFnZTogMzYwMDAwMCxcbiAgICAgICAgbWF4RW50cmllczogMTAwLFxuICAgICAgICBjYWNoZWFibGVSZXNwb25zZToge1xuICAgICAgICAgIHN0YXR1c2VzOiBbMCwgMjAwXSxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBleHBlY3Qoc3RyYXRlZ3kubmFtZSkudG9CZSgndGVzdC1zdHJhdGVneScpO1xuICAgICAgZXhwZWN0KHN0cmF0ZWd5LnVybFBhdHRlcm4pLnRvQmUoJy9hcGkvKicpO1xuICAgICAgZXhwZWN0KHN0cmF0ZWd5LnN0cmF0ZWd5KS50b0JlKCdjYWNoZS1maXJzdCcpO1xuICAgICAgZXhwZWN0KHN0cmF0ZWd5Lm1heEFnZSkudG9CZSgzNjAwMDAwKTtcbiAgICAgIGV4cGVjdChzdHJhdGVneS5tYXhFbnRyaWVzKS50b0JlKDEwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgn5bqU6K+l5pSv5oyB5LiN5ZCM55qE57yT5a2Y562W55WlJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RyYXRlZ2llczogQXJyYXk8Q2FjaGVTdHJhdGVneVsnc3RyYXRlZ3knXT4gPSBbXG4gICAgICAgICdjYWNoZS1maXJzdCcsXG4gICAgICAgICduZXR3b3JrLWZpcnN0JyxcbiAgICAgICAgJ2NhY2hlLW9ubHknLFxuICAgICAgICAnbmV0d29yay1vbmx5JyxcbiAgICAgICAgJ3N0YWxlLXdoaWxlLXJldmFsaWRhdGUnLFxuICAgICAgXTtcblxuICAgICAgc3RyYXRlZ2llcy5mb3JFYWNoKChzdHJhdGVneSkgPT4ge1xuICAgICAgICBjb25zdCBjYWNoZVN0cmF0ZWd5OiBDYWNoZVN0cmF0ZWd5ID0ge1xuICAgICAgICAgIG5hbWU6IGB0ZXN0LSR7c3RyYXRlZ3l9YCxcbiAgICAgICAgICB1cmxQYXR0ZXJuOiAnL3Rlc3QvKicsXG4gICAgICAgICAgc3RyYXRlZ3k6IHN0cmF0ZWd5LFxuICAgICAgICB9O1xuXG4gICAgICAgIGV4cGVjdChjYWNoZVN0cmF0ZWd5LnN0cmF0ZWd5KS50b0JlRGVmaW5lZCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgn5bqU6K+l5pSv5oyB5Y+v6YCJ6YWN572uJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWluaW1hbFN0cmF0ZWd5ID0ge1xuICAgICAgICBuYW1lOiAnbWluaW1hbCcsXG4gICAgICAgIHVybFBhdHRlcm46ICcvbWluaW1hbC8qJyxcbiAgICAgICAgc3RyYXRlZ3k6ICduZXR3b3JrLWZpcnN0JyxcbiAgICAgIH07XG5cbiAgICAgIGV4cGVjdChtaW5pbWFsU3RyYXRlZ3kubmFtZSkudG9CZSgnbWluaW1hbCcpO1xuICAgICAgZXhwZWN0KG1pbmltYWxTdHJhdGVneS51cmxQYXR0ZXJuKS50b0JlKCcvbWluaW1hbC8qJyk7XG4gICAgICBleHBlY3QobWluaW1hbFN0cmF0ZWd5LnN0cmF0ZWd5KS50b0JlKCduZXR3b3JrLWZpcnN0Jyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZXJ2aWNlIFdvcmtlcueUn+WRveWRqOacnycsICgpID0+IHtcbiAgICBpdCgn5bqU6K+l5aSE55CGaW5zdGFsbOS6i+S7ticsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tFdmVudCA9IHtcbiAgICAgICAgd2FpdFVudGlsOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBleHBlY3QobW9ja0V2ZW50LndhaXRVbnRpbCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCflupTor6XlpITnkIZhY3RpdmF0ZeS6i+S7ticsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tFdmVudCA9IHtcbiAgICAgICAgd2FpdFVudGlsOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBleHBlY3QobW9ja0V2ZW50LndhaXRVbnRpbCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCflupTor6XlpITnkIZmZXRjaOS6i+S7ticsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tFdmVudCA9IHtcbiAgICAgICAgcmVxdWVzdDogeyB1cmw6ICdodHRwczovL2V4YW1wbGUuY29tL3Rlc3QnIH0sXG4gICAgICAgIHJlc3BvbmRXaXRoOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBleHBlY3QobW9ja0V2ZW50LnJlcXVlc3QpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QobW9ja0V2ZW50LnJlc3BvbmRXaXRoKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgn57yT5a2Y562W55Wl5a6e546wJywgKCkgPT4ge1xuICAgIGl0KCflupTor6Xlrp7njrBjYWNoZS1maXJzdOetlueVpScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tDYWNoZSA9IHtcbiAgICAgICAgbWF0Y2g6IGplc3QuZm4oKSxcbiAgICAgICAgcHV0OiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBtb2NrQ2FjaGUubWF0Y2gubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG5ldyBSZXNwb25zZSgnY2FjaGVkJywgeyBzdGF0dXM6IDIwMCB9KSk7XG5cbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgUmVxdWVzdCgnaHR0cHM6Ly9leGFtcGxlLmNvbS9hcGkvZGF0YScpO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBtb2NrQ2FjaGUubWF0Y2gocmVxdWVzdCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrQ2FjaGUubWF0Y2gpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHJlcXVlc3QpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+W6lOivpeWunueOsG5ldHdvcmstZmlyc3TnrZbnlaUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRmV0Y2ggPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG5ldyBSZXNwb25zZSgnbmV0d29yaycsIHsgc3RhdHVzOiAyMDAgfSkpO1xuXG4gICAgICBjb25zdCByZXF1ZXN0ID0gbmV3IFJlcXVlc3QoJ2h0dHBzOi8vZXhhbXBsZS5jb20vYXBpL2RhdGEnKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbW9ja0ZldGNoKHJlcXVlc3QpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QobW9ja0ZldGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChyZXF1ZXN0KTtcbiAgICB9KTtcblxuICAgIGl0KCflupTor6Xlrp7njrBzdGFsZS13aGlsZS1yZXZhbGlkYXRl562W55WlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0NhY2hlID0ge1xuICAgICAgICBtYXRjaDogamVzdC5mbigpLFxuICAgICAgICBwdXQ6IGplc3QuZm4oKSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tDYWNoZS5tYXRjaC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobmV3IFJlc3BvbnNlKCdzdGFsZScsIHsgc3RhdHVzOiAyMDAgfSkpO1xuXG4gICAgICBjb25zdCByZXF1ZXN0ID0gbmV3IFJlcXVlc3QoJ2h0dHBzOi8vZXhhbXBsZS5jb20vYXBpL2RhdGEnKTtcbiAgICAgIGNvbnN0IGNhY2hlZFJlc3BvbnNlID0gYXdhaXQgbW9ja0NhY2hlLm1hdGNoKHJlcXVlc3QpO1xuXG4gICAgICBleHBlY3QoY2FjaGVkUmVzcG9uc2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QobW9ja0NhY2hlLm1hdGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChyZXF1ZXN0KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ+e8k+WtmOeuoeeQhicsICgpID0+IHtcbiAgICBpdCgn5bqU6K+l5pSv5oyBbWF4QWdl6L+H5pyfJywgKCkgPT4ge1xuICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IGNhY2hlRW50cnkgPSB7XG4gICAgICAgIHJlc3BvbnNlOiBuZXcgUmVzcG9uc2UoJ2RhdGEnKSxcbiAgICAgICAgdGltZXN0YW1wOiBub3cgLSAzNjAwMDAxLFxuICAgICAgICBtYXhBZ2U6IDM2MDAwMDAsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBpc0V4cGlyZWQgPSBub3cgLSBjYWNoZUVudHJ5LnRpbWVzdGFtcCA+IGNhY2hlRW50cnkubWF4QWdlO1xuICAgICAgZXhwZWN0KGlzRXhwaXJlZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCflupTor6XmlK/mjIFtYXhFbnRyaWVz6ZmQ5Yi2JywgKCkgPT4ge1xuICAgICAgY29uc3QgY2FjaGVFbnRyaWVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTUwIH0sIChfLCBpKSA9PiAoe1xuICAgICAgICB1cmw6IGAvYXBpL2RhdGEvJHtpfWAsXG4gICAgICAgIGRhdGE6IGBkYXRhLSR7aX1gLFxuICAgICAgfSkpO1xuXG4gICAgICBjb25zdCBtYXhFbnRyaWVzID0gMTAwO1xuICAgICAgY29uc3QgbGltaXRlZENhY2hlID0gY2FjaGVFbnRyaWVzLnNsaWNlKDAsIG1heEVudHJpZXMpO1xuXG4gICAgICBleHBlY3QobGltaXRlZENhY2hlLmxlbmd0aCkudG9CZShtYXhFbnRyaWVzKTtcbiAgICB9KTtcblxuICAgIGl0KCflupTor6XmlK/mjIFMUlXnvJPlrZjmt5jmsbAnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjYWNoZSA9IG5ldyBNYXAoKTtcbiAgICAgIGNhY2hlLnNldCgnL2FwaS8xJywgJ2RhdGExJyk7XG4gICAgICBjYWNoZS5zZXQoJy9hcGkvMicsICdkYXRhMicpO1xuICAgICAgY2FjaGUuc2V0KCcvYXBpLzMnLCAnZGF0YTMnKTtcblxuICAgICAgY2FjaGUuZGVsZXRlKCcvYXBpLzEnKTtcblxuICAgICAgZXhwZWN0KGNhY2hlLmhhcygnL2FwaS8xJykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KGNhY2hlLmhhcygnL2FwaS8yJykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY2FjaGUuaGFzKCcvYXBpLzMnKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NlcnZpY2UgV29ya2Vy5rOo5YaMJywgKCkgPT4ge1xuICAgIGl0KCflupTor6XmraPnoa7ms6jlhoxTZXJ2aWNlIFdvcmtlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZWdpc3RyYXRpb24gPSB7XG4gICAgICAgIHNjb3BlOiAnLycsXG4gICAgICAgIHVwZGF0ZVZpYUNhY2hlOiAnL3N3LmpzJyxcbiAgICAgIH07XG5cbiAgICAgIGV4cGVjdChtb2NrUmVnaXN0cmF0aW9uLnNjb3BlKS50b0JlKCcvJyk7XG4gICAgICBleHBlY3QobW9ja1JlZ2lzdHJhdGlvbi51cGRhdGVWaWFDYWNoZSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCflupTor6XlpITnkIbms6jlhozmiJDlip8nLCAoKSA9PiB7XG4gICAgICBjb25zdCByZWdpc3RyYXRpb24gPSB7XG4gICAgICAgIGFjdGl2ZToge1xuICAgICAgICAgIHN0YXRlOiAnYWN0aXZhdGVkJyxcbiAgICAgICAgICBzY3JpcHRVUkw6ICcvc3cuanMnLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgZXhwZWN0KHJlZ2lzdHJhdGlvbi5hY3RpdmUuc3RhdGUpLnRvQmUoJ2FjdGl2YXRlZCcpO1xuICAgICAgZXhwZWN0KHJlZ2lzdHJhdGlvbi5hY3RpdmUuc2NyaXB0VVJMKS50b0JlKCcvc3cuanMnKTtcbiAgICB9KTtcblxuICAgIGl0KCflupTor6XlpITnkIbms6jlhozlpLHotKUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignU2VydmljZSBXb3JrZXIgcmVnaXN0cmF0aW9uIGZhaWxlZCcpO1xuXG4gICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgnU2VydmljZSBXb3JrZXIgcmVnaXN0cmF0aW9uIGZhaWxlZCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgn56a757q/5pSv5oyBJywgKCkgPT4ge1xuICAgIGl0KCflupTor6XnvJPlrZjnprvnur/otYTmupAnLCAoKSA9PiB7XG4gICAgICBjb25zdCBvZmZsaW5lUmVzb3VyY2VzID0gWycvaW5kZXguaHRtbCcsICcvbWFuaWZlc3QuanNvbicsICcvc3R5bGVzLmNzcycsICcvYXBwLmpzJ107XG5cbiAgICAgIGNvbnN0IGNhY2hlU3RyYXRlZ3kgPSB7XG4gICAgICAgIG5hbWU6ICdvZmZsaW5lLWFzc2V0cycsXG4gICAgICAgIHVybFBhdHRlcm46IG9mZmxpbmVSZXNvdXJjZXMubWFwKChyKSA9PiByKSxcbiAgICAgICAgc3RyYXRlZ3k6ICdjYWNoZS1vbmx5JyxcbiAgICAgIH07XG5cbiAgICAgIGV4cGVjdChjYWNoZVN0cmF0ZWd5LnVybFBhdHRlcm4ubGVuZ3RoKS50b0JlKG9mZmxpbmVSZXNvdXJjZXMubGVuZ3RoKTtcbiAgICB9KTtcblxuICAgIGl0KCflupTor6Xmj5Dkvpvnprvnur/pobXpnaInLCAoKSA9PiB7XG4gICAgICBjb25zdCBvZmZsaW5lUGFnZSA9ICcvb2ZmbGluZS5odG1sJztcblxuICAgICAgZXhwZWN0KG9mZmxpbmVQYWdlKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgn5o6o6YCB6YCa55+lJywgKCkgPT4ge1xuICAgIGl0KCflupTor6XmlK/mjIHmmL7npLrpgJrnn6UnLCAoKSA9PiB7XG4gICAgICBjb25zdCBub3RpZmljYXRpb24gPSB7XG4gICAgICAgIHRpdGxlOiAnVGVzdCBOb3RpZmljYXRpb24nLFxuICAgICAgICBib2R5OiAnVGhpcyBpcyBhIHRlc3Qgbm90aWZpY2F0aW9uJyxcbiAgICAgICAgaWNvbjogJy9pY29uLnBuZycsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1cmw6ICcvZGV0YWlscycsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBleHBlY3Qobm90aWZpY2F0aW9uLnRpdGxlKS50b0JlKCdUZXN0IE5vdGlmaWNhdGlvbicpO1xuICAgICAgZXhwZWN0KG5vdGlmaWNhdGlvbi5ib2R5KS50b0JlKCdUaGlzIGlzIGEgdGVzdCBub3RpZmljYXRpb24nKTtcbiAgICAgIGV4cGVjdChub3RpZmljYXRpb24uaWNvbikudG9CZSgnL2ljb24ucG5nJyk7XG4gICAgfSk7XG5cbiAgICBpdCgn5bqU6K+l5pSv5oyB6YCa55+l5p2D6ZmQJywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja05vdGlmaWNhdGlvbiA9IHtcbiAgICAgICAgcmVxdWVzdFBlcm1pc3Npb246IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnZ3JhbnRlZCcpLFxuICAgICAgfTtcblxuICAgICAgZXhwZWN0KG1vY2tOb3RpZmljYXRpb24ucmVxdWVzdFBlcm1pc3Npb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZXJ2aWNlIFdvcmtlcuabtOaWsCcsICgpID0+IHtcbiAgICBpdCgn5bqU6K+l5qOA5rWL5paw54mI5pysJywgKCkgPT4ge1xuICAgICAgY29uc3QgY3VycmVudFZlcnNpb246IHN0cmluZyA9ICcxLjAuMCc7XG4gICAgICBjb25zdCBuZXdWZXJzaW9uOiBzdHJpbmcgPSAnMS4xLjAnO1xuXG4gICAgICBjb25zdCBoYXNVcGRhdGUgPSBuZXdWZXJzaW9uICE9PSBjdXJyZW50VmVyc2lvbjtcbiAgICAgIGV4cGVjdChoYXNVcGRhdGUpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgn5bqU6K+l5o+Q56S655So5oi35pu05pawJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlQXZhaWxhYmxlID0ge1xuICAgICAgICBuZXdWZXJzaW9uOiAnMS4xLjAnLFxuICAgICAgICBtZXNzYWdlOiAnTmV3IHZlcnNpb24gYXZhaWxhYmxlJyxcbiAgICAgIH07XG5cbiAgICAgIGV4cGVjdCh1cGRhdGVBdmFpbGFibGUubmV3VmVyc2lvbikudG9CZSgnMS4xLjAnKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVBdmFpbGFibGUubWVzc2FnZSkudG9CZSgnTmV3IHZlcnNpb24gYXZhaWxhYmxlJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCfnvJPlrZjlk43lupTlpITnkIYnLCAoKSA9PiB7XG4gICAgaXQoJ+W6lOivpemqjOivgee8k+WtmOWTjeW6lOeKtuaAgScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlcyA9IFtcbiAgICAgICAgeyBzdGF0dXM6IDIwMCwgc3RhdHVzVGV4dDogJ09LJyB9LFxuICAgICAgICB7IHN0YXR1czogNDA0LCBzdGF0dXNUZXh0OiAnTm90IEZvdW5kJyB9LFxuICAgICAgICB7IHN0YXR1czogNTAwLCBzdGF0dXNUZXh0OiAnSW50ZXJuYWwgU2VydmVyIEVycm9yJyB9LFxuICAgICAgXTtcblxuICAgICAgcmVzcG9uc2VzLmZvckVhY2goKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXNUZXh0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgn5bqU6K+l6aqM6K+B57yT5a2Y5ZON5bqU5aS0JywgKCkgPT4ge1xuICAgICAgY29uc3QgaGVhZGVycyA9IG5ldyBIZWFkZXJzKHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgJ0NhY2hlLUNvbnRyb2wnOiAnbWF4LWFnZT0zNjAwJyxcbiAgICAgICAgRVRhZzogJ2FiYzEyMycsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnKSkudG9CZSgnYXBwbGljYXRpb24vanNvbicpO1xuICAgICAgZXhwZWN0KGhlYWRlcnMuZ2V0KCdDYWNoZS1Db250cm9sJykpLnRvQmUoJ21heC1hZ2U9MzYwMCcpO1xuICAgICAgZXhwZWN0KGhlYWRlcnMuZ2V0KCdFVGFnJykpLnRvQmUoJ2FiYzEyMycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgn5oCn6IO95LyY5YyWJywgKCkgPT4ge1xuICAgIGl0KCflupTor6XmlK/mjIHpooTnvJPlrZjlhbPplK7otYTmupAnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjcml0aWNhbFJlc291cmNlcyA9IFsnL2luZGV4Lmh0bWwnLCAnL21haW4uanMnLCAnL3N0eWxlcy5jc3MnLCAnL2xvZ28ucG5nJ107XG5cbiAgICAgIGNvbnN0IHByZUNhY2hlU3RyYXRlZ3kgPSB7XG4gICAgICAgIG5hbWU6ICdwcmVjYWNoZScsXG4gICAgICAgIHVybFBhdHRlcm46IGNyaXRpY2FsUmVzb3VyY2VzLFxuICAgICAgICBzdHJhdGVneTogJ2NhY2hlLWZpcnN0JyxcbiAgICAgICAgbWF4QWdlOiBJbmZpbml0eSxcbiAgICAgIH07XG5cbiAgICAgIGV4cGVjdChwcmVDYWNoZVN0cmF0ZWd5LnVybFBhdHRlcm4ubGVuZ3RoKS50b0JlKGNyaXRpY2FsUmVzb3VyY2VzLmxlbmd0aCk7XG4gICAgICBleHBlY3QocHJlQ2FjaGVTdHJhdGVneS5tYXhBZ2UpLnRvQmUoSW5maW5pdHkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+W6lOivpeaUr+aMgeWQjuWPsOWQjOatpScsICgpID0+IHtcbiAgICAgIGNvbnN0IHN5bmNDb25maWcgPSB7XG4gICAgICAgIHVybDogJy9hcGkvc3luYycsXG4gICAgICAgIGludGVydmFsOiAzMDAwMDAsXG4gICAgICB9O1xuXG4gICAgICBleHBlY3Qoc3luY0NvbmZpZy51cmwpLnRvQmUoJy9hcGkvc3luYycpO1xuICAgICAgZXhwZWN0KHN5bmNDb25maWcuaW50ZXJ2YWwpLnRvQmUoMzAwMDAwKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==