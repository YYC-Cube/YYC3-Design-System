3c47ad8fe0f5ed973b5ef8e7c0022792
"use strict";
/**
 * @file 资源优化测试
 * @description 测试资源优化相关的工具函数
 * @module __tests__/resource-optimization.test
 * @author YYC³
 * @version 1.0.0
 * @created 2026-02-22
 */
Object.defineProperty(exports, "__esModule", { value: true });
const image_lazy_loader_1 = require("../../utils/image-lazy-loader");
const font_preloader_1 = require("../../utils/font-preloader");
const resource_preloader_1 = require("../resource-preloader");
describe('资源优化测试', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        jest.clearAllTimers();
        (0, image_lazy_loader_1.clearImageCache)();
        (0, font_preloader_1.clearFontCache)();
        (0, resource_preloader_1.clearAllResources)();
    });
    afterEach(() => {
        jest.clearAllTimers();
    });
    describe('图片懒加载测试', () => {
        it('应该观察图片并延迟加载', () => {
            const mockElement = document.createElement('img');
            const mockObserver = {
                observe: jest.fn(),
                disconnect: jest.fn(),
            };
            jest.spyOn(window, 'IntersectionObserver').mockImplementation((_callback) => {
                mockObserver.observe = jest.fn();
                return mockObserver;
            });
            const unobserve = (0, image_lazy_loader_1.observeLazyImage)(mockElement, {
                placeholder: 'data:image/svg+xml;base64,placeholder',
            });
            expect(mockObserver.observe).toHaveBeenCalledWith(mockElement);
            unobserve();
            expect(mockObserver.disconnect).toHaveBeenCalled();
        });
        it('应该使用占位符', () => {
            const mockElement = document.createElement('img');
            const placeholder = 'data:image/svg+xml;base64,placeholder';
            (0, image_lazy_loader_1.observeLazyImage)(mockElement, { placeholder });
            expect(mockElement.src).toBe(placeholder);
        });
        it('应该处理加载完成', () => {
            const mockElement = document.createElement('img');
            const onLoad = jest.fn();
            (0, image_lazy_loader_1.observeLazyImage)(mockElement, { onLoad });
            mockElement.dispatchEvent(new Event('load'));
            expect(onLoad).toHaveBeenCalled();
        });
        it('应该处理加载错误', () => {
            const mockElement = document.createElement('img');
            const onError = jest.fn();
            (0, image_lazy_loader_1.observeLazyImage)(mockElement, { onError });
            mockElement.dispatchEvent(new Event('error'));
            expect(onError).toHaveBeenCalled();
        });
    });
    describe('图片预加载测试', () => {
        it('应该预加载单张图片', async () => {
            jest.useFakeTimers();
            const mockSrc = 'https://example.com/image.jpg';
            let resolveLoad;
            const loadPromise = new Promise((resolve) => {
                resolveLoad = resolve;
            });
            const mockImage = {
                onload: null,
                onerror: null,
                src: '',
            };
            jest
                .spyOn(window, 'Image')
                .mockImplementation(() => {
                setTimeout(() => {
                    if (mockImage.onload) {
                        mockImage.onload.call(mockImage, new Event('load'));
                    }
                    resolveLoad();
                }, 100);
                return mockImage;
            });
            await (0, image_lazy_loader_1.preloadLazyImage)(mockSrc);
            expect(mockImage.onload).toBeDefined();
            await loadPromise;
            jest.useRealTimers();
        }, 10000);
    });
    describe('字体预加载测试', () => {
        it('应该预加载单个字体', async () => {
            const mockFont = {
                fontFamily: 'Test Font',
                fontSrc: 'https://example.com/font.woff2',
            };
            await (0, font_preloader_1.preloadFont)(mockFont.fontFamily, mockFont.fontSrc);
            const stats = (0, font_preloader_1.getFontPreloaderStats)();
            expect(stats).toBeDefined();
        });
        it('应该清空字体缓存', async () => {
            const mockFont = {
                fontFamily: 'Test Font',
                fontSrc: 'https://example.com/font.woff2',
            };
            await (0, font_preloader_1.preloadFont)(mockFont.fontFamily, mockFont.fontSrc);
            (0, font_preloader_1.clearFontCache)();
            const stats = (0, font_preloader_1.getFontPreloaderStats)();
            expect(stats.cacheSize).toBe(0);
        });
    });
    describe('资源预加载测试', () => {
        it('应该预加载单个资源', async () => {
            const mockUrl = 'https://example.com/script.js';
            (0, resource_preloader_1.preloadResource)(mockUrl, 'script');
            expect((0, resource_preloader_1.isPreloaded)(mockUrl)).toBe(true);
        });
        it('应该批量预加载资源', async () => {
            const mockResources = [
                { url: 'https://example.com/script.js', type: 'script' },
                { url: 'https://example.com/style.css', type: 'style' },
            ];
            (0, resource_preloader_1.preloadResources)(mockResources);
            expect((0, resource_preloader_1.isPreloaded)(mockResources[0].url)).toBe(true);
            expect((0, resource_preloader_1.isPreloaded)(mockResources[1].url)).toBe(true);
        });
        it('应该预加载关键资源', async () => {
            const mockResources = [{ url: 'https://example.com/script.js', type: 'script' }];
            (0, resource_preloader_1.preloadCriticalResources)(mockResources);
            expect((0, resource_preloader_1.isPreloaded)(mockResources[0].url)).toBe(true);
        });
        it('应该预连接到源', async () => {
            const mockUrl = 'https://example.com';
            (0, resource_preloader_1.preconnect)(mockUrl);
            expect((0, resource_preloader_1.isPreconnected)(mockUrl)).toBe(true);
        });
        it('应该批量预连接到源', async () => {
            const mockUrls = ['https://example1.com', 'https://example2.com'];
            (0, resource_preloader_1.preconnectOrigins)(mockUrls);
            expect((0, resource_preloader_1.isPreconnected)(mockUrls[0])).toBe(true);
            expect((0, resource_preloader_1.isPreconnected)(mockUrls[1])).toBe(true);
        });
        it('应该预取资源', async () => {
            const mockUrl = 'https://example.com/script.js';
            (0, resource_preloader_1.prefetch)(mockUrl, 'script');
            expect((0, resource_preloader_1.isPrefetched)(mockUrl)).toBe(true);
        });
        it('应该批量预取资源', async () => {
            const mockResources = [
                { url: 'https://example.com/script.js', type: 'script' },
                { url: 'https://example.com/style.css', type: 'style' },
            ];
            (0, resource_preloader_1.prefetchResources)(mockResources);
            expect((0, resource_preloader_1.isPrefetched)(mockResources[0].url)).toBe(true);
            expect((0, resource_preloader_1.isPrefetched)(mockResources[1].url)).toBe(true);
        });
        it('应该预加载脚本', async () => {
            const mockUrl = 'https://example.com/script.js';
            (0, resource_preloader_1.preloadScript)(mockUrl);
            expect((0, resource_preloader_1.isPreloaded)(mockUrl)).toBe(true);
        });
        it('应该预加载样式', async () => {
            const mockUrl = 'https://example.com/style.css';
            (0, resource_preloader_1.preloadStyle)(mockUrl);
            expect((0, resource_preloader_1.isPreloaded)(mockUrl)).toBe(true);
        });
        it('应该预加载图片', async () => {
            const mockUrl = 'https://example.com/image.jpg';
            (0, resource_preloader_1.preloadImage)(mockUrl);
            expect((0, resource_preloader_1.isPreloaded)(mockUrl)).toBe(true);
        });
        it('应该预加载字体', async () => {
            const mockUrl = 'https://example.com/font.woff2';
            (0, resource_preloader_1.preloadFont)(mockUrl);
            expect((0, resource_preloader_1.isPreloaded)(mockUrl)).toBe(true);
        });
        it('应该清空所有资源缓存', async () => {
            const mockUrl = 'https://example.com/script.js';
            (0, resource_preloader_1.preloadResource)(mockUrl, 'script');
            await new Promise(resolve => setTimeout(resolve, 100));
            expect((0, resource_preloader_1.getResourcePreloaderStats)().count).toBeGreaterThan(0);
            (0, resource_preloader_1.clearAllResources)();
            expect((0, resource_preloader_1.getResourcePreloaderStats)().count).toBe(0);
        });
        it('应该生成预加载提示', async () => {
            const mockUrl = 'https://example.com/script.js';
            (0, resource_preloader_1.preloadResource)(mockUrl, 'script');
            await new Promise(resolve => setTimeout(resolve, 100));
            const hints = (0, resource_preloader_1.generatePreloadHints)();
            expect(hints.length).toBeGreaterThan(0);
        });
    });
    describe('性能基准测试', () => {
        it('应该测量图片加载性能', async () => {
            jest.useFakeTimers();
            const mockSrc = 'https://example.com/image.jpg';
            let resolveLoad;
            const loadPromise = new Promise((resolve) => {
                resolveLoad = resolve;
            });
            const mockImage = {
                onload: null,
                onerror: null,
                src: '',
            };
            jest
                .spyOn(window, 'Image')
                .mockImplementation(() => {
                setTimeout(() => {
                    if (mockImage.onload) {
                        mockImage.onload(new Event('load'));
                    }
                    resolveLoad();
                }, 100);
                return mockImage;
            });
            const start = performance.now();
            await (0, image_lazy_loader_1.preloadLazyImage)(mockSrc);
            jest.runAllTimers();
            await loadPromise;
            const end = performance.now();
            const loadTime = end - start;
            expect(loadTime).toBeLessThan(1000);
            jest.useRealTimers();
        }, 10000);
        it('应该测量字体加载性能', async () => {
            jest.useFakeTimers();
            jest.spyOn(document.head, 'appendChild').mockImplementation((node) => {
                setTimeout(() => {
                    const event = new Event('load');
                    node.dispatchEvent(event);
                }, 100);
                return node;
            });
            const mockFont = {
                fontFamily: 'Test Font',
                fontSrc: 'https://example.com/font.woff2',
            };
            const start = performance.now();
            await (0, font_preloader_1.preloadFont)(mockFont.fontFamily, mockFont.fontSrc);
            jest.runAllTimers();
            await new Promise(resolve => setTimeout(resolve, 200));
            const end = performance.now();
            const loadTime = end - start;
            expect(loadTime).toBeLessThan(500);
            jest.useRealTimers();
        }, 10000);
        it('应该测量资源预加载性能', async () => {
            jest.useFakeTimers();
            jest.spyOn(document.head, 'appendChild').mockImplementation((node) => {
                setTimeout(() => {
                    const event = new Event('load');
                    node.dispatchEvent(event);
                }, 100);
                return node;
            });
            const mockUrl = 'https://example.com/script.js';
            const start = performance.now();
            (0, resource_preloader_1.preloadResource)(mockUrl, 'script');
            jest.runAllTimers();
            await new Promise(resolve => setTimeout(resolve, 200));
            const end = performance.now();
            const loadTime = end - start;
            expect(loadTime).toBeLessThan(500);
            jest.useRealTimers();
        }, 10000);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3lhbnl1L0Rvd25sb2Fkcy95eWMzLURlc2lnbi1TeXN0ZW0vc3JjL3Jlc291cmNlLW9wdGltaXphdGlvbi9fX3Rlc3RzX18vaW5kZXgudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7R0FPRzs7QUFFSCxxRUFJdUM7QUFFdkMsK0RBQWdHO0FBRWhHLDhEQWtCK0I7QUFFL0IsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7SUFDdEIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEIsSUFBQSxtQ0FBZSxHQUFFLENBQUM7UUFDbEIsSUFBQSwrQkFBYyxHQUFFLENBQUM7UUFDakIsSUFBQSxzQ0FBaUIsR0FBRSxDQUFDO0lBQ3RCLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUN4QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO1FBQ3ZCLEVBQUUsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1lBQ3JCLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbEQsTUFBTSxZQUFZLEdBQUc7Z0JBQ25CLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUNsQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTthQUN0QixDQUFDO1lBQ0YsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsc0JBQXNCLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFO2dCQUMxRSxZQUFZLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDakMsT0FBTyxZQUFtQixDQUFDO1lBQzdCLENBQUMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxTQUFTLEdBQUcsSUFBQSxvQ0FBZ0IsRUFBQyxXQUFXLEVBQUU7Z0JBQzlDLFdBQVcsRUFBRSx1Q0FBdUM7YUFDckQsQ0FBQyxDQUFDO1lBRUgsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUUvRCxTQUFTLEVBQUUsQ0FBQztZQUNaLE1BQU0sQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUNyRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO1lBQ2pCLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbEQsTUFBTSxXQUFXLEdBQUcsdUNBQXVDLENBQUM7WUFFNUQsSUFBQSxvQ0FBZ0IsRUFBQyxXQUFXLEVBQUUsRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDO1lBRS9DLE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzVDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUU7WUFDbEIsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNsRCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7WUFFekIsSUFBQSxvQ0FBZ0IsRUFBQyxXQUFXLEVBQUUsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBRTFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUU3QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUNwQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFO1lBQ2xCLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbEQsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBRTFCLElBQUEsb0NBQWdCLEVBQUMsV0FBVyxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUUzQyxXQUFXLENBQUMsYUFBYSxDQUFDLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFFOUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO1FBQ3ZCLEVBQUUsQ0FBQyxXQUFXLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDekIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBRXJCLE1BQU0sT0FBTyxHQUFHLCtCQUErQixDQUFDO1lBQ2hELElBQUksV0FBdUIsQ0FBQztZQUM1QixNQUFNLFdBQVcsR0FBRyxJQUFJLE9BQU8sQ0FBTyxDQUFDLE9BQU8sRUFBRSxFQUFFO2dCQUNoRCxXQUFXLEdBQUcsT0FBTyxDQUFDO1lBQ3hCLENBQUMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxTQUFTLEdBQUc7Z0JBQ2hCLE1BQU0sRUFBRSxJQUFtQztnQkFDM0MsT0FBTyxFQUFFLElBQW1DO2dCQUM1QyxHQUFHLEVBQUUsRUFBRTthQUNSLENBQUM7WUFFRixJQUFJO2lCQUNELEtBQUssQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDO2lCQUN0QixrQkFBa0IsQ0FBQyxHQUFHLEVBQUU7Z0JBQ3ZCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7b0JBQ2QsSUFBSSxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUM7d0JBQ3JCLFNBQVMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO29CQUN0RCxDQUFDO29CQUNELFdBQVcsRUFBRSxDQUFDO2dCQUNoQixDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBRVIsT0FBTyxTQUF3QyxDQUFDO1lBQ2xELENBQUMsQ0FBQyxDQUFDO1lBRUwsTUFBTSxJQUFBLG9DQUFnQixFQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRWhDLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDdkMsTUFBTSxXQUFXLENBQUM7WUFFbEIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3ZCLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNaLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7UUFDdkIsRUFBRSxDQUFDLFdBQVcsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6QixNQUFNLFFBQVEsR0FBRztnQkFDZixVQUFVLEVBQUUsV0FBVztnQkFDdkIsT0FBTyxFQUFFLGdDQUFnQzthQUMxQyxDQUFDO1lBRUYsTUFBTSxJQUFBLDRCQUFXLEVBQUMsUUFBUSxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFekQsTUFBTSxLQUFLLEdBQUcsSUFBQSxzQ0FBcUIsR0FBRSxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM5QixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxVQUFVLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEIsTUFBTSxRQUFRLEdBQUc7Z0JBQ2YsVUFBVSxFQUFFLFdBQVc7Z0JBQ3ZCLE9BQU8sRUFBRSxnQ0FBZ0M7YUFDMUMsQ0FBQztZQUVGLE1BQU0sSUFBQSw0QkFBVyxFQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRXpELElBQUEsK0JBQWMsR0FBRSxDQUFDO1lBRWpCLE1BQU0sS0FBSyxHQUFHLElBQUEsc0NBQXFCLEdBQUUsQ0FBQztZQUN0QyxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7UUFDdkIsRUFBRSxDQUFDLFdBQVcsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6QixNQUFNLE9BQU8sR0FBRywrQkFBK0IsQ0FBQztZQUVoRCxJQUFBLG9DQUFlLEVBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRW5DLE1BQU0sQ0FBQyxJQUFBLGdDQUFXLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsV0FBVyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3pCLE1BQU0sYUFBYSxHQUFHO2dCQUNwQixFQUFFLEdBQUcsRUFBRSwrQkFBK0IsRUFBRSxJQUFJLEVBQUUsUUFBaUIsRUFBRTtnQkFDakUsRUFBRSxHQUFHLEVBQUUsK0JBQStCLEVBQUUsSUFBSSxFQUFFLE9BQWdCLEVBQUU7YUFDakUsQ0FBQztZQUVGLElBQUEscUNBQWdCLEVBQUMsYUFBYSxDQUFDLENBQUM7WUFFaEMsTUFBTSxDQUFDLElBQUEsZ0NBQVcsRUFBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDckQsTUFBTSxDQUFDLElBQUEsZ0NBQVcsRUFBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsV0FBVyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3pCLE1BQU0sYUFBYSxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsK0JBQStCLEVBQUUsSUFBSSxFQUFFLFFBQWlCLEVBQUUsQ0FBQyxDQUFDO1lBRTFGLElBQUEsNkNBQXdCLEVBQUMsYUFBYSxDQUFDLENBQUM7WUFFeEMsTUFBTSxDQUFDLElBQUEsZ0NBQVcsRUFBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsU0FBUyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3ZCLE1BQU0sT0FBTyxHQUFHLHFCQUFxQixDQUFDO1lBRXRDLElBQUEsK0JBQVUsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUVwQixNQUFNLENBQUMsSUFBQSxtQ0FBYyxFQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLFdBQVcsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6QixNQUFNLFFBQVEsR0FBRyxDQUFDLHNCQUFzQixFQUFFLHNCQUFzQixDQUFDLENBQUM7WUFFbEUsSUFBQSxzQ0FBaUIsRUFBQyxRQUFRLENBQUMsQ0FBQztZQUU1QixNQUFNLENBQUMsSUFBQSxtQ0FBYyxFQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQy9DLE1BQU0sQ0FBQyxJQUFBLG1DQUFjLEVBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsUUFBUSxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3RCLE1BQU0sT0FBTyxHQUFHLCtCQUErQixDQUFDO1lBRWhELElBQUEsNkJBQVEsRUFBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFNUIsTUFBTSxDQUFDLElBQUEsaUNBQVksRUFBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxVQUFVLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEIsTUFBTSxhQUFhLEdBQUc7Z0JBQ3BCLEVBQUUsR0FBRyxFQUFFLCtCQUErQixFQUFFLElBQUksRUFBRSxRQUFpQixFQUFFO2dCQUNqRSxFQUFFLEdBQUcsRUFBRSwrQkFBK0IsRUFBRSxJQUFJLEVBQUUsT0FBZ0IsRUFBRTthQUNqRSxDQUFDO1lBRUYsSUFBQSxzQ0FBaUIsRUFBQyxhQUFhLENBQUMsQ0FBQztZQUVqQyxNQUFNLENBQUMsSUFBQSxpQ0FBWSxFQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN0RCxNQUFNLENBQUMsSUFBQSxpQ0FBWSxFQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4RCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxTQUFTLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkIsTUFBTSxPQUFPLEdBQUcsK0JBQStCLENBQUM7WUFFaEQsSUFBQSxrQ0FBYSxFQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRXZCLE1BQU0sQ0FBQyxJQUFBLGdDQUFXLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsU0FBUyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3ZCLE1BQU0sT0FBTyxHQUFHLCtCQUErQixDQUFDO1lBRWhELElBQUEsaUNBQVksRUFBQyxPQUFPLENBQUMsQ0FBQztZQUV0QixNQUFNLENBQUMsSUFBQSxnQ0FBVyxFQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLFNBQVMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN2QixNQUFNLE9BQU8sR0FBRywrQkFBK0IsQ0FBQztZQUVoRCxJQUFBLGlDQUFvQixFQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRTlCLE1BQU0sQ0FBQyxJQUFBLGdDQUFXLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsU0FBUyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3ZCLE1BQU0sT0FBTyxHQUFHLGdDQUFnQyxDQUFDO1lBRWpELElBQUEsZ0NBQW1CLEVBQUMsT0FBTyxDQUFDLENBQUM7WUFFN0IsTUFBTSxDQUFDLElBQUEsZ0NBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxZQUFZLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDMUIsTUFBTSxPQUFPLEdBQUcsK0JBQStCLENBQUM7WUFFaEQsSUFBQSxvQ0FBZSxFQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztZQUVuQyxNQUFNLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBRXZELE1BQU0sQ0FBQyxJQUFBLDhDQUF5QixHQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRTdELElBQUEsc0NBQWlCLEdBQUUsQ0FBQztZQUVwQixNQUFNLENBQUMsSUFBQSw4Q0FBeUIsR0FBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxXQUFXLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDekIsTUFBTSxPQUFPLEdBQUcsK0JBQStCLENBQUM7WUFFaEQsSUFBQSxvQ0FBZSxFQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztZQUVuQyxNQUFNLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBRXZELE1BQU0sS0FBSyxHQUFHLElBQUEseUNBQW9CLEdBQUUsQ0FBQztZQUNyQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7UUFDdEIsRUFBRSxDQUFDLFlBQVksRUFBRSxLQUFLLElBQUksRUFBRTtZQUMxQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFFckIsTUFBTSxPQUFPLEdBQUcsK0JBQStCLENBQUM7WUFDaEQsSUFBSSxXQUF1QixDQUFDO1lBQzVCLE1BQU0sV0FBVyxHQUFHLElBQUksT0FBTyxDQUFPLENBQUMsT0FBTyxFQUFFLEVBQUU7Z0JBQ2hELFdBQVcsR0FBRyxPQUFPLENBQUM7WUFDeEIsQ0FBQyxDQUFDLENBQUM7WUFFSCxNQUFNLFNBQVMsR0FBRztnQkFDaEIsTUFBTSxFQUFFLElBQW1DO2dCQUMzQyxPQUFPLEVBQUUsSUFBbUM7Z0JBQzVDLEdBQUcsRUFBRSxFQUFFO2FBQ1IsQ0FBQztZQUVGLElBQUk7aUJBQ0QsS0FBSyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUM7aUJBQ3RCLGtCQUFrQixDQUFDLEdBQUcsRUFBRTtnQkFDdkIsVUFBVSxDQUFDLEdBQUcsRUFBRTtvQkFDZCxJQUFJLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQzt3QkFDckIsU0FBUyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO29CQUN0QyxDQUFDO29CQUNELFdBQVcsRUFBRSxDQUFDO2dCQUNoQixDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBRVIsT0FBTyxTQUF3QyxDQUFDO1lBQ2xELENBQUMsQ0FBQyxDQUFDO1lBRUwsTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBRWhDLE1BQU0sSUFBQSxvQ0FBZ0IsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUVoQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDcEIsTUFBTSxXQUFXLENBQUM7WUFFbEIsTUFBTSxHQUFHLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQzlCLE1BQU0sUUFBUSxHQUFHLEdBQUcsR0FBRyxLQUFLLENBQUM7WUFFN0IsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVwQyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDdkIsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRVYsRUFBRSxDQUFDLFlBQVksRUFBRSxLQUFLLElBQUksRUFBRTtZQUMxQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFFckIsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7Z0JBQ25FLFVBQVUsQ0FBQyxHQUFHLEVBQUU7b0JBQ2QsTUFBTSxLQUFLLEdBQUcsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQy9CLElBQW9CLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUM3QyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBQ1IsT0FBTyxJQUFJLENBQUM7WUFDZCxDQUFDLENBQUMsQ0FBQztZQUVILE1BQU0sUUFBUSxHQUFHO2dCQUNmLFVBQVUsRUFBRSxXQUFXO2dCQUN2QixPQUFPLEVBQUUsZ0NBQWdDO2FBQzFDLENBQUM7WUFFRixNQUFNLEtBQUssR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7WUFFaEMsTUFBTSxJQUFBLDRCQUFXLEVBQUMsUUFBUSxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFekQsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3BCLE1BQU0sSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFFdkQsTUFBTSxHQUFHLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQzlCLE1BQU0sUUFBUSxHQUFHLEdBQUcsR0FBRyxLQUFLLENBQUM7WUFFN0IsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVuQyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDdkIsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRVYsRUFBRSxDQUFDLGFBQWEsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMzQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFFckIsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7Z0JBQ25FLFVBQVUsQ0FBQyxHQUFHLEVBQUU7b0JBQ2QsTUFBTSxLQUFLLEdBQUcsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQy9CLElBQW9CLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUM3QyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBQ1IsT0FBTyxJQUFJLENBQUM7WUFDZCxDQUFDLENBQUMsQ0FBQztZQUVILE1BQU0sT0FBTyxHQUFHLCtCQUErQixDQUFDO1lBRWhELE1BQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUVoQyxJQUFBLG9DQUFlLEVBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRW5DLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUNwQixNQUFNLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBRXZELE1BQU0sR0FBRyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUM5QixNQUFNLFFBQVEsR0FBRyxHQUFHLEdBQUcsS0FBSyxDQUFDO1lBRTdCLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFbkMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3ZCLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNaLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3lhbnl1L0Rvd25sb2Fkcy95eWMzLURlc2lnbi1TeXN0ZW0vc3JjL3Jlc291cmNlLW9wdGltaXphdGlvbi9fX3Rlc3RzX18vaW5kZXgudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIOi1hOa6kOS8mOWMlua1i+ivlVxuICogQGRlc2NyaXB0aW9uIOa1i+ivlei1hOa6kOS8mOWMluebuOWFs+eahOW3peWFt+WHveaVsFxuICogQG1vZHVsZSBfX3Rlc3RzX18vcmVzb3VyY2Utb3B0aW1pemF0aW9uLnRlc3RcbiAqIEBhdXRob3IgWVlDwrNcbiAqIEB2ZXJzaW9uIDEuMC4wXG4gKiBAY3JlYXRlZCAyMDI2LTAyLTIyXG4gKi9cblxuaW1wb3J0IHtcbiAgb2JzZXJ2ZUxhenlJbWFnZSxcbiAgcHJlbG9hZExhenlJbWFnZSxcbiAgY2xlYXJJbWFnZUNhY2hlLFxufSBmcm9tICcuLi8uLi91dGlscy9pbWFnZS1sYXp5LWxvYWRlcic7XG5cbmltcG9ydCB7IHByZWxvYWRGb250LCBjbGVhckZvbnRDYWNoZSwgZ2V0Rm9udFByZWxvYWRlclN0YXRzIH0gZnJvbSAnLi4vLi4vdXRpbHMvZm9udC1wcmVsb2FkZXInO1xuXG5pbXBvcnQge1xuICBwcmVsb2FkUmVzb3VyY2UsXG4gIHByZWxvYWRSZXNvdXJjZXMsXG4gIHByZWxvYWRDcml0aWNhbFJlc291cmNlcyxcbiAgcHJlY29ubmVjdCxcbiAgcHJlY29ubmVjdE9yaWdpbnMsXG4gIHByZWZldGNoLFxuICBwcmVmZXRjaFJlc291cmNlcyxcbiAgcHJlbG9hZFNjcmlwdCxcbiAgcHJlbG9hZFN0eWxlLFxuICBwcmVsb2FkSW1hZ2UgYXMgcHJlbG9hZFJlc291cmNlSW1hZ2UsXG4gIHByZWxvYWRGb250IGFzIHByZWxvYWRSZXNvdXJjZUZvbnQsXG4gIGlzUHJlbG9hZGVkLFxuICBpc1ByZWNvbm5lY3RlZCxcbiAgaXNQcmVmZXRjaGVkLFxuICBjbGVhckFsbFJlc291cmNlcyxcbiAgZ2V0UmVzb3VyY2VQcmVsb2FkZXJTdGF0cyxcbiAgZ2VuZXJhdGVQcmVsb2FkSGludHMsXG59IGZyb20gJy4uL3Jlc291cmNlLXByZWxvYWRlcic7XG5cbmRlc2NyaWJlKCfotYTmupDkvJjljJbmtYvor5UnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIGplc3QuY2xlYXJBbGxUaW1lcnMoKTtcbiAgICBjbGVhckltYWdlQ2FjaGUoKTtcbiAgICBjbGVhckZvbnRDYWNoZSgpO1xuICAgIGNsZWFyQWxsUmVzb3VyY2VzKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbFRpbWVycygpO1xuICB9KTtcblxuICBkZXNjcmliZSgn5Zu+54mH5oeS5Yqg6L295rWL6K+VJywgKCkgPT4ge1xuICAgIGl0KCflupTor6Xop4Llr5/lm77niYflubblu7bov5/liqDovb0nLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgY29uc3QgbW9ja09ic2VydmVyID0ge1xuICAgICAgICBvYnNlcnZlOiBqZXN0LmZuKCksXG4gICAgICAgIGRpc2Nvbm5lY3Q6IGplc3QuZm4oKSxcbiAgICAgIH07XG4gICAgICBqZXN0LnNweU9uKHdpbmRvdywgJ0ludGVyc2VjdGlvbk9ic2VydmVyJykubW9ja0ltcGxlbWVudGF0aW9uKChfY2FsbGJhY2spID0+IHtcbiAgICAgICAgbW9ja09ic2VydmVyLm9ic2VydmUgPSBqZXN0LmZuKCk7XG4gICAgICAgIHJldHVybiBtb2NrT2JzZXJ2ZXIgYXMgYW55O1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHVub2JzZXJ2ZSA9IG9ic2VydmVMYXp5SW1hZ2UobW9ja0VsZW1lbnQsIHtcbiAgICAgICAgcGxhY2Vob2xkZXI6ICdkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LHBsYWNlaG9sZGVyJyxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QobW9ja09ic2VydmVyLm9ic2VydmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tFbGVtZW50KTtcblxuICAgICAgdW5vYnNlcnZlKCk7XG4gICAgICBleHBlY3QobW9ja09ic2VydmVyLmRpc2Nvbm5lY3QpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCflupTor6Xkvb/nlKjljaDkvY3nrKYnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgY29uc3QgcGxhY2Vob2xkZXIgPSAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxwbGFjZWhvbGRlcic7XG5cbiAgICAgIG9ic2VydmVMYXp5SW1hZ2UobW9ja0VsZW1lbnQsIHsgcGxhY2Vob2xkZXIgfSk7XG5cbiAgICAgIGV4cGVjdChtb2NrRWxlbWVudC5zcmMpLnRvQmUocGxhY2Vob2xkZXIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+W6lOivpeWkhOeQhuWKoOi9veWujOaIkCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICBjb25zdCBvbkxvYWQgPSBqZXN0LmZuKCk7XG5cbiAgICAgIG9ic2VydmVMYXp5SW1hZ2UobW9ja0VsZW1lbnQsIHsgb25Mb2FkIH0pO1xuXG4gICAgICBtb2NrRWxlbWVudC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnbG9hZCcpKTtcblxuICAgICAgZXhwZWN0KG9uTG9hZCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+W6lOivpeWkhOeQhuWKoOi9vemUmeivrycsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICBjb25zdCBvbkVycm9yID0gamVzdC5mbigpO1xuXG4gICAgICBvYnNlcnZlTGF6eUltYWdlKG1vY2tFbGVtZW50LCB7IG9uRXJyb3IgfSk7XG5cbiAgICAgIG1vY2tFbGVtZW50LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdlcnJvcicpKTtcblxuICAgICAgZXhwZWN0KG9uRXJyb3IpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ+WbvueJh+mihOWKoOi9vea1i+ivlScsICgpID0+IHtcbiAgICBpdCgn5bqU6K+l6aKE5Yqg6L295Y2V5byg5Zu+54mHJywgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC51c2VGYWtlVGltZXJzKCk7XG5cbiAgICAgIGNvbnN0IG1vY2tTcmMgPSAnaHR0cHM6Ly9leGFtcGxlLmNvbS9pbWFnZS5qcGcnO1xuICAgICAgbGV0IHJlc29sdmVMb2FkOiAoKSA9PiB2b2lkO1xuICAgICAgY29uc3QgbG9hZFByb21pc2UgPSBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSkgPT4ge1xuICAgICAgICByZXNvbHZlTG9hZCA9IHJlc29sdmU7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbW9ja0ltYWdlID0ge1xuICAgICAgICBvbmxvYWQ6IG51bGwgYXMgKChldjogRXZlbnQpID0+IGFueSkgfCBudWxsLFxuICAgICAgICBvbmVycm9yOiBudWxsIGFzICgoZXY6IEV2ZW50KSA9PiBhbnkpIHwgbnVsbCxcbiAgICAgICAgc3JjOiAnJyxcbiAgICAgIH07XG5cbiAgICAgIGplc3RcbiAgICAgICAgLnNweU9uKHdpbmRvdywgJ0ltYWdlJylcbiAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAobW9ja0ltYWdlLm9ubG9hZCkge1xuICAgICAgICAgICAgICBtb2NrSW1hZ2Uub25sb2FkLmNhbGwobW9ja0ltYWdlLCBuZXcgRXZlbnQoJ2xvYWQnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXNvbHZlTG9hZCgpO1xuICAgICAgICAgIH0sIDEwMCk7XG5cbiAgICAgICAgICByZXR1cm4gbW9ja0ltYWdlIGFzIHVua25vd24gYXMgSFRNTEltYWdlRWxlbWVudDtcbiAgICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IHByZWxvYWRMYXp5SW1hZ2UobW9ja1NyYyk7XG5cbiAgICAgIGV4cGVjdChtb2NrSW1hZ2Uub25sb2FkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgYXdhaXQgbG9hZFByb21pc2U7XG5cbiAgICAgIGplc3QudXNlUmVhbFRpbWVycygpO1xuICAgIH0sIDEwMDAwKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ+Wtl+S9k+mihOWKoOi9vea1i+ivlScsICgpID0+IHtcbiAgICBpdCgn5bqU6K+l6aKE5Yqg6L295Y2V5Liq5a2X5L2TJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ZvbnQgPSB7XG4gICAgICAgIGZvbnRGYW1pbHk6ICdUZXN0IEZvbnQnLFxuICAgICAgICBmb250U3JjOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9mb250LndvZmYyJyxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHByZWxvYWRGb250KG1vY2tGb250LmZvbnRGYW1pbHksIG1vY2tGb250LmZvbnRTcmMpO1xuXG4gICAgICBjb25zdCBzdGF0cyA9IGdldEZvbnRQcmVsb2FkZXJTdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+W6lOivpea4heepuuWtl+S9k+e8k+WtmCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tGb250ID0ge1xuICAgICAgICBmb250RmFtaWx5OiAnVGVzdCBGb250JyxcbiAgICAgICAgZm9udFNyYzogJ2h0dHBzOi8vZXhhbXBsZS5jb20vZm9udC53b2ZmMicsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBwcmVsb2FkRm9udChtb2NrRm9udC5mb250RmFtaWx5LCBtb2NrRm9udC5mb250U3JjKTtcblxuICAgICAgY2xlYXJGb250Q2FjaGUoKTtcblxuICAgICAgY29uc3Qgc3RhdHMgPSBnZXRGb250UHJlbG9hZGVyU3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy5jYWNoZVNpemUpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCfotYTmupDpooTliqDovb3mtYvor5UnLCAoKSA9PiB7XG4gICAgaXQoJ+W6lOivpemihOWKoOi9veWNleS4qui1hOa6kCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVcmwgPSAnaHR0cHM6Ly9leGFtcGxlLmNvbS9zY3JpcHQuanMnO1xuXG4gICAgICBwcmVsb2FkUmVzb3VyY2UobW9ja1VybCwgJ3NjcmlwdCcpO1xuXG4gICAgICBleHBlY3QoaXNQcmVsb2FkZWQobW9ja1VybCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgn5bqU6K+l5om56YeP6aKE5Yqg6L296LWE5rqQJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc291cmNlcyA9IFtcbiAgICAgICAgeyB1cmw6ICdodHRwczovL2V4YW1wbGUuY29tL3NjcmlwdC5qcycsIHR5cGU6ICdzY3JpcHQnIGFzIGNvbnN0IH0sXG4gICAgICAgIHsgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9zdHlsZS5jc3MnLCB0eXBlOiAnc3R5bGUnIGFzIGNvbnN0IH0sXG4gICAgICBdO1xuXG4gICAgICBwcmVsb2FkUmVzb3VyY2VzKG1vY2tSZXNvdXJjZXMpO1xuXG4gICAgICBleHBlY3QoaXNQcmVsb2FkZWQobW9ja1Jlc291cmNlc1swXS51cmwpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGlzUHJlbG9hZGVkKG1vY2tSZXNvdXJjZXNbMV0udXJsKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCflupTor6XpooTliqDovb3lhbPplK7otYTmupAnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVzb3VyY2VzID0gW3sgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9zY3JpcHQuanMnLCB0eXBlOiAnc2NyaXB0JyBhcyBjb25zdCB9XTtcblxuICAgICAgcHJlbG9hZENyaXRpY2FsUmVzb3VyY2VzKG1vY2tSZXNvdXJjZXMpO1xuXG4gICAgICBleHBlY3QoaXNQcmVsb2FkZWQobW9ja1Jlc291cmNlc1swXS51cmwpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+W6lOivpemihOi/nuaOpeWIsOa6kCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVcmwgPSAnaHR0cHM6Ly9leGFtcGxlLmNvbSc7XG5cbiAgICAgIHByZWNvbm5lY3QobW9ja1VybCk7XG5cbiAgICAgIGV4cGVjdChpc1ByZWNvbm5lY3RlZChtb2NrVXJsKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCflupTor6Xmibnph4/pooTov57mjqXliLDmupAnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXJscyA9IFsnaHR0cHM6Ly9leGFtcGxlMS5jb20nLCAnaHR0cHM6Ly9leGFtcGxlMi5jb20nXTtcblxuICAgICAgcHJlY29ubmVjdE9yaWdpbnMobW9ja1VybHMpO1xuXG4gICAgICBleHBlY3QoaXNQcmVjb25uZWN0ZWQobW9ja1VybHNbMF0pKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGlzUHJlY29ubmVjdGVkKG1vY2tVcmxzWzFdKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCflupTor6XpooTlj5botYTmupAnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXJsID0gJ2h0dHBzOi8vZXhhbXBsZS5jb20vc2NyaXB0LmpzJztcblxuICAgICAgcHJlZmV0Y2gobW9ja1VybCwgJ3NjcmlwdCcpO1xuXG4gICAgICBleHBlY3QoaXNQcmVmZXRjaGVkKG1vY2tVcmwpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+W6lOivpeaJuemHj+mihOWPlui1hOa6kCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXNvdXJjZXMgPSBbXG4gICAgICAgIHsgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9zY3JpcHQuanMnLCB0eXBlOiAnc2NyaXB0JyBhcyBjb25zdCB9LFxuICAgICAgICB7IHVybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vc3R5bGUuY3NzJywgdHlwZTogJ3N0eWxlJyBhcyBjb25zdCB9LFxuICAgICAgXTtcblxuICAgICAgcHJlZmV0Y2hSZXNvdXJjZXMobW9ja1Jlc291cmNlcyk7XG5cbiAgICAgIGV4cGVjdChpc1ByZWZldGNoZWQobW9ja1Jlc291cmNlc1swXS51cmwpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGlzUHJlZmV0Y2hlZChtb2NrUmVzb3VyY2VzWzFdLnVybCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgn5bqU6K+l6aKE5Yqg6L296ISa5pysJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VybCA9ICdodHRwczovL2V4YW1wbGUuY29tL3NjcmlwdC5qcyc7XG5cbiAgICAgIHByZWxvYWRTY3JpcHQobW9ja1VybCk7XG5cbiAgICAgIGV4cGVjdChpc1ByZWxvYWRlZChtb2NrVXJsKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCflupTor6XpooTliqDovb3moLflvI8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXJsID0gJ2h0dHBzOi8vZXhhbXBsZS5jb20vc3R5bGUuY3NzJztcblxuICAgICAgcHJlbG9hZFN0eWxlKG1vY2tVcmwpO1xuXG4gICAgICBleHBlY3QoaXNQcmVsb2FkZWQobW9ja1VybCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgn5bqU6K+l6aKE5Yqg6L295Zu+54mHJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VybCA9ICdodHRwczovL2V4YW1wbGUuY29tL2ltYWdlLmpwZyc7XG5cbiAgICAgIHByZWxvYWRSZXNvdXJjZUltYWdlKG1vY2tVcmwpO1xuXG4gICAgICBleHBlY3QoaXNQcmVsb2FkZWQobW9ja1VybCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgn5bqU6K+l6aKE5Yqg6L295a2X5L2TJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VybCA9ICdodHRwczovL2V4YW1wbGUuY29tL2ZvbnQud29mZjInO1xuXG4gICAgICBwcmVsb2FkUmVzb3VyY2VGb250KG1vY2tVcmwpO1xuXG4gICAgICBleHBlY3QoaXNQcmVsb2FkZWQobW9ja1VybCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgn5bqU6K+l5riF56m65omA5pyJ6LWE5rqQ57yT5a2YJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VybCA9ICdodHRwczovL2V4YW1wbGUuY29tL3NjcmlwdC5qcyc7XG5cbiAgICAgIHByZWxvYWRSZXNvdXJjZShtb2NrVXJsLCAnc2NyaXB0Jyk7XG5cbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcblxuICAgICAgZXhwZWN0KGdldFJlc291cmNlUHJlbG9hZGVyU3RhdHMoKS5jb3VudCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuXG4gICAgICBjbGVhckFsbFJlc291cmNlcygpO1xuXG4gICAgICBleHBlY3QoZ2V0UmVzb3VyY2VQcmVsb2FkZXJTdGF0cygpLmNvdW50KS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ+W6lOivpeeUn+aIkOmihOWKoOi9veaPkOekuicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVcmwgPSAnaHR0cHM6Ly9leGFtcGxlLmNvbS9zY3JpcHQuanMnO1xuXG4gICAgICBwcmVsb2FkUmVzb3VyY2UobW9ja1VybCwgJ3NjcmlwdCcpO1xuXG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG5cbiAgICAgIGNvbnN0IGhpbnRzID0gZ2VuZXJhdGVQcmVsb2FkSGludHMoKTtcbiAgICAgIGV4cGVjdChoaW50cy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ+aAp+iDveWfuuWHhua1i+ivlScsICgpID0+IHtcbiAgICBpdCgn5bqU6K+l5rWL6YeP5Zu+54mH5Yqg6L295oCn6IO9JywgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC51c2VGYWtlVGltZXJzKCk7XG5cbiAgICAgIGNvbnN0IG1vY2tTcmMgPSAnaHR0cHM6Ly9leGFtcGxlLmNvbS9pbWFnZS5qcGcnO1xuICAgICAgbGV0IHJlc29sdmVMb2FkOiAoKSA9PiB2b2lkO1xuICAgICAgY29uc3QgbG9hZFByb21pc2UgPSBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSkgPT4ge1xuICAgICAgICByZXNvbHZlTG9hZCA9IHJlc29sdmU7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbW9ja0ltYWdlID0ge1xuICAgICAgICBvbmxvYWQ6IG51bGwgYXMgKChldjogRXZlbnQpID0+IGFueSkgfCBudWxsLFxuICAgICAgICBvbmVycm9yOiBudWxsIGFzICgoZXY6IEV2ZW50KSA9PiBhbnkpIHwgbnVsbCxcbiAgICAgICAgc3JjOiAnJyxcbiAgICAgIH07XG5cbiAgICAgIGplc3RcbiAgICAgICAgLnNweU9uKHdpbmRvdywgJ0ltYWdlJylcbiAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAobW9ja0ltYWdlLm9ubG9hZCkge1xuICAgICAgICAgICAgICBtb2NrSW1hZ2Uub25sb2FkKG5ldyBFdmVudCgnbG9hZCcpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc29sdmVMb2FkKCk7XG4gICAgICAgICAgfSwgMTAwKTtcblxuICAgICAgICAgIHJldHVybiBtb2NrSW1hZ2UgYXMgdW5rbm93biBhcyBIVE1MSW1hZ2VFbGVtZW50O1xuICAgICAgICB9KTtcblxuICAgICAgY29uc3Qgc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcblxuICAgICAgYXdhaXQgcHJlbG9hZExhenlJbWFnZShtb2NrU3JjKTtcblxuICAgICAgamVzdC5ydW5BbGxUaW1lcnMoKTtcbiAgICAgIGF3YWl0IGxvYWRQcm9taXNlO1xuXG4gICAgICBjb25zdCBlbmQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIGNvbnN0IGxvYWRUaW1lID0gZW5kIC0gc3RhcnQ7XG5cbiAgICAgIGV4cGVjdChsb2FkVGltZSkudG9CZUxlc3NUaGFuKDEwMDApO1xuXG4gICAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKTtcbiAgICB9LCAxMDAwMCk7XG5cbiAgICBpdCgn5bqU6K+l5rWL6YeP5a2X5L2T5Yqg6L295oCn6IO9JywgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC51c2VGYWtlVGltZXJzKCk7XG5cbiAgICAgIGplc3Quc3B5T24oZG9jdW1lbnQuaGVhZCwgJ2FwcGVuZENoaWxkJykubW9ja0ltcGxlbWVudGF0aW9uKChub2RlKSA9PiB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEV2ZW50KCdsb2FkJyk7XG4gICAgICAgICAgKG5vZGUgYXMgSFRNTEVsZW1lbnQpLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICAgICAgICB9LCAxMDApO1xuICAgICAgICByZXR1cm4gbm9kZTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBtb2NrRm9udCA9IHtcbiAgICAgICAgZm9udEZhbWlseTogJ1Rlc3QgRm9udCcsXG4gICAgICAgIGZvbnRTcmM6ICdodHRwczovL2V4YW1wbGUuY29tL2ZvbnQud29mZjInLFxuICAgICAgfTtcblxuICAgICAgY29uc3Qgc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcblxuICAgICAgYXdhaXQgcHJlbG9hZEZvbnQobW9ja0ZvbnQuZm9udEZhbWlseSwgbW9ja0ZvbnQuZm9udFNyYyk7XG5cbiAgICAgIGplc3QucnVuQWxsVGltZXJzKCk7XG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMjAwKSk7XG5cbiAgICAgIGNvbnN0IGVuZCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgY29uc3QgbG9hZFRpbWUgPSBlbmQgLSBzdGFydDtcblxuICAgICAgZXhwZWN0KGxvYWRUaW1lKS50b0JlTGVzc1RoYW4oNTAwKTtcblxuICAgICAgamVzdC51c2VSZWFsVGltZXJzKCk7XG4gICAgfSwgMTAwMDApO1xuXG4gICAgaXQoJ+W6lOivpea1i+mHj+i1hOa6kOmihOWKoOi9veaAp+iDvScsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3QudXNlRmFrZVRpbWVycygpO1xuXG4gICAgICBqZXN0LnNweU9uKGRvY3VtZW50LmhlYWQsICdhcHBlbmRDaGlsZCcpLm1vY2tJbXBsZW1lbnRhdGlvbigobm9kZSkgPT4ge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBjb25zdCBldmVudCA9IG5ldyBFdmVudCgnbG9hZCcpO1xuICAgICAgICAgIChub2RlIGFzIEhUTUxFbGVtZW50KS5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbW9ja1VybCA9ICdodHRwczovL2V4YW1wbGUuY29tL3NjcmlwdC5qcyc7XG5cbiAgICAgIGNvbnN0IHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG5cbiAgICAgIHByZWxvYWRSZXNvdXJjZShtb2NrVXJsLCAnc2NyaXB0Jyk7XG5cbiAgICAgIGplc3QucnVuQWxsVGltZXJzKCk7XG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMjAwKSk7XG5cbiAgICAgIGNvbnN0IGVuZCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgY29uc3QgbG9hZFRpbWUgPSBlbmQgLSBzdGFydDtcblxuICAgICAgZXhwZWN0KGxvYWRUaW1lKS50b0JlTGVzc1RoYW4oNTAwKTtcblxuICAgICAgamVzdC51c2VSZWFsVGltZXJzKCk7XG4gICAgfSwgMTAwMDApO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9