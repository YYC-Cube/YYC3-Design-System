5056d9e88ff67e950aa0fccab4bdbb0f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Dropdown = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
/**
 * @file 下拉菜单组件
 * @description 下拉菜单组件，支持键盘导航和多级菜单
 * @component Dropdown
 * @author YYC³
 * @version 1.0.0
 * @created 2026-02-23
 * @updated 2026-02-23
 * @copyright Copyright (c) 2026 YYC³
 * @license MIT
 */
const react_1 = require("react");
const ThemeProvider_1 = require("../theme/ThemeProvider");
exports.Dropdown = (0, react_1.memo)(({ trigger = 'click', placement = 'bottomLeft', options, children, disabled = false, visible: controlledVisible, onVisibleChange, className = '', 'data-testid': dataTestId, }) => {
    const { tokens } = (0, ThemeProvider_1.useTheme)();
    const [internalVisible, setInternalVisible] = (0, react_1.useState)(false);
    const [activeKey, setActiveKey] = (0, react_1.useState)(null);
    const containerRef = (0, react_1.useRef)(null);
    const dropdownRef = (0, react_1.useRef)(null);
    const visible = controlledVisible !== undefined ? controlledVisible : internalVisible;
    const handleVisibleChange = (0, react_1.useCallback)((newVisible) => {
        if (disabled)
            return;
        setInternalVisible(newVisible);
        onVisibleChange?.(newVisible);
    }, [disabled, onVisibleChange]);
    const handleClick = (0, react_1.useCallback)(() => {
        if (trigger === 'click') {
            handleVisibleChange(!visible);
        }
    }, [trigger, visible, handleVisibleChange]);
    const handleMouseEnter = (0, react_1.useCallback)(() => {
        if (trigger === 'hover') {
            handleVisibleChange(true);
        }
    }, [trigger, handleVisibleChange]);
    const handleMouseLeave = (0, react_1.useCallback)(() => {
        if (trigger === 'hover') {
            handleVisibleChange(false);
        }
    }, [trigger, handleVisibleChange]);
    const handleOptionClick = (0, react_1.useCallback)((option) => {
        if (option.disabled)
            return;
        option.onClick?.();
        handleVisibleChange(false);
    }, [handleVisibleChange]);
    const handleKeyDown = (0, react_1.useCallback)((e) => {
        if (!visible || disabled)
            return;
        const enabledOptions = options.filter((opt) => !opt.disabled);
        const currentIndex = enabledOptions.findIndex((opt) => opt.key === activeKey);
        switch (e.key) {
            case 'ArrowDown':
                e.preventDefault();
                const nextIndex = currentIndex < enabledOptions.length - 1 ? currentIndex + 1 : 0;
                setActiveKey(enabledOptions[nextIndex].key);
                break;
            case 'ArrowUp':
                e.preventDefault();
                const prevIndex = currentIndex > 0 ? currentIndex - 1 : enabledOptions.length - 1;
                setActiveKey(enabledOptions[prevIndex].key);
                break;
            case 'Enter':
            case ' ':
                e.preventDefault();
                if (activeKey) {
                    const option = options.find((opt) => opt.key === activeKey);
                    if (option) {
                        handleOptionClick(option);
                    }
                }
                break;
            case 'Escape':
                e.preventDefault();
                handleVisibleChange(false);
                break;
        }
    }, [visible, disabled, options, activeKey, handleOptionClick, handleVisibleChange]);
    (0, react_1.useEffect)(() => {
        const handleClickOutside = (event) => {
            if (containerRef.current && !containerRef.current.contains(event.target)) {
                handleVisibleChange(false);
            }
        };
        if (visible) {
            document.addEventListener('mousedown', handleClickOutside);
            return () => {
                document.removeEventListener('mousedown', handleClickOutside);
            };
        }
    }, [visible, handleVisibleChange]);
    (0, react_1.useEffect)(() => {
        if (visible) {
            const firstEnabledOption = options.find((opt) => !opt.disabled);
            if (firstEnabledOption) {
                setActiveKey(firstEnabledOption.key);
            }
        }
        else {
            setActiveKey(null);
        }
    }, [visible, options]);
    const getPlacementStyles = () => {
        const baseStyles = {
            position: 'absolute',
            zIndex: 1000,
            minWidth: '160px',
            maxHeight: '300px',
            overflowY: 'auto',
        };
        switch (placement) {
            case 'bottomLeft':
                return { ...baseStyles, top: '100%', left: 0, marginTop: '4px' };
            case 'bottomCenter':
                return {
                    ...baseStyles,
                    top: '100%',
                    left: '50%',
                    transform: 'translateX(-50%)',
                    marginTop: '4px',
                };
            case 'bottomRight':
                return { ...baseStyles, top: '100%', right: 0, marginTop: '4px' };
            case 'topLeft':
                return { ...baseStyles, bottom: '100%', left: 0, marginBottom: '4px' };
            case 'topCenter':
                return {
                    ...baseStyles,
                    bottom: '100%',
                    left: '50%',
                    transform: 'translateX(-50%)',
                    marginBottom: '4px',
                };
            case 'topRight':
                return { ...baseStyles, bottom: '100%', right: 0, marginBottom: '4px' };
            default:
                return baseStyles;
        }
    };
    const containerStyles = {
        position: 'relative',
        display: 'inline-block',
    };
    const dropdownStyles = {
        ...getPlacementStyles(),
        backgroundColor: tokens['color.background'] || '#fff',
        border: `1px solid ${tokens['color.border'] || '#e0e0e0'}`,
        borderRadius: '4px',
        boxShadow: `0 2px 8px rgba(0, 0, 0, 0.1)`,
        padding: '4px 0',
        opacity: visible ? 1 : 0,
        visibility: visible ? 'visible' : 'hidden',
        transition: 'opacity 0.2s, visibility 0.2s',
    };
    const optionStyles = {
        padding: '8px 12px',
        display: 'flex',
        alignItems: 'center',
        gap: '8px',
        cursor: 'pointer',
        transition: 'background-color 0.2s',
        fontSize: '14px',
        color: tokens['color.text.primary'] || '#333',
    };
    const optionHoverStyles = {
        ...optionStyles,
        backgroundColor: tokens['color.hover'] || '#f5f5f5',
    };
    const activeOptionStyles = {
        ...optionStyles,
        backgroundColor: tokens['color.primary.light'] || '#f0f0f0',
    };
    const disabledOptionStyles = {
        ...optionStyles,
        opacity: 0.5,
        cursor: 'not-allowed',
    };
    const dividerStyles = {
        height: '1px',
        backgroundColor: tokens['color.border'] || '#e0e0e0',
        margin: '4px 0',
    };
    const iconStyles = {
        fontSize: '16px',
        color: tokens['color.text.secondary'] || '#666',
    };
    const arrowStyles = {
        marginLeft: 'auto',
        fontSize: '12px',
        color: tokens['color.text.disabled'] || '#999',
    };
    const renderOption = (option, level = 0) => {
        const isActive = option.key === activeKey;
        const hasChildren = option.children && option.children.length > 0;
        return ((0, jsx_runtime_1.jsxs)("div", { children: [option.divider ? ((0, jsx_runtime_1.jsx)("div", { style: dividerStyles })) : ((0, jsx_runtime_1.jsxs)("div", { style: {
                        ...(option.disabled
                            ? disabledOptionStyles
                            : isActive
                                ? activeOptionStyles
                                : optionStyles),
                        paddingLeft: `${12 + level * 16}px`,
                    }, onClick: () => handleOptionClick(option), onMouseEnter: () => !option.disabled && setActiveKey(option.key), onMouseLeave: () => !option.disabled && setActiveKey(null), role: "menuitem", tabIndex: -1, "aria-disabled": option.disabled, children: [option.icon && (0, jsx_runtime_1.jsx)("span", { style: iconStyles, children: option.icon }), (0, jsx_runtime_1.jsx)("span", { children: option.label }), hasChildren && (0, jsx_runtime_1.jsx)("span", { style: arrowStyles, children: "\u203A" })] })), hasChildren && ((0, jsx_runtime_1.jsx)("div", { children: option.children?.map((child) => renderOption(child, level + 1)) }))] }, option.key));
    };
    return ((0, jsx_runtime_1.jsxs)("div", { ref: containerRef, className: className, style: containerStyles, "data-testid": dataTestId, onClick: handleClick, onMouseEnter: handleMouseEnter, onMouseLeave: handleMouseLeave, onKeyDown: handleKeyDown, tabIndex: 0, role: "button", "aria-haspopup": "true", "aria-expanded": visible, children: [children, visible && ((0, jsx_runtime_1.jsx)("div", { ref: dropdownRef, style: dropdownStyles, role: "menu", "aria-label": "Dropdown menu", children: options.map((option) => renderOption(option)) }))] }));
});
exports.Dropdown.displayName = 'Dropdown';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3lhbnl1L0Rvd25sb2Fkcy95eWMzLURlc2lnbi1TeXN0ZW0vc3JjL2NvbXBvbmVudHMvRHJvcGRvd24udHN4IiwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7Ozs7Ozs7OztHQVVHO0FBRUgsaUNBQWdHO0FBQ2hHLDBEQUFrRDtBQXdCckMsUUFBQSxRQUFRLEdBQUcsSUFBQSxZQUFJLEVBQzFCLENBQUMsRUFDQyxPQUFPLEdBQUcsT0FBTyxFQUNqQixTQUFTLEdBQUcsWUFBWSxFQUN4QixPQUFPLEVBQ1AsUUFBUSxFQUNSLFFBQVEsR0FBRyxLQUFLLEVBQ2hCLE9BQU8sRUFBRSxpQkFBaUIsRUFDMUIsZUFBZSxFQUNmLFNBQVMsR0FBRyxFQUFFLEVBQ2QsYUFBYSxFQUFFLFVBQVUsR0FDMUIsRUFBRSxFQUFFO0lBQ0gsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLElBQUEsd0JBQVEsR0FBRSxDQUFDO0lBQzlCLE1BQU0sQ0FBQyxlQUFlLEVBQUUsa0JBQWtCLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsS0FBSyxDQUFDLENBQUM7SUFDOUQsTUFBTSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQWdCLElBQUksQ0FBQyxDQUFDO0lBQ2hFLE1BQU0sWUFBWSxHQUFHLElBQUEsY0FBTSxFQUFpQixJQUFJLENBQUMsQ0FBQztJQUNsRCxNQUFNLFdBQVcsR0FBRyxJQUFBLGNBQU0sRUFBaUIsSUFBSSxDQUFDLENBQUM7SUFFakQsTUFBTSxPQUFPLEdBQUcsaUJBQWlCLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDO0lBRXRGLE1BQU0sbUJBQW1CLEdBQUcsSUFBQSxtQkFBVyxFQUNyQyxDQUFDLFVBQW1CLEVBQUUsRUFBRTtRQUN0QixJQUFJLFFBQVE7WUFBRSxPQUFPO1FBQ3JCLGtCQUFrQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQy9CLGVBQWUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lB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Q0FBQztJQUVGLE9BQU8sQ0FDTCxpQ0FDRSxHQUFHLEVBQUUsWUFBWSxFQUNqQixTQUFTLEVBQUUsU0FBUyxFQUNwQixLQUFLLEVBQUUsZUFBZSxpQkFDVCxVQUFVLEVBQ3ZCLE9BQU8sRUFBRSxXQUFXLEVBQ3BCLFlBQVksRUFBRSxnQkFBZ0IsRUFDOUIsWUFBWSxFQUFFLGdCQUFnQixFQUM5QixTQUFTLEVBQUUsYUFBYSxFQUN4QixRQUFRLEVBQUUsQ0FBQyxFQUNYLElBQUksRUFBQyxRQUFRLG1CQUNDLE1BQU0sbUJBQ0wsT0FBTyxhQUVyQixRQUFRLEVBQ1IsT0FBTyxJQUFJLENBQ1YsZ0NBQUssR0FBRyxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBQyxNQUFNLGdCQUFZLGVBQWUsWUFDakYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQzFDLENBQ1AsSUFDRyxDQUNQLENBQUM7QUFDSixDQUFDLENBQ0YsQ0FBQztBQUVGLGdCQUFRLENBQUMsV0FBVyxHQUFHLFVBQVUsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMveWFueXUvRG93bmxvYWRzL3l5YzMtRGVzaWduLVN5c3RlbS9zcmMvY29tcG9uZW50cy9Ecm9wZG93bi50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSDkuIvmi4noj5zljZXnu4Tku7ZcbiAqIEBkZXNjcmlwdGlvbiDkuIvmi4noj5zljZXnu4Tku7bvvIzmlK/mjIHplK7nm5jlr7zoiKrlkozlpJrnuqfoj5zljZVcbiAqIEBjb21wb25lbnQgRHJvcGRvd25cbiAqIEBhdXRob3IgWVlDwrNcbiAqIEB2ZXJzaW9uIDEuMC4wXG4gKiBAY3JlYXRlZCAyMDI2LTAyLTIzXG4gKiBAdXBkYXRlZCAyMDI2LTAyLTIzXG4gKiBAY29weXJpZ2h0IENvcHlyaWdodCAoYykgMjAyNiBZWUPCs1xuICogQGxpY2Vuc2UgTUlUXG4gKi9cblxuaW1wb3J0IHsgbWVtbywgdXNlU3RhdGUsIHVzZVJlZiwgdXNlRWZmZWN0LCB1c2VDYWxsYmFjaywgUmVhY3ROb2RlLCBSZWFjdEVsZW1lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyB1c2VUaGVtZSB9IGZyb20gJy4uL3RoZW1lL1RoZW1lUHJvdmlkZXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIERyb3Bkb3duT3B0aW9uIHtcbiAga2V5OiBzdHJpbmc7XG4gIGxhYmVsOiBSZWFjdE5vZGU7XG4gIGljb24/OiBSZWFjdE5vZGU7XG4gIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgZGl2aWRlcj86IGJvb2xlYW47XG4gIGNoaWxkcmVuPzogRHJvcGRvd25PcHRpb25bXTtcbiAgb25DbGljaz86ICgpID0+IHZvaWQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRHJvcGRvd25Qcm9wcyB7XG4gIHRyaWdnZXI/OiAnY2xpY2snIHwgJ2hvdmVyJztcbiAgcGxhY2VtZW50PzogJ2JvdHRvbUxlZnQnIHwgJ2JvdHRvbUNlbnRlcicgfCAnYm90dG9tUmlnaHQnIHwgJ3RvcExlZnQnIHwgJ3RvcENlbnRlcicgfCAndG9wUmlnaHQnO1xuICBvcHRpb25zOiBEcm9wZG93bk9wdGlvbltdO1xuICBjaGlsZHJlbjogUmVhY3RFbGVtZW50O1xuICBkaXNhYmxlZD86IGJvb2xlYW47XG4gIHZpc2libGU/OiBib29sZWFuO1xuICBvblZpc2libGVDaGFuZ2U/OiAodmlzaWJsZTogYm9vbGVhbikgPT4gdm9pZDtcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICAnZGF0YS10ZXN0aWQnPzogc3RyaW5nO1xufVxuXG5leHBvcnQgY29uc3QgRHJvcGRvd24gPSBtZW1vPERyb3Bkb3duUHJvcHM+KFxuICAoe1xuICAgIHRyaWdnZXIgPSAnY2xpY2snLFxuICAgIHBsYWNlbWVudCA9ICdib3R0b21MZWZ0JyxcbiAgICBvcHRpb25zLFxuICAgIGNoaWxkcmVuLFxuICAgIGRpc2FibGVkID0gZmFsc2UsXG4gICAgdmlzaWJsZTogY29udHJvbGxlZFZpc2libGUsXG4gICAgb25WaXNpYmxlQ2hhbmdlLFxuICAgIGNsYXNzTmFtZSA9ICcnLFxuICAgICdkYXRhLXRlc3RpZCc6IGRhdGFUZXN0SWQsXG4gIH0pID0+IHtcbiAgICBjb25zdCB7IHRva2VucyB9ID0gdXNlVGhlbWUoKTtcbiAgICBjb25zdCBbaW50ZXJuYWxWaXNpYmxlLCBzZXRJbnRlcm5hbFZpc2libGVdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFthY3RpdmVLZXksIHNldEFjdGl2ZUtleV0gPSB1c2VTdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTtcbiAgICBjb25zdCBjb250YWluZXJSZWYgPSB1c2VSZWY8SFRNTERpdkVsZW1lbnQ+KG51bGwpO1xuICAgIGNvbnN0IGRyb3Bkb3duUmVmID0gdXNlUmVmPEhUTUxEaXZFbGVtZW50PihudWxsKTtcblxuICAgIGNvbnN0IHZpc2libGUgPSBjb250cm9sbGVkVmlzaWJsZSAhPT0gdW5kZWZpbmVkID8gY29udHJvbGxlZFZpc2libGUgOiBpbnRlcm5hbFZpc2libGU7XG5cbiAgICBjb25zdCBoYW5kbGVWaXNpYmxlQ2hhbmdlID0gdXNlQ2FsbGJhY2soXG4gICAgICAobmV3VmlzaWJsZTogYm9vbGVhbikgPT4ge1xuICAgICAgICBpZiAoZGlzYWJsZWQpIHJldHVybjtcbiAgICAgICAgc2V0SW50ZXJuYWxWaXNpYmxlKG5ld1Zpc2libGUpO1xuICAgICAgICBvblZpc2libGVDaGFuZ2U/LihuZXdWaXNpYmxlKTtcbiAgICAgIH0sXG4gICAgICBbZGlzYWJsZWQsIG9uVmlzaWJsZUNoYW5nZV1cbiAgICApO1xuXG4gICAgY29uc3QgaGFuZGxlQ2xpY2sgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBpZiAodHJpZ2dlciA9PT0gJ2NsaWNrJykge1xuICAgICAgICBoYW5kbGVWaXNpYmxlQ2hhbmdlKCF2aXNpYmxlKTtcbiAgICAgIH1cbiAgICB9LCBbdHJpZ2dlciwgdmlzaWJsZSwgaGFuZGxlVmlzaWJsZUNoYW5nZV0pO1xuXG4gICAgY29uc3QgaGFuZGxlTW91c2VFbnRlciA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIGlmICh0cmlnZ2VyID09PSAnaG92ZXInKSB7XG4gICAgICAgIGhhbmRsZVZpc2libGVDaGFuZ2UodHJ1ZSk7XG4gICAgICB9XG4gICAgfSwgW3RyaWdnZXIsIGhhbmRsZVZpc2libGVDaGFuZ2VdKTtcblxuICAgIGNvbnN0IGhhbmRsZU1vdXNlTGVhdmUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBpZiAodHJpZ2dlciA9PT0gJ2hvdmVyJykge1xuICAgICAgICBoYW5kbGVWaXNpYmxlQ2hhbmdlKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9LCBbdHJpZ2dlciwgaGFuZGxlVmlzaWJsZUNoYW5nZV0pO1xuXG4gICAgY29uc3QgaGFuZGxlT3B0aW9uQ2xpY2sgPSB1c2VDYWxsYmFjayhcbiAgICAgIChvcHRpb246IERyb3Bkb3duT3B0aW9uKSA9PiB7XG4gICAgICAgIGlmIChvcHRpb24uZGlzYWJsZWQpIHJldHVybjtcbiAgICAgICAgb3B0aW9uLm9uQ2xpY2s/LigpO1xuICAgICAgICBoYW5kbGVWaXNpYmxlQ2hhbmdlKGZhbHNlKTtcbiAgICAgIH0sXG4gICAgICBbaGFuZGxlVmlzaWJsZUNoYW5nZV1cbiAgICApO1xuXG4gICAgY29uc3QgaGFuZGxlS2V5RG93biA9IHVzZUNhbGxiYWNrKFxuICAgICAgKGU6IFJlYWN0LktleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgICAgaWYgKCF2aXNpYmxlIHx8IGRpc2FibGVkKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgZW5hYmxlZE9wdGlvbnMgPSBvcHRpb25zLmZpbHRlcigob3B0KSA9PiAhb3B0LmRpc2FibGVkKTtcbiAgICAgICAgY29uc3QgY3VycmVudEluZGV4ID0gZW5hYmxlZE9wdGlvbnMuZmluZEluZGV4KChvcHQpID0+IG9wdC5rZXkgPT09IGFjdGl2ZUtleSk7XG5cbiAgICAgICAgc3dpdGNoIChlLmtleSkge1xuICAgICAgICAgIGNhc2UgJ0Fycm93RG93bic6XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBjb25zdCBuZXh0SW5kZXggPSBjdXJyZW50SW5kZXggPCBlbmFibGVkT3B0aW9ucy5sZW5ndGggLSAxID8gY3VycmVudEluZGV4ICsgMSA6IDA7XG4gICAgICAgICAgICBzZXRBY3RpdmVLZXkoZW5hYmxlZE9wdGlvbnNbbmV4dEluZGV4XS5rZXkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnQXJyb3dVcCc6XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBjb25zdCBwcmV2SW5kZXggPSBjdXJyZW50SW5kZXggPiAwID8gY3VycmVudEluZGV4IC0gMSA6IGVuYWJsZWRPcHRpb25zLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICBzZXRBY3RpdmVLZXkoZW5hYmxlZE9wdGlvbnNbcHJldkluZGV4XS5rZXkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnRW50ZXInOlxuICAgICAgICAgIGNhc2UgJyAnOlxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaWYgKGFjdGl2ZUtleSkge1xuICAgICAgICAgICAgICBjb25zdCBvcHRpb24gPSBvcHRpb25zLmZpbmQoKG9wdCkgPT4gb3B0LmtleSA9PT0gYWN0aXZlS2V5KTtcbiAgICAgICAgICAgICAgaWYgKG9wdGlvbikge1xuICAgICAgICAgICAgICAgIGhhbmRsZU9wdGlvbkNsaWNrKG9wdGlvbik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ0VzY2FwZSc6XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBoYW5kbGVWaXNpYmxlQ2hhbmdlKGZhbHNlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgW3Zpc2libGUsIGRpc2FibGVkLCBvcHRpb25zLCBhY3RpdmVLZXksIGhhbmRsZU9wdGlvbkNsaWNrLCBoYW5kbGVWaXNpYmxlQ2hhbmdlXVxuICAgICk7XG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgY29uc3QgaGFuZGxlQ2xpY2tPdXRzaWRlID0gKGV2ZW50OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgIGlmIChjb250YWluZXJSZWYuY3VycmVudCAmJiAhY29udGFpbmVyUmVmLmN1cnJlbnQuY29udGFpbnMoZXZlbnQudGFyZ2V0IGFzIE5vZGUpKSB7XG4gICAgICAgICAgaGFuZGxlVmlzaWJsZUNoYW5nZShmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGlmICh2aXNpYmxlKSB7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGhhbmRsZUNsaWNrT3V0c2lkZSk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgaGFuZGxlQ2xpY2tPdXRzaWRlKTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9LCBbdmlzaWJsZSwgaGFuZGxlVmlzaWJsZUNoYW5nZV0pO1xuXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgIGlmICh2aXNpYmxlKSB7XG4gICAgICAgIGNvbnN0IGZpcnN0RW5hYmxlZE9wdGlvbiA9IG9wdGlvbnMuZmluZCgob3B0KSA9PiAhb3B0LmRpc2FibGVkKTtcbiAgICAgICAgaWYgKGZpcnN0RW5hYmxlZE9wdGlvbikge1xuICAgICAgICAgIHNldEFjdGl2ZUtleShmaXJzdEVuYWJsZWRPcHRpb24ua2V5KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0QWN0aXZlS2V5KG51bGwpO1xuICAgICAgfVxuICAgIH0sIFt2aXNpYmxlLCBvcHRpb25zXSk7XG5cbiAgICBjb25zdCBnZXRQbGFjZW1lbnRTdHlsZXMgPSAoKTogUmVhY3QuQ1NTUHJvcGVydGllcyA9PiB7XG4gICAgICBjb25zdCBiYXNlU3R5bGVzOiBSZWFjdC5DU1NQcm9wZXJ0aWVzID0ge1xuICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgekluZGV4OiAxMDAwLFxuICAgICAgICBtaW5XaWR0aDogJzE2MHB4JyxcbiAgICAgICAgbWF4SGVpZ2h0OiAnMzAwcHgnLFxuICAgICAgICBvdmVyZmxvd1k6ICdhdXRvJyxcbiAgICAgIH07XG5cbiAgICAgIHN3aXRjaCAocGxhY2VtZW50KSB7XG4gICAgICAgIGNhc2UgJ2JvdHRvbUxlZnQnOlxuICAgICAgICAgIHJldHVybiB7IC4uLmJhc2VTdHlsZXMsIHRvcDogJzEwMCUnLCBsZWZ0OiAwLCBtYXJnaW5Ub3A6ICc0cHgnIH07XG4gICAgICAgIGNhc2UgJ2JvdHRvbUNlbnRlcic6XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLmJhc2VTdHlsZXMsXG4gICAgICAgICAgICB0b3A6ICcxMDAlJyxcbiAgICAgICAgICAgIGxlZnQ6ICc1MCUnLFxuICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCgtNTAlKScsXG4gICAgICAgICAgICBtYXJnaW5Ub3A6ICc0cHgnLFxuICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgJ2JvdHRvbVJpZ2h0JzpcbiAgICAgICAgICByZXR1cm4geyAuLi5iYXNlU3R5bGVzLCB0b3A6ICcxMDAlJywgcmlnaHQ6IDAsIG1hcmdpblRvcDogJzRweCcgfTtcbiAgICAgICAgY2FzZSAndG9wTGVmdCc6XG4gICAgICAgICAgcmV0dXJuIHsgLi4uYmFzZVN0eWxlcywgYm90dG9tOiAnMTAwJScsIGxlZnQ6IDAsIG1hcmdpbkJvdHRvbTogJzRweCcgfTtcbiAgICAgICAgY2FzZSAndG9wQ2VudGVyJzpcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uYmFzZVN0eWxlcyxcbiAgICAgICAgICAgIGJvdHRvbTogJzEwMCUnLFxuICAgICAgICAgICAgbGVmdDogJzUwJScsXG4gICAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKC01MCUpJyxcbiAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogJzRweCcsXG4gICAgICAgICAgfTtcbiAgICAgICAgY2FzZSAndG9wUmlnaHQnOlxuICAgICAgICAgIHJldHVybiB7IC4uLmJhc2VTdHlsZXMsIGJvdHRvbTogJzEwMCUnLCByaWdodDogMCwgbWFyZ2luQm90dG9tOiAnNHB4JyB9O1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiBiYXNlU3R5bGVzO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCBjb250YWluZXJTdHlsZXM6IFJlYWN0LkNTU1Byb3BlcnRpZXMgPSB7XG4gICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJyxcbiAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLFxuICAgIH07XG5cbiAgICBjb25zdCBkcm9wZG93blN0eWxlczogUmVhY3QuQ1NTUHJvcGVydGllcyA9IHtcbiAgICAgIC4uLmdldFBsYWNlbWVudFN0eWxlcygpLFxuICAgICAgYmFja2dyb3VuZENvbG9yOiAodG9rZW5zWydjb2xvci5iYWNrZ3JvdW5kJ10gYXMgc3RyaW5nKSB8fCAnI2ZmZicsXG4gICAgICBib3JkZXI6IGAxcHggc29saWQgJHsodG9rZW5zWydjb2xvci5ib3JkZXInXSBhcyBzdHJpbmcpIHx8ICcjZTBlMGUwJ31gLFxuICAgICAgYm9yZGVyUmFkaXVzOiAnNHB4JyxcbiAgICAgIGJveFNoYWRvdzogYDAgMnB4IDhweCByZ2JhKDAsIDAsIDAsIDAuMSlgLFxuICAgICAgcGFkZGluZzogJzRweCAwJyxcbiAgICAgIG9wYWNpdHk6IHZpc2libGUgPyAxIDogMCxcbiAgICAgIHZpc2liaWxpdHk6IHZpc2libGUgPyAndmlzaWJsZScgOiAnaGlkZGVuJyxcbiAgICAgIHRyYW5zaXRpb246ICdvcGFjaXR5IDAuMnMsIHZpc2liaWxpdHkgMC4ycycsXG4gICAgfTtcblxuICAgIGNvbnN0IG9wdGlvblN0eWxlczogUmVhY3QuQ1NTUHJvcGVydGllcyA9IHtcbiAgICAgIHBhZGRpbmc6ICc4cHggMTJweCcsXG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgICAgIGdhcDogJzhweCcsXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcbiAgICAgIHRyYW5zaXRpb246ICdiYWNrZ3JvdW5kLWNvbG9yIDAuMnMnLFxuICAgICAgZm9udFNpemU6ICcxNHB4JyxcbiAgICAgIGNvbG9yOiAodG9rZW5zWydjb2xvci50ZXh0LnByaW1hcnknXSBhcyBzdHJpbmcpIHx8ICcjMzMzJyxcbiAgICB9O1xuXG4gICAgY29uc3Qgb3B0aW9uSG92ZXJTdHlsZXM6IFJlYWN0LkNTU1Byb3BlcnRpZXMgPSB7XG4gICAgICAuLi5vcHRpb25TdHlsZXMsXG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6ICh0b2tlbnNbJ2NvbG9yLmhvdmVyJ10gYXMgc3RyaW5nKSB8fCAnI2Y1ZjVmNScsXG4gICAgfTtcblxuICAgIGNvbnN0IGFjdGl2ZU9wdGlvblN0eWxlczogUmVhY3QuQ1NTUHJvcGVydGllcyA9IHtcbiAgICAgIC4uLm9wdGlvblN0eWxlcyxcbiAgICAgIGJhY2tncm91bmRDb2xvcjogKHRva2Vuc1snY29sb3IucHJpbWFyeS5saWdodCddIGFzIHN0cmluZykgfHwgJyNmMGYwZjAnLFxuICAgIH07XG5cbiAgICBjb25zdCBkaXNhYmxlZE9wdGlvblN0eWxlczogUmVhY3QuQ1NTUHJvcGVydGllcyA9IHtcbiAgICAgIC4uLm9wdGlvblN0eWxlcyxcbiAgICAgIG9wYWNpdHk6IDAuNSxcbiAgICAgIGN1cnNvcjogJ25vdC1hbGxvd2VkJyxcbiAgICB9O1xuXG4gICAgY29uc3QgZGl2aWRlclN0eWxlczogUmVhY3QuQ1NTUHJvcGVydGllcyA9IHtcbiAgICAgIGhlaWdodDogJzFweCcsXG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6ICh0b2tlbnNbJ2NvbG9yLmJvcmRlciddIGFzIHN0cmluZykgfHwgJyNlMGUwZTAnLFxuICAgICAgbWFyZ2luOiAnNHB4IDAnLFxuICAgIH07XG5cbiAgICBjb25zdCBpY29uU3R5bGVzOiBSZWFjdC5DU1NQcm9wZXJ0aWVzID0ge1xuICAgICAgZm9udFNpemU6ICcxNnB4JyxcbiAgICAgIGNvbG9yOiAodG9rZW5zWydjb2xvci50ZXh0LnNlY29uZGFyeSddIGFzIHN0cmluZykgfHwgJyM2NjYnLFxuICAgIH07XG5cbiAgICBjb25zdCBhcnJvd1N0eWxlczogUmVhY3QuQ1NTUHJvcGVydGllcyA9IHtcbiAgICAgIG1hcmdpbkxlZnQ6ICdhdXRvJyxcbiAgICAgIGZvbnRTaXplOiAnMTJweCcsXG4gICAgICBjb2xvcjogKHRva2Vuc1snY29sb3IudGV4dC5kaXNhYmxlZCddIGFzIHN0cmluZykgfHwgJyM5OTknLFxuICAgIH07XG5cbiAgICBjb25zdCByZW5kZXJPcHRpb24gPSAob3B0aW9uOiBEcm9wZG93bk9wdGlvbiwgbGV2ZWwgPSAwKTogUmVhY3ROb2RlID0+IHtcbiAgICAgIGNvbnN0IGlzQWN0aXZlID0gb3B0aW9uLmtleSA9PT0gYWN0aXZlS2V5O1xuICAgICAgY29uc3QgaGFzQ2hpbGRyZW4gPSBvcHRpb24uY2hpbGRyZW4gJiYgb3B0aW9uLmNoaWxkcmVuLmxlbmd0aCA+IDA7XG5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYga2V5PXtvcHRpb24ua2V5fT5cbiAgICAgICAgICB7b3B0aW9uLmRpdmlkZXIgPyAoXG4gICAgICAgICAgICA8ZGl2IHN0eWxlPXtkaXZpZGVyU3R5bGVzfSAvPlxuICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgICAgLi4uKG9wdGlvbi5kaXNhYmxlZFxuICAgICAgICAgICAgICAgICAgPyBkaXNhYmxlZE9wdGlvblN0eWxlc1xuICAgICAgICAgICAgICAgICAgOiBpc0FjdGl2ZVxuICAgICAgICAgICAgICAgICAgICA/IGFjdGl2ZU9wdGlvblN0eWxlc1xuICAgICAgICAgICAgICAgICAgICA6IG9wdGlvblN0eWxlcyksXG4gICAgICAgICAgICAgICAgcGFkZGluZ0xlZnQ6IGAkezEyICsgbGV2ZWwgKiAxNn1weGAsXG4gICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IGhhbmRsZU9wdGlvbkNsaWNrKG9wdGlvbil9XG4gICAgICAgICAgICAgIG9uTW91c2VFbnRlcj17KCkgPT4gIW9wdGlvbi5kaXNhYmxlZCAmJiBzZXRBY3RpdmVLZXkob3B0aW9uLmtleSl9XG4gICAgICAgICAgICAgIG9uTW91c2VMZWF2ZT17KCkgPT4gIW9wdGlvbi5kaXNhYmxlZCAmJiBzZXRBY3RpdmVLZXkobnVsbCl9XG4gICAgICAgICAgICAgIHJvbGU9XCJtZW51aXRlbVwiXG4gICAgICAgICAgICAgIHRhYkluZGV4PXstMX1cbiAgICAgICAgICAgICAgYXJpYS1kaXNhYmxlZD17b3B0aW9uLmRpc2FibGVkfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7b3B0aW9uLmljb24gJiYgPHNwYW4gc3R5bGU9e2ljb25TdHlsZXN9PntvcHRpb24uaWNvbn08L3NwYW4+fVxuICAgICAgICAgICAgICA8c3Bhbj57b3B0aW9uLmxhYmVsfTwvc3Bhbj5cbiAgICAgICAgICAgICAge2hhc0NoaWxkcmVuICYmIDxzcGFuIHN0eWxlPXthcnJvd1N0eWxlc30+4oC6PC9zcGFuPn1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICl9XG4gICAgICAgICAge2hhc0NoaWxkcmVuICYmIChcbiAgICAgICAgICAgIDxkaXY+e29wdGlvbi5jaGlsZHJlbj8ubWFwKChjaGlsZCkgPT4gcmVuZGVyT3B0aW9uKGNoaWxkLCBsZXZlbCArIDEpKX08L2Rpdj5cbiAgICAgICAgICApfVxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfTtcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2XG4gICAgICAgIHJlZj17Y29udGFpbmVyUmVmfVxuICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZX1cbiAgICAgICAgc3R5bGU9e2NvbnRhaW5lclN0eWxlc31cbiAgICAgICAgZGF0YS10ZXN0aWQ9e2RhdGFUZXN0SWR9XG4gICAgICAgIG9uQ2xpY2s9e2hhbmRsZUNsaWNrfVxuICAgICAgICBvbk1vdXNlRW50ZXI9e2hhbmRsZU1vdXNlRW50ZXJ9XG4gICAgICAgIG9uTW91c2VMZWF2ZT17aGFuZGxlTW91c2VMZWF2ZX1cbiAgICAgICAgb25LZXlEb3duPXtoYW5kbGVLZXlEb3dufVxuICAgICAgICB0YWJJbmRleD17MH1cbiAgICAgICAgcm9sZT1cImJ1dHRvblwiXG4gICAgICAgIGFyaWEtaGFzcG9wdXA9XCJ0cnVlXCJcbiAgICAgICAgYXJpYS1leHBhbmRlZD17dmlzaWJsZX1cbiAgICAgID5cbiAgICAgICAge2NoaWxkcmVufVxuICAgICAgICB7dmlzaWJsZSAmJiAoXG4gICAgICAgICAgPGRpdiByZWY9e2Ryb3Bkb3duUmVmfSBzdHlsZT17ZHJvcGRvd25TdHlsZXN9IHJvbGU9XCJtZW51XCIgYXJpYS1sYWJlbD1cIkRyb3Bkb3duIG1lbnVcIj5cbiAgICAgICAgICAgIHtvcHRpb25zLm1hcCgob3B0aW9uKSA9PiByZW5kZXJPcHRpb24ob3B0aW9uKSl9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICl9XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG4pO1xuXG5Ecm9wZG93bi5kaXNwbGF5TmFtZSA9ICdEcm9wZG93bic7XG4iXSwidmVyc2lvbiI6M30=