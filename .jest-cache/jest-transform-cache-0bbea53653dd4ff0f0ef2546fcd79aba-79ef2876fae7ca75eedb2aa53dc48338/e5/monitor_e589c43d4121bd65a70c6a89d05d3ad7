89a9fed4c37c562058ff543853f226cf
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class PerformanceMonitor {
    constructor(reportUrl) {
        this.metrics = {};
        this.observers = [];
        this.reportUrl = reportUrl;
    }
    init() {
        if (typeof window === 'undefined')
            return;
        this.measureFCP();
        this.measureLCP();
        this.measureFID();
        this.measureCLS();
        this.measureTTFB();
    }
    measureFCP() {
        const observer = new PerformanceObserver((list) => {
            const entries = list.getEntries();
            const fcpEntry = entries.find((entry) => entry.name === 'first-contentful-paint');
            if (fcpEntry) {
                this.metrics.FCP = fcpEntry.startTime;
                this.report();
            }
        });
        observer.observe({ type: 'paint', buffered: true });
        this.observers.push(observer);
    }
    measureLCP() {
        if (!('PerformanceObserver' in window))
            return;
        const observer = new PerformanceObserver((list) => {
            const entries = list.getEntries();
            const lastEntry = entries[entries.length - 1];
            if (lastEntry) {
                this.metrics.LCP = lastEntry.startTime;
                this.report();
            }
        });
        observer.observe({ type: 'largest-contentful-paint', buffered: true });
        this.observers.push(observer);
    }
    measureFID() {
        if (!('PerformanceObserver' in window))
            return;
        const observer = new PerformanceObserver((list) => {
            const entries = list.getEntries();
            const fidEntry = entries[0];
            if (fidEntry && fidEntry.processingStart) {
                this.metrics.FID = fidEntry.processingStart - fidEntry.startTime;
                this.report();
            }
        });
        observer.observe({ type: 'first-input', buffered: true });
        this.observers.push(observer);
    }
    measureCLS() {
        if (!('PerformanceObserver' in window))
            return;
        let clsValue = 0;
        const observer = new PerformanceObserver((list) => {
            const entries = list.getEntries();
            for (const entry of entries) {
                if (entry.hadRecentInput === false) {
                    clsValue += entry.value || 0;
                }
            }
            if (clsValue > 0) {
                this.metrics.CLS = clsValue;
                this.report();
            }
        });
        observer.observe({ type: 'layout-shift', buffered: true });
        this.observers.push(observer);
    }
    measureTTFB() {
        if (typeof window === 'undefined' || !window.performance)
            return;
        const navigation = performance.getEntriesByType('navigation')[0];
        if (navigation && navigation.responseStart && navigation.requestStart) {
            this.metrics.TTFB = navigation.responseStart - navigation.requestStart;
            this.report();
        }
    }
    report() {
        const report = {
            metrics: { ...this.metrics },
            timestamp: Date.now(),
            url: window.location.href,
        };
        console.warn('Performance Metrics:', report);
        if (this.reportUrl) {
            this.sendReport(report);
        }
    }
    async sendReport(report) {
        if (!this.reportUrl)
            return;
        try {
            await fetch(this.reportUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(report),
            });
        }
        catch (error) {
            console.error('Failed to send performance report:', error);
        }
    }
    getMetrics() {
        return { ...this.metrics };
    }
    destroy() {
        this.observers.forEach((observer) => observer.disconnect());
        this.observers = [];
    }
}
exports.default = PerformanceMonitor;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3lhbnl1L0Rvd25sb2Fkcy95eWMzLURlc2lnbi1TeXN0ZW0vc3JjL3BlcmZvcm1hbmNlL21vbml0b3IudHMiLCJtYXBwaW5ncyI6Ijs7QUFXQSxNQUFNLGtCQUFrQjtJQUt0QixZQUFZLFNBQWtCO1FBSnRCLFlBQU8sR0FBdUIsRUFBRSxDQUFDO1FBQ2pDLGNBQVMsR0FBMEIsRUFBRSxDQUFDO1FBSTVDLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO0lBQzdCLENBQUM7SUFFRCxJQUFJO1FBQ0YsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXO1lBQUUsT0FBTztRQUUxQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDbEIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDbEIsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3JCLENBQUM7SUFFTyxVQUFVO1FBQ2hCLE1BQU0sUUFBUSxHQUFHLElBQUksbUJBQW1CLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUNoRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDbEMsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyx3QkFBd0IsQ0FBQyxDQUFDO1lBQ2xGLElBQUksUUFBUSxFQUFFLENBQUM7Z0JBQ2IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQztnQkFDdEMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2hCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUNILFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFTyxVQUFVO1FBQ2hCLElBQUksQ0FBQyxDQUFDLHFCQUFxQixJQUFJLE1BQU0sQ0FBQztZQUFFLE9BQU87UUFFL0MsTUFBTSxRQUFRLEdBQUcsSUFBSSxtQkFBbUIsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ2hELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUNsQyxNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQXFCLENBQUM7WUFDbEUsSUFBSSxTQUFTLEVBQUUsQ0FBQztnQkFDZCxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDO2dCQUN2QyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDaEIsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLElBQUksRUFBRSwwQkFBMEIsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUN2RSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRU8sVUFBVTtRQUNoQixJQUFJLENBQUMsQ0FBQyxxQkFBcUIsSUFBSSxNQUFNLENBQUM7WUFBRSxPQUFPO1FBRS9DLE1BQU0sUUFBUSxHQUFHLElBQUksbUJBQW1CLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUNoRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDbEMsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBcUIsQ0FBQztZQUNoRCxJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsZUFBZSxFQUFFLENBQUM7Z0JBQ3pDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxHQUFHLFFBQVEsQ0FBQyxlQUFlLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQztnQkFDakUsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2hCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUNILFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQzFELElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFTyxVQUFVO1FBQ2hCLElBQUksQ0FBQyxDQUFDLHFCQUFxQixJQUFJLE1BQU0sQ0FBQztZQUFFLE9BQU87UUFFL0MsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ2pCLE1BQU0sUUFBUSxHQUFHLElBQUksbUJBQW1CLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUNoRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDbEMsS0FBSyxNQUFNLEtBQUssSUFBSSxPQUE2QixFQUFFLENBQUM7Z0JBQ2xELElBQUksS0FBSyxDQUFDLGNBQWMsS0FBSyxLQUFLLEVBQUUsQ0FBQztvQkFDbkMsUUFBUSxJQUFJLEtBQUssQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDO2dCQUMvQixDQUFDO1lBQ0gsQ0FBQztZQUNELElBQUksUUFBUSxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUNqQixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsR0FBRyxRQUFRLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNoQixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUMzRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRU8sV0FBVztRQUNqQixJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXO1lBQUUsT0FBTztRQUVqRSxNQUFNLFVBQVUsR0FBRyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFxQixDQUFDO1FBQ3JGLElBQUksVUFBVSxJQUFJLFVBQVUsQ0FBQyxhQUFhLElBQUksVUFBVSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3RFLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHLFVBQVUsQ0FBQyxhQUFhLEdBQUcsVUFBVSxDQUFDLFlBQVksQ0FBQztZQUN2RSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDaEIsQ0FBQztJQUNILENBQUM7SUFFTyxNQUFNO1FBQ1osTUFBTSxNQUFNLEdBQXNCO1lBQ2hDLE9BQU8sRUFBRSxFQUFFLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUM1QixTQUFTLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUNyQixHQUFHLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJO1NBQzFCLENBQUM7UUFFRixPQUFPLENBQUMsSUFBSSxDQUFDLHNCQUFzQixFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRTdDLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ25CLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUIsQ0FBQztJQUNILENBQUM7SUFFTyxLQUFLLENBQUMsVUFBVSxDQUFDLE1BQXlCO1FBQ2hELElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUztZQUFFLE9BQU87UUFFNUIsSUFBSSxDQUFDO1lBQ0gsTUFBTSxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtnQkFDMUIsTUFBTSxFQUFFLE1BQU07Z0JBQ2QsT0FBTyxFQUFFO29CQUNQLGNBQWMsRUFBRSxrQkFBa0I7aUJBQ25DO2dCQUNELElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQzthQUNkLENBQUMsQ0FBQztRQUNwQixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDN0QsQ0FBQztJQUNILENBQUM7SUFFRCxVQUFVO1FBQ1IsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRCxPQUFPO1FBQ0wsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO1FBQzVELElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBQ3RCLENBQUM7Q0FDRjtBQUVELGtCQUFlLGtCQUFrQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy95YW55dS9Eb3dubG9hZHMveXljMy1EZXNpZ24tU3lzdGVtL3NyYy9wZXJmb3JtYW5jZS9tb25pdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBlcmZvcm1hbmNlTWV0cmljcywgUGVyZm9ybWFuY2VSZXBvcnQgfSBmcm9tICcuL3R5cGVzJztcblxuaW50ZXJmYWNlIFBlcmZvcm1hbmNlRW50cnkge1xuICBzdGFydFRpbWU6IG51bWJlcjtcbiAgcHJvY2Vzc2luZ1N0YXJ0PzogbnVtYmVyO1xuICB2YWx1ZT86IG51bWJlcjtcbiAgaGFkUmVjZW50SW5wdXQ/OiBib29sZWFuO1xuICByZXNwb25zZVN0YXJ0PzogbnVtYmVyO1xuICByZXF1ZXN0U3RhcnQ/OiBudW1iZXI7XG59XG5cbmNsYXNzIFBlcmZvcm1hbmNlTW9uaXRvciB7XG4gIHByaXZhdGUgbWV0cmljczogUGVyZm9ybWFuY2VNZXRyaWNzID0ge307XG4gIHByaXZhdGUgb2JzZXJ2ZXJzOiBQZXJmb3JtYW5jZU9ic2VydmVyW10gPSBbXTtcbiAgcHJpdmF0ZSByZXBvcnRVcmw/OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IocmVwb3J0VXJsPzogc3RyaW5nKSB7XG4gICAgdGhpcy5yZXBvcnRVcmwgPSByZXBvcnRVcmw7XG4gIH1cblxuICBpbml0KCkge1xuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgcmV0dXJuO1xuXG4gICAgdGhpcy5tZWFzdXJlRkNQKCk7XG4gICAgdGhpcy5tZWFzdXJlTENQKCk7XG4gICAgdGhpcy5tZWFzdXJlRklEKCk7XG4gICAgdGhpcy5tZWFzdXJlQ0xTKCk7XG4gICAgdGhpcy5tZWFzdXJlVFRGQigpO1xuICB9XG5cbiAgcHJpdmF0ZSBtZWFzdXJlRkNQKCkge1xuICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IFBlcmZvcm1hbmNlT2JzZXJ2ZXIoKGxpc3QpID0+IHtcbiAgICAgIGNvbnN0IGVudHJpZXMgPSBsaXN0LmdldEVudHJpZXMoKTtcbiAgICAgIGNvbnN0IGZjcEVudHJ5ID0gZW50cmllcy5maW5kKChlbnRyeSkgPT4gZW50cnkubmFtZSA9PT0gJ2ZpcnN0LWNvbnRlbnRmdWwtcGFpbnQnKTtcbiAgICAgIGlmIChmY3BFbnRyeSkge1xuICAgICAgICB0aGlzLm1ldHJpY3MuRkNQID0gZmNwRW50cnkuc3RhcnRUaW1lO1xuICAgICAgICB0aGlzLnJlcG9ydCgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIG9ic2VydmVyLm9ic2VydmUoeyB0eXBlOiAncGFpbnQnLCBidWZmZXJlZDogdHJ1ZSB9KTtcbiAgICB0aGlzLm9ic2VydmVycy5wdXNoKG9ic2VydmVyKTtcbiAgfVxuXG4gIHByaXZhdGUgbWVhc3VyZUxDUCgpIHtcbiAgICBpZiAoISgnUGVyZm9ybWFuY2VPYnNlcnZlcicgaW4gd2luZG93KSkgcmV0dXJuO1xuXG4gICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgUGVyZm9ybWFuY2VPYnNlcnZlcigobGlzdCkgPT4ge1xuICAgICAgY29uc3QgZW50cmllcyA9IGxpc3QuZ2V0RW50cmllcygpO1xuICAgICAgY29uc3QgbGFzdEVudHJ5ID0gZW50cmllc1tlbnRyaWVzLmxlbmd0aCAtIDFdIGFzIFBlcmZvcm1hbmNlRW50cnk7XG4gICAgICBpZiAobGFzdEVudHJ5KSB7XG4gICAgICAgIHRoaXMubWV0cmljcy5MQ1AgPSBsYXN0RW50cnkuc3RhcnRUaW1lO1xuICAgICAgICB0aGlzLnJlcG9ydCgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIG9ic2VydmVyLm9ic2VydmUoeyB0eXBlOiAnbGFyZ2VzdC1jb250ZW50ZnVsLXBhaW50JywgYnVmZmVyZWQ6IHRydWUgfSk7XG4gICAgdGhpcy5vYnNlcnZlcnMucHVzaChvYnNlcnZlcik7XG4gIH1cblxuICBwcml2YXRlIG1lYXN1cmVGSUQoKSB7XG4gICAgaWYgKCEoJ1BlcmZvcm1hbmNlT2JzZXJ2ZXInIGluIHdpbmRvdykpIHJldHVybjtcblxuICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IFBlcmZvcm1hbmNlT2JzZXJ2ZXIoKGxpc3QpID0+IHtcbiAgICAgIGNvbnN0IGVudHJpZXMgPSBsaXN0LmdldEVudHJpZXMoKTtcbiAgICAgIGNvbnN0IGZpZEVudHJ5ID0gZW50cmllc1swXSBhcyBQZXJmb3JtYW5jZUVudHJ5O1xuICAgICAgaWYgKGZpZEVudHJ5ICYmIGZpZEVudHJ5LnByb2Nlc3NpbmdTdGFydCkge1xuICAgICAgICB0aGlzLm1ldHJpY3MuRklEID0gZmlkRW50cnkucHJvY2Vzc2luZ1N0YXJ0IC0gZmlkRW50cnkuc3RhcnRUaW1lO1xuICAgICAgICB0aGlzLnJlcG9ydCgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIG9ic2VydmVyLm9ic2VydmUoeyB0eXBlOiAnZmlyc3QtaW5wdXQnLCBidWZmZXJlZDogdHJ1ZSB9KTtcbiAgICB0aGlzLm9ic2VydmVycy5wdXNoKG9ic2VydmVyKTtcbiAgfVxuXG4gIHByaXZhdGUgbWVhc3VyZUNMUygpIHtcbiAgICBpZiAoISgnUGVyZm9ybWFuY2VPYnNlcnZlcicgaW4gd2luZG93KSkgcmV0dXJuO1xuXG4gICAgbGV0IGNsc1ZhbHVlID0gMDtcbiAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBQZXJmb3JtYW5jZU9ic2VydmVyKChsaXN0KSA9PiB7XG4gICAgICBjb25zdCBlbnRyaWVzID0gbGlzdC5nZXRFbnRyaWVzKCk7XG4gICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMgYXMgUGVyZm9ybWFuY2VFbnRyeVtdKSB7XG4gICAgICAgIGlmIChlbnRyeS5oYWRSZWNlbnRJbnB1dCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICBjbHNWYWx1ZSArPSBlbnRyeS52YWx1ZSB8fCAwO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoY2xzVmFsdWUgPiAwKSB7XG4gICAgICAgIHRoaXMubWV0cmljcy5DTFMgPSBjbHNWYWx1ZTtcbiAgICAgICAgdGhpcy5yZXBvcnQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBvYnNlcnZlci5vYnNlcnZlKHsgdHlwZTogJ2xheW91dC1zaGlmdCcsIGJ1ZmZlcmVkOiB0cnVlIH0pO1xuICAgIHRoaXMub2JzZXJ2ZXJzLnB1c2gob2JzZXJ2ZXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBtZWFzdXJlVFRGQigpIHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcgfHwgIXdpbmRvdy5wZXJmb3JtYW5jZSkgcmV0dXJuO1xuXG4gICAgY29uc3QgbmF2aWdhdGlvbiA9IHBlcmZvcm1hbmNlLmdldEVudHJpZXNCeVR5cGUoJ25hdmlnYXRpb24nKVswXSBhcyBQZXJmb3JtYW5jZUVudHJ5O1xuICAgIGlmIChuYXZpZ2F0aW9uICYmIG5hdmlnYXRpb24ucmVzcG9uc2VTdGFydCAmJiBuYXZpZ2F0aW9uLnJlcXVlc3RTdGFydCkge1xuICAgICAgdGhpcy5tZXRyaWNzLlRURkIgPSBuYXZpZ2F0aW9uLnJlc3BvbnNlU3RhcnQgLSBuYXZpZ2F0aW9uLnJlcXVlc3RTdGFydDtcbiAgICAgIHRoaXMucmVwb3J0KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZXBvcnQoKSB7XG4gICAgY29uc3QgcmVwb3J0OiBQZXJmb3JtYW5jZVJlcG9ydCA9IHtcbiAgICAgIG1ldHJpY3M6IHsgLi4udGhpcy5tZXRyaWNzIH0sXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB1cmw6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLFxuICAgIH07XG5cbiAgICBjb25zb2xlLndhcm4oJ1BlcmZvcm1hbmNlIE1ldHJpY3M6JywgcmVwb3J0KTtcblxuICAgIGlmICh0aGlzLnJlcG9ydFVybCkge1xuICAgICAgdGhpcy5zZW5kUmVwb3J0KHJlcG9ydCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzZW5kUmVwb3J0KHJlcG9ydDogUGVyZm9ybWFuY2VSZXBvcnQpIHtcbiAgICBpZiAoIXRoaXMucmVwb3J0VXJsKSByZXR1cm47XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgZmV0Y2godGhpcy5yZXBvcnRVcmwsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXBvcnQpLFxuICAgICAgfSBhcyBSZXF1ZXN0SW5pdCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzZW5kIHBlcmZvcm1hbmNlIHJlcG9ydDonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgZ2V0TWV0cmljcygpOiBQZXJmb3JtYW5jZU1ldHJpY3Mge1xuICAgIHJldHVybiB7IC4uLnRoaXMubWV0cmljcyB9O1xuICB9XG5cbiAgZGVzdHJveSgpIHtcbiAgICB0aGlzLm9ic2VydmVycy5mb3JFYWNoKChvYnNlcnZlcikgPT4gb2JzZXJ2ZXIuZGlzY29ubmVjdCgpKTtcbiAgICB0aGlzLm9ic2VydmVycyA9IFtdO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBlcmZvcm1hbmNlTW9uaXRvcjtcbiJdLCJ2ZXJzaW9uIjozfQ==