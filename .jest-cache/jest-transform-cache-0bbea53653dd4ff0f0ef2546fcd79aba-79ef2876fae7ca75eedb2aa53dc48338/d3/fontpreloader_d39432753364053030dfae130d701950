f47c57d79c38d0a0a9bedce4fab0f22b
"use strict";
/**
 * @file 字体预加载工具
 * @description 提供字体预加载、缓存管理和字体检测功能
 * @module utils/font-preloader
 * @author YYC³
 * @version 1.0.0
 * @created 2026-02-22
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.getAvailableFonts = exports.waitForFontLoad = exports.isFontLoaded = exports.preloadBelowFoldFonts = exports.preloadViewportFonts = exports.preloadCriticalFonts = exports.getFontPreloaderStats = exports.clearExpiredFontCache = exports.clearFontCache = exports.removeCachedFont = exports.getCachedFont = exports.preloadFontsWithProgress = exports.preloadFontBatch = exports.preloadFont = exports.defaultFontPreloader = exports.createFontPreloader = exports.FontPreloader = void 0;
class FontPreloader {
    constructor(options) {
        this.cache = new Map();
        this.loading = new Map();
        this.maxCacheSize = options?.maxCacheSize || 20;
        this.maxCacheAge = options?.maxCacheAge || 3600000;
    }
    getCacheKey(fontFamily, fontWeight, fontStyle) {
        return `${fontFamily}-${fontWeight}-${fontStyle}`;
    }
    addToCache(key, font) {
        if (this.cache.size >= this.maxCacheSize) {
            this.evictOldest();
        }
        this.cache.set(key, {
            font,
            timestamp: Date.now(),
            accessCount: 1,
        });
    }
    evictOldest() {
        let oldestKey = null;
        let oldestTimestamp = Infinity;
        for (const [key, entry] of this.cache.entries()) {
            if (entry.timestamp < oldestTimestamp) {
                oldestTimestamp = entry.timestamp;
                oldestKey = key;
            }
        }
        if (oldestKey) {
            this.cache.delete(oldestKey);
        }
    }
    evictLRU() {
        let lruKey = null;
        let minAccessCount = Infinity;
        for (const [key, entry] of this.cache.entries()) {
            if (entry.accessCount < minAccessCount) {
                minAccessCount = entry.accessCount;
                lruKey = key;
            }
        }
        if (lruKey) {
            this.cache.delete(lruKey);
        }
    }
    preloadFont(fontFamily, fontSrc, options) {
        const { fontWeight = 'normal', fontStyle = 'normal', timeout = 10000, retryCount = 3, retryDelay = 1000, useCache = true, cacheKey, onLoad, onError, } = options || {};
        const key = cacheKey || this.getCacheKey(fontFamily, fontWeight, fontStyle);
        if (useCache && this.cache.has(key)) {
            const entry = this.cache.get(key);
            entry.accessCount++;
            entry.timestamp = Date.now();
            onLoad?.(entry.font);
            return Promise.resolve({
                success: true,
                font: entry.font,
                duration: 0,
                cached: true,
            });
        }
        if (this.loading.has(key)) {
            return this.loading.get(key);
        }
        const promise = this.loadFontWithRetry(fontFamily, fontSrc, fontWeight, fontStyle, {
            timeout,
            retryCount,
            retryDelay,
            onLoad,
            onError,
        }).then((result) => {
            this.loading.delete(key);
            if (result.success && result.font && useCache) {
                this.addToCache(key, result.font);
            }
            return result;
        });
        this.loading.set(key, promise);
        return promise;
    }
    async loadFontWithRetry(fontFamily, fontSrc, fontWeight, fontStyle, options) {
        const { timeout, retryCount, retryDelay, onLoad, onError } = options;
        let lastError;
        for (let attempt = 0; attempt <= retryCount; attempt++) {
            try {
                const result = await this.loadSingleFont(fontFamily, fontSrc, fontWeight, fontStyle, timeout);
                onLoad?.(result.font);
                return result;
            }
            catch (error) {
                lastError = error;
                if (attempt < retryCount) {
                    await new Promise((resolve) => setTimeout(resolve, retryDelay));
                }
            }
        }
        onError?.(lastError);
        return {
            success: false,
            duration: 0,
            cached: false,
            error: lastError || new Error(`Failed to load font: ${fontFamily}`),
        };
    }
    loadSingleFont(fontFamily, fontSrc, fontWeight, fontStyle, timeout) {
        return new Promise((resolve, reject) => {
            const startTime = performance.now();
            let timeoutId;
            const fontFace = new FontFace(fontFamily, `url(${fontSrc})`, {
                weight: fontWeight,
                style: fontStyle,
            });
            fontFace
                .load()
                .then(() => {
                clearTimeout(timeoutId);
                document.fonts.add(fontFace);
                const duration = performance.now() - startTime;
                resolve({
                    success: true,
                    font: fontFace,
                    duration,
                    cached: false,
                });
            })
                .catch((error) => {
                clearTimeout(timeoutId);
                reject(new Error(`Failed to load font: ${fontFamily}`));
            });
            timeoutId = setTimeout(() => {
                reject(new Error(`Font load timeout: ${fontFamily}`));
            }, timeout);
        });
    }
    preloadFontBatch(fonts) {
        const promises = fonts.map(({ fontFamily, fontSrc, fontWeight, fontStyle, options }) => this.preloadFont(fontFamily, fontSrc, {
            ...options,
            fontWeight,
            fontStyle,
        }));
        return Promise.all(promises);
    }
    preloadFontsWithProgress(fonts, onProgress) {
        const results = [];
        let loaded = 0;
        const promises = fonts.map(({ fontFamily, fontSrc, fontWeight, fontStyle, options }, index) => {
            return this.preloadFont(fontFamily, fontSrc, {
                ...options,
                fontWeight,
                fontStyle,
                onLoad: (font) => {
                    loaded++;
                    onProgress(loaded, fonts.length);
                    options?.onLoad?.(font);
                },
            }).then((result) => {
                results[index] = result;
                return result;
            });
        });
        return Promise.all(promises).then(() => results);
    }
    getFromCache(fontFamily, fontWeight = 'normal', fontStyle = 'normal') {
        const key = this.getCacheKey(fontFamily, fontWeight, fontStyle);
        const entry = this.cache.get(key);
        if (entry) {
            entry.accessCount++;
            entry.timestamp = Date.now();
            return entry.font;
        }
        return null;
    }
    removeFromCache(fontFamily, fontWeight = 'normal', fontStyle = 'normal') {
        const key = this.getCacheKey(fontFamily, fontWeight, fontStyle);
        return this.cache.delete(key);
    }
    clearCache() {
        this.cache.clear();
    }
    clearExpiredCache() {
        const now = Date.now();
        for (const [key, entry] of this.cache.entries()) {
            if (now - entry.timestamp > this.maxCacheAge) {
                this.cache.delete(key);
            }
        }
    }
    getCacheSize() {
        return this.cache.size;
    }
    getLoadingCount() {
        return this.loading.size;
    }
    getStats() {
        const cacheEntries = [];
        for (const [key, entry] of this.cache.entries()) {
            const [family, weight, style] = key.split('-');
            cacheEntries.push({
                family,
                weight,
                style,
                src: entry.font.family,
                loaded: true,
                cached: true,
            });
        }
        return {
            cacheSize: this.cache.size,
            loadingCount: this.loading.size,
            cacheEntries,
        };
    }
}
exports.FontPreloader = FontPreloader;
const createFontPreloader = (options) => {
    return new FontPreloader(options);
};
exports.createFontPreloader = createFontPreloader;
exports.defaultFontPreloader = new FontPreloader();
const preloadFont = (fontFamily, fontSrc, options) => {
    return exports.defaultFontPreloader.preloadFont(fontFamily, fontSrc, options);
};
exports.preloadFont = preloadFont;
const preloadFontBatch = (fonts) => {
    return exports.defaultFontPreloader.preloadFontBatch(fonts);
};
exports.preloadFontBatch = preloadFontBatch;
const preloadFontsWithProgress = (fonts, onProgress) => {
    return exports.defaultFontPreloader.preloadFontsWithProgress(fonts, onProgress);
};
exports.preloadFontsWithProgress = preloadFontsWithProgress;
const getCachedFont = (fontFamily, fontWeight, fontStyle) => {
    return exports.defaultFontPreloader.getFromCache(fontFamily, fontWeight, fontStyle);
};
exports.getCachedFont = getCachedFont;
const removeCachedFont = (fontFamily, fontWeight, fontStyle) => {
    return exports.defaultFontPreloader.removeFromCache(fontFamily, fontWeight, fontStyle);
};
exports.removeCachedFont = removeCachedFont;
const clearFontCache = () => {
    exports.defaultFontPreloader.clearCache();
};
exports.clearFontCache = clearFontCache;
const clearExpiredFontCache = () => {
    exports.defaultFontPreloader.clearExpiredCache();
};
exports.clearExpiredFontCache = clearExpiredFontCache;
const getFontPreloaderStats = () => {
    return exports.defaultFontPreloader.getStats();
};
exports.getFontPreloaderStats = getFontPreloaderStats;
const preloadCriticalFonts = (fonts, options) => {
    return (0, exports.preloadFontBatch)(fonts.map((font) => ({
        ...font,
        options: { ...options, timeout: 5000 },
    })));
};
exports.preloadCriticalFonts = preloadCriticalFonts;
const preloadViewportFonts = (fonts, options) => {
    return (0, exports.preloadFontBatch)(fonts.map((font) => ({
        ...font,
        options: { ...options, timeout: 10000 },
    })));
};
exports.preloadViewportFonts = preloadViewportFonts;
const preloadBelowFoldFonts = (fonts, options) => {
    return (0, exports.preloadFontBatch)(fonts.map((font) => ({
        ...font,
        options: { ...options, timeout: 15000 },
    })));
};
exports.preloadBelowFoldFonts = preloadBelowFoldFonts;
const isFontLoaded = (fontFamily) => {
    return document.fonts.check(`16px ${fontFamily}`);
};
exports.isFontLoaded = isFontLoaded;
const waitForFontLoad = (fontFamily, timeout = 10000) => {
    return new Promise((resolve) => {
        if ((0, exports.isFontLoaded)(fontFamily)) {
            resolve(true);
            return;
        }
        const checkInterval = setInterval(() => {
            if ((0, exports.isFontLoaded)(fontFamily)) {
                clearInterval(checkInterval);
                resolve(true);
            }
        }, 100);
        setTimeout(() => {
            clearInterval(checkInterval);
            resolve(false);
        }, timeout);
    });
};
exports.waitForFontLoad = waitForFontLoad;
const getAvailableFonts = () => {
    const fonts = document.fonts.values();
    const fontFamilies = new Set();
    for (const font of fonts) {
        fontFamilies.add(font.family);
    }
    return Array.from(fontFamilies);
};
exports.getAvailableFonts = getAvailableFonts;
exports.default = {
    FontPreloader,
    createFontPreloader: exports.createFontPreloader,
    defaultFontPreloader: exports.defaultFontPreloader,
    preloadFont: exports.preloadFont,
    preloadFontBatch: exports.preloadFontBatch,
    preloadFontsWithProgress: exports.preloadFontsWithProgress,
    getCachedFont: exports.getCachedFont,
    removeCachedFont: exports.removeCachedFont,
    clearFontCache: exports.clearFontCache,
    clearExpiredFontCache: exports.clearExpiredFontCache,
    getFontPreloaderStats: exports.getFontPreloaderStats,
    preloadCriticalFonts: exports.preloadCriticalFonts,
    preloadViewportFonts: exports.preloadViewportFonts,
    preloadBelowFoldFonts: exports.preloadBelowFoldFonts,
    isFontLoaded: exports.isFontLoaded,
    waitForFontLoad: exports.waitForFontLoad,
    getAvailableFonts: exports.getAvailableFonts,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3lhbnl1L0Rvd25sb2Fkcy95eWMzLURlc2lnbi1TeXN0ZW0vc3JjL3V0aWxzL2ZvbnQtcHJlbG9hZGVyLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOzs7QUFtQ0gsTUFBYSxhQUFhO0lBTXhCLFlBQVksT0FBeUQ7UUFDbkUsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMsWUFBWSxHQUFHLE9BQU8sRUFBRSxZQUFZLElBQUksRUFBRSxDQUFDO1FBQ2hELElBQUksQ0FBQyxXQUFXLEdBQUcsT0FBTyxFQUFFLFdBQVcsSUFBSSxPQUFPLENBQUM7SUFDckQsQ0FBQztJQUVPLFdBQVcsQ0FBQyxVQUFrQixFQUFFLFVBQWtCLEVBQUUsU0FBaUI7UUFDM0UsT0FBTyxHQUFHLFVBQVUsSUFBSSxVQUFVLElBQUksU0FBUyxFQUFFLENBQUM7SUFDcEQsQ0FBQztJQUVPLFVBQVUsQ0FBQyxHQUFXLEVBQUUsSUFBYztRQUM1QyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUN6QyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDckIsQ0FBQztRQUVELElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRTtZQUNsQixJQUFJO1lBQ0osU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUU7WUFDckIsV0FBVyxFQUFFLENBQUM7U0FDZixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU8sV0FBVztRQUNqQixJQUFJLFNBQVMsR0FBa0IsSUFBSSxDQUFDO1FBQ3BDLElBQUksZUFBZSxHQUFHLFFBQVEsQ0FBQztRQUUvQixLQUFLLE1BQU0sQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDO1lB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QUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy95YW55dS9Eb3dubG9hZHMveXljMy1EZXNpZ24tU3lzdGVtL3NyYy91dGlscy9mb250LXByZWxvYWRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIOWtl+S9k+mihOWKoOi9veW3peWFt1xuICogQGRlc2NyaXB0aW9uIOaPkOS+m+Wtl+S9k+mihOWKoOi9veOAgee8k+WtmOeuoeeQhuWSjOWtl+S9k+ajgOa1i+WKn+iDvVxuICogQG1vZHVsZSB1dGlscy9mb250LXByZWxvYWRlclxuICogQGF1dGhvciBZWUPCs1xuICogQHZlcnNpb24gMS4wLjBcbiAqIEBjcmVhdGVkIDIwMjYtMDItMjJcbiAqL1xuXG5leHBvcnQgaW50ZXJmYWNlIEZvbnRQcmVsb2FkT3B0aW9ucyB7XG4gIHRpbWVvdXQ/OiBudW1iZXI7XG4gIHJldHJ5Q291bnQ/OiBudW1iZXI7XG4gIHJldHJ5RGVsYXk/OiBudW1iZXI7XG4gIHVzZUNhY2hlPzogYm9vbGVhbjtcbiAgY2FjaGVLZXk/OiBzdHJpbmc7XG4gIG9uTG9hZD86IChmb250OiBGb250RmFjZSkgPT4gdm9pZDtcbiAgb25FcnJvcj86IChlcnJvcjogRXJyb3IpID0+IHZvaWQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRm9udFByZWxvYWRSZXN1bHQge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICBmb250PzogRm9udEZhY2U7XG4gIGR1cmF0aW9uOiBudW1iZXI7XG4gIGNhY2hlZDogYm9vbGVhbjtcbiAgZXJyb3I/OiBFcnJvcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBGb250SW5mbyB7XG4gIGZhbWlseTogc3RyaW5nO1xuICB3ZWlnaHQ6IHN0cmluZztcbiAgc3R5bGU6IHN0cmluZztcbiAgc3JjOiBzdHJpbmc7XG4gIGxvYWRlZDogYm9vbGVhbjtcbiAgY2FjaGVkOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZvbnRDYWNoZUVudHJ5IHtcbiAgZm9udDogRm9udEZhY2U7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICBhY2Nlc3NDb3VudDogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgRm9udFByZWxvYWRlciB7XG4gIHByaXZhdGUgY2FjaGU6IE1hcDxzdHJpbmcsIEZvbnRDYWNoZUVudHJ5PjtcbiAgcHJpdmF0ZSBsb2FkaW5nOiBNYXA8c3RyaW5nLCBQcm9taXNlPEZvbnRQcmVsb2FkUmVzdWx0Pj47XG4gIHByaXZhdGUgbWF4Q2FjaGVTaXplOiBudW1iZXI7XG4gIHByaXZhdGUgbWF4Q2FjaGVBZ2U6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zPzogeyBtYXhDYWNoZVNpemU/OiBudW1iZXI7IG1heENhY2hlQWdlPzogbnVtYmVyIH0pIHtcbiAgICB0aGlzLmNhY2hlID0gbmV3IE1hcCgpO1xuICAgIHRoaXMubG9hZGluZyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLm1heENhY2hlU2l6ZSA9IG9wdGlvbnM/Lm1heENhY2hlU2l6ZSB8fCAyMDtcbiAgICB0aGlzLm1heENhY2hlQWdlID0gb3B0aW9ucz8ubWF4Q2FjaGVBZ2UgfHwgMzYwMDAwMDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q2FjaGVLZXkoZm9udEZhbWlseTogc3RyaW5nLCBmb250V2VpZ2h0OiBzdHJpbmcsIGZvbnRTdHlsZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYCR7Zm9udEZhbWlseX0tJHtmb250V2VpZ2h0fS0ke2ZvbnRTdHlsZX1gO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRUb0NhY2hlKGtleTogc3RyaW5nLCBmb250OiBGb250RmFjZSk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNhY2hlLnNpemUgPj0gdGhpcy5tYXhDYWNoZVNpemUpIHtcbiAgICAgIHRoaXMuZXZpY3RPbGRlc3QoKTtcbiAgICB9XG5cbiAgICB0aGlzLmNhY2hlLnNldChrZXksIHtcbiAgICAgIGZvbnQsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICBhY2Nlc3NDb3VudDogMSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZXZpY3RPbGRlc3QoKTogdm9pZCB7XG4gICAgbGV0IG9sZGVzdEtleTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gICAgbGV0IG9sZGVzdFRpbWVzdGFtcCA9IEluZmluaXR5O1xuXG4gICAgZm9yIChjb25zdCBba2V5LCBlbnRyeV0gb2YgdGhpcy5jYWNoZS5lbnRyaWVzKCkpIHtcbiAgICAgIGlmIChlbnRyeS50aW1lc3RhbXAgPCBvbGRlc3RUaW1lc3RhbXApIHtcbiAgICAgICAgb2xkZXN0VGltZXN0YW1wID0gZW50cnkudGltZXN0YW1wO1xuICAgICAgICBvbGRlc3RLZXkgPSBrZXk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG9sZGVzdEtleSkge1xuICAgICAgdGhpcy5jYWNoZS5kZWxldGUob2xkZXN0S2V5KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGV2aWN0TFJVKCk6IHZvaWQge1xuICAgIGxldCBscnVLZXk6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgIGxldCBtaW5BY2Nlc3NDb3VudCA9IEluZmluaXR5O1xuXG4gICAgZm9yIChjb25zdCBba2V5LCBlbnRyeV0gb2YgdGhpcy5jYWNoZS5lbnRyaWVzKCkpIHtcbiAgICAgIGlmIChlbnRyeS5hY2Nlc3NDb3VudCA8IG1pbkFjY2Vzc0NvdW50KSB7XG4gICAgICAgIG1pbkFjY2Vzc0NvdW50ID0gZW50cnkuYWNjZXNzQ291bnQ7XG4gICAgICAgIGxydUtleSA9IGtleTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobHJ1S2V5KSB7XG4gICAgICB0aGlzLmNhY2hlLmRlbGV0ZShscnVLZXkpO1xuICAgIH1cbiAgfVxuXG4gIHByZWxvYWRGb250KFxuICAgIGZvbnRGYW1pbHk6IHN0cmluZyxcbiAgICBmb250U3JjOiBzdHJpbmcsXG4gICAgb3B0aW9ucz86IEZvbnRQcmVsb2FkT3B0aW9ucyAmIHtcbiAgICAgIGZvbnRXZWlnaHQ/OiBzdHJpbmc7XG4gICAgICBmb250U3R5bGU/OiBzdHJpbmc7XG4gICAgfVxuICApOiBQcm9taXNlPEZvbnRQcmVsb2FkUmVzdWx0PiB7XG4gICAgY29uc3Qge1xuICAgICAgZm9udFdlaWdodCA9ICdub3JtYWwnLFxuICAgICAgZm9udFN0eWxlID0gJ25vcm1hbCcsXG4gICAgICB0aW1lb3V0ID0gMTAwMDAsXG4gICAgICByZXRyeUNvdW50ID0gMyxcbiAgICAgIHJldHJ5RGVsYXkgPSAxMDAwLFxuICAgICAgdXNlQ2FjaGUgPSB0cnVlLFxuICAgICAgY2FjaGVLZXksXG4gICAgICBvbkxvYWQsXG4gICAgICBvbkVycm9yLFxuICAgIH0gPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgY29uc3Qga2V5ID0gY2FjaGVLZXkgfHwgdGhpcy5nZXRDYWNoZUtleShmb250RmFtaWx5LCBmb250V2VpZ2h0LCBmb250U3R5bGUpO1xuXG4gICAgaWYgKHVzZUNhY2hlICYmIHRoaXMuY2FjaGUuaGFzKGtleSkpIHtcbiAgICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5jYWNoZS5nZXQoa2V5KSE7XG4gICAgICBlbnRyeS5hY2Nlc3NDb3VudCsrO1xuICAgICAgZW50cnkudGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgb25Mb2FkPy4oZW50cnkuZm9udCk7XG5cbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBmb250OiBlbnRyeS5mb250LFxuICAgICAgICBkdXJhdGlvbjogMCxcbiAgICAgICAgY2FjaGVkOiB0cnVlLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubG9hZGluZy5oYXMoa2V5KSkge1xuICAgICAgcmV0dXJuIHRoaXMubG9hZGluZy5nZXQoa2V5KSE7XG4gICAgfVxuXG4gICAgY29uc3QgcHJvbWlzZSA9IHRoaXMubG9hZEZvbnRXaXRoUmV0cnkoZm9udEZhbWlseSwgZm9udFNyYywgZm9udFdlaWdodCwgZm9udFN0eWxlLCB7XG4gICAgICB0aW1lb3V0LFxuICAgICAgcmV0cnlDb3VudCxcbiAgICAgIHJldHJ5RGVsYXksXG4gICAgICBvbkxvYWQsXG4gICAgICBvbkVycm9yLFxuICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgdGhpcy5sb2FkaW5nLmRlbGV0ZShrZXkpO1xuXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgJiYgcmVzdWx0LmZvbnQgJiYgdXNlQ2FjaGUpIHtcbiAgICAgICAgdGhpcy5hZGRUb0NhY2hlKGtleSwgcmVzdWx0LmZvbnQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0pO1xuXG4gICAgdGhpcy5sb2FkaW5nLnNldChrZXksIHByb21pc2UpO1xuICAgIHJldHVybiBwcm9taXNlO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBsb2FkRm9udFdpdGhSZXRyeShcbiAgICBmb250RmFtaWx5OiBzdHJpbmcsXG4gICAgZm9udFNyYzogc3RyaW5nLFxuICAgIGZvbnRXZWlnaHQ6IHN0cmluZyxcbiAgICBmb250U3R5bGU6IHN0cmluZyxcbiAgICBvcHRpb25zOiB7XG4gICAgICB0aW1lb3V0OiBudW1iZXI7XG4gICAgICByZXRyeUNvdW50OiBudW1iZXI7XG4gICAgICByZXRyeURlbGF5OiBudW1iZXI7XG4gICAgICBvbkxvYWQ/OiAoZm9udDogRm9udEZhY2UpID0+IHZvaWQ7XG4gICAgICBvbkVycm9yPzogKGVycm9yOiBFcnJvcikgPT4gdm9pZDtcbiAgICB9XG4gICk6IFByb21pc2U8Rm9udFByZWxvYWRSZXN1bHQ+IHtcbiAgICBjb25zdCB7IHRpbWVvdXQsIHJldHJ5Q291bnQsIHJldHJ5RGVsYXksIG9uTG9hZCwgb25FcnJvciB9ID0gb3B0aW9ucztcbiAgICBsZXQgbGFzdEVycm9yOiBFcnJvciB8IHVuZGVmaW5lZDtcblxuICAgIGZvciAobGV0IGF0dGVtcHQgPSAwOyBhdHRlbXB0IDw9IHJldHJ5Q291bnQ7IGF0dGVtcHQrKykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5sb2FkU2luZ2xlRm9udChcbiAgICAgICAgICBmb250RmFtaWx5LFxuICAgICAgICAgIGZvbnRTcmMsXG4gICAgICAgICAgZm9udFdlaWdodCxcbiAgICAgICAgICBmb250U3R5bGUsXG4gICAgICAgICAgdGltZW91dFxuICAgICAgICApO1xuXG4gICAgICAgIG9uTG9hZD8uKHJlc3VsdC5mb250ISk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsYXN0RXJyb3IgPSBlcnJvciBhcyBFcnJvcjtcbiAgICAgICAgaWYgKGF0dGVtcHQgPCByZXRyeUNvdW50KSB7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgcmV0cnlEZWxheSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgb25FcnJvcj8uKGxhc3RFcnJvciEpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGR1cmF0aW9uOiAwLFxuICAgICAgY2FjaGVkOiBmYWxzZSxcbiAgICAgIGVycm9yOiBsYXN0RXJyb3IgfHwgbmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBmb250OiAke2ZvbnRGYW1pbHl9YCksXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgbG9hZFNpbmdsZUZvbnQoXG4gICAgZm9udEZhbWlseTogc3RyaW5nLFxuICAgIGZvbnRTcmM6IHN0cmluZyxcbiAgICBmb250V2VpZ2h0OiBzdHJpbmcsXG4gICAgZm9udFN0eWxlOiBzdHJpbmcsXG4gICAgdGltZW91dDogbnVtYmVyXG4gICk6IFByb21pc2U8Rm9udFByZWxvYWRSZXN1bHQ+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBsZXQgdGltZW91dElkOiBOb2RlSlMuVGltZW91dDtcblxuICAgICAgY29uc3QgZm9udEZhY2UgPSBuZXcgRm9udEZhY2UoZm9udEZhbWlseSwgYHVybCgke2ZvbnRTcmN9KWAsIHtcbiAgICAgICAgd2VpZ2h0OiBmb250V2VpZ2h0LFxuICAgICAgICBzdHlsZTogZm9udFN0eWxlLFxuICAgICAgfSk7XG5cbiAgICAgIGZvbnRGYWNlXG4gICAgICAgIC5sb2FkKClcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xuICAgICAgICAgIGRvY3VtZW50LmZvbnRzLmFkZChmb250RmFjZSk7XG5cbiAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgZm9udDogZm9udEZhY2UsXG4gICAgICAgICAgICBkdXJhdGlvbixcbiAgICAgICAgICAgIGNhY2hlZDogZmFsc2UsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBmb250OiAke2ZvbnRGYW1pbHl9YCkpO1xuICAgICAgICB9KTtcblxuICAgICAgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IoYEZvbnQgbG9hZCB0aW1lb3V0OiAke2ZvbnRGYW1pbHl9YCkpO1xuICAgICAgfSwgdGltZW91dCk7XG4gICAgfSk7XG4gIH1cblxuICBwcmVsb2FkRm9udEJhdGNoKFxuICAgIGZvbnRzOiBBcnJheTx7XG4gICAgICBmb250RmFtaWx5OiBzdHJpbmc7XG4gICAgICBmb250U3JjOiBzdHJpbmc7XG4gICAgICBmb250V2VpZ2h0Pzogc3RyaW5nO1xuICAgICAgZm9udFN0eWxlPzogc3RyaW5nO1xuICAgICAgb3B0aW9ucz86IEZvbnRQcmVsb2FkT3B0aW9ucztcbiAgICB9PlxuICApOiBQcm9taXNlPEZvbnRQcmVsb2FkUmVzdWx0W10+IHtcbiAgICBjb25zdCBwcm9taXNlcyA9IGZvbnRzLm1hcCgoeyBmb250RmFtaWx5LCBmb250U3JjLCBmb250V2VpZ2h0LCBmb250U3R5bGUsIG9wdGlvbnMgfSkgPT5cbiAgICAgIHRoaXMucHJlbG9hZEZvbnQoZm9udEZhbWlseSwgZm9udFNyYywge1xuICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICBmb250V2VpZ2h0LFxuICAgICAgICBmb250U3R5bGUsXG4gICAgICB9KVxuICAgICk7XG5cbiAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICB9XG5cbiAgcHJlbG9hZEZvbnRzV2l0aFByb2dyZXNzKFxuICAgIGZvbnRzOiBBcnJheTx7XG4gICAgICBmb250RmFtaWx5OiBzdHJpbmc7XG4gICAgICBmb250U3JjOiBzdHJpbmc7XG4gICAgICBmb250V2VpZ2h0Pzogc3RyaW5nO1xuICAgICAgZm9udFN0eWxlPzogc3RyaW5nO1xuICAgICAgb3B0aW9ucz86IEZvbnRQcmVsb2FkT3B0aW9ucztcbiAgICB9PixcbiAgICBvblByb2dyZXNzOiAobG9hZGVkOiBudW1iZXIsIHRvdGFsOiBudW1iZXIpID0+IHZvaWRcbiAgKTogUHJvbWlzZTxGb250UHJlbG9hZFJlc3VsdFtdPiB7XG4gICAgY29uc3QgcmVzdWx0czogRm9udFByZWxvYWRSZXN1bHRbXSA9IFtdO1xuICAgIGxldCBsb2FkZWQgPSAwO1xuXG4gICAgY29uc3QgcHJvbWlzZXMgPSBmb250cy5tYXAoKHsgZm9udEZhbWlseSwgZm9udFNyYywgZm9udFdlaWdodCwgZm9udFN0eWxlLCBvcHRpb25zIH0sIGluZGV4KSA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5wcmVsb2FkRm9udChmb250RmFtaWx5LCBmb250U3JjLCB7XG4gICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgIGZvbnRXZWlnaHQsXG4gICAgICAgIGZvbnRTdHlsZSxcbiAgICAgICAgb25Mb2FkOiAoZm9udCkgPT4ge1xuICAgICAgICAgIGxvYWRlZCsrO1xuICAgICAgICAgIG9uUHJvZ3Jlc3MobG9hZGVkLCBmb250cy5sZW5ndGgpO1xuICAgICAgICAgIG9wdGlvbnM/Lm9uTG9hZD8uKGZvbnQpO1xuICAgICAgICB9LFxuICAgICAgfSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgIHJlc3VsdHNbaW5kZXhdID0gcmVzdWx0O1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oKCkgPT4gcmVzdWx0cyk7XG4gIH1cblxuICBnZXRGcm9tQ2FjaGUoXG4gICAgZm9udEZhbWlseTogc3RyaW5nLFxuICAgIGZvbnRXZWlnaHQ6IHN0cmluZyA9ICdub3JtYWwnLFxuICAgIGZvbnRTdHlsZTogc3RyaW5nID0gJ25vcm1hbCdcbiAgKTogRm9udEZhY2UgfCBudWxsIHtcbiAgICBjb25zdCBrZXkgPSB0aGlzLmdldENhY2hlS2V5KGZvbnRGYW1pbHksIGZvbnRXZWlnaHQsIGZvbnRTdHlsZSk7XG4gICAgY29uc3QgZW50cnkgPSB0aGlzLmNhY2hlLmdldChrZXkpO1xuXG4gICAgaWYgKGVudHJ5KSB7XG4gICAgICBlbnRyeS5hY2Nlc3NDb3VudCsrO1xuICAgICAgZW50cnkudGltZXN0YW1wID0gRGF0ZS5ub3coKTtcbiAgICAgIHJldHVybiBlbnRyeS5mb250O1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcmVtb3ZlRnJvbUNhY2hlKFxuICAgIGZvbnRGYW1pbHk6IHN0cmluZyxcbiAgICBmb250V2VpZ2h0OiBzdHJpbmcgPSAnbm9ybWFsJyxcbiAgICBmb250U3R5bGU6IHN0cmluZyA9ICdub3JtYWwnXG4gICk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0Q2FjaGVLZXkoZm9udEZhbWlseSwgZm9udFdlaWdodCwgZm9udFN0eWxlKTtcbiAgICByZXR1cm4gdGhpcy5jYWNoZS5kZWxldGUoa2V5KTtcbiAgfVxuXG4gIGNsZWFyQ2FjaGUoKTogdm9pZCB7XG4gICAgdGhpcy5jYWNoZS5jbGVhcigpO1xuICB9XG5cbiAgY2xlYXJFeHBpcmVkQ2FjaGUoKTogdm9pZCB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIGVudHJ5XSBvZiB0aGlzLmNhY2hlLmVudHJpZXMoKSkge1xuICAgICAgaWYgKG5vdyAtIGVudHJ5LnRpbWVzdGFtcCA+IHRoaXMubWF4Q2FjaGVBZ2UpIHtcbiAgICAgICAgdGhpcy5jYWNoZS5kZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBnZXRDYWNoZVNpemUoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5jYWNoZS5zaXplO1xuICB9XG5cbiAgZ2V0TG9hZGluZ0NvdW50KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMubG9hZGluZy5zaXplO1xuICB9XG5cbiAgZ2V0U3RhdHMoKToge1xuICAgIGNhY2hlU2l6ZTogbnVtYmVyO1xuICAgIGxvYWRpbmdDb3VudDogbnVtYmVyO1xuICAgIGNhY2hlRW50cmllczogRm9udEluZm9bXTtcbiAgfSB7XG4gICAgY29uc3QgY2FjaGVFbnRyaWVzOiBGb250SW5mb1tdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IFtrZXksIGVudHJ5XSBvZiB0aGlzLmNhY2hlLmVudHJpZXMoKSkge1xuICAgICAgY29uc3QgW2ZhbWlseSwgd2VpZ2h0LCBzdHlsZV0gPSBrZXkuc3BsaXQoJy0nKTtcbiAgICAgIGNhY2hlRW50cmllcy5wdXNoKHtcbiAgICAgICAgZmFtaWx5LFxuICAgICAgICB3ZWlnaHQsXG4gICAgICAgIHN0eWxlLFxuICAgICAgICBzcmM6IGVudHJ5LmZvbnQuZmFtaWx5LFxuICAgICAgICBsb2FkZWQ6IHRydWUsXG4gICAgICAgIGNhY2hlZDogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBjYWNoZVNpemU6IHRoaXMuY2FjaGUuc2l6ZSxcbiAgICAgIGxvYWRpbmdDb3VudDogdGhpcy5sb2FkaW5nLnNpemUsXG4gICAgICBjYWNoZUVudHJpZXMsXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgY3JlYXRlRm9udFByZWxvYWRlciA9IChvcHRpb25zPzoge1xuICBtYXhDYWNoZVNpemU/OiBudW1iZXI7XG4gIG1heENhY2hlQWdlPzogbnVtYmVyO1xufSk6IEZvbnRQcmVsb2FkZXIgPT4ge1xuICByZXR1cm4gbmV3IEZvbnRQcmVsb2FkZXIob3B0aW9ucyk7XG59O1xuXG5leHBvcnQgY29uc3QgZGVmYXVsdEZvbnRQcmVsb2FkZXIgPSBuZXcgRm9udFByZWxvYWRlcigpO1xuXG5leHBvcnQgY29uc3QgcHJlbG9hZEZvbnQgPSAoXG4gIGZvbnRGYW1pbHk6IHN0cmluZyxcbiAgZm9udFNyYzogc3RyaW5nLFxuICBvcHRpb25zPzogRm9udFByZWxvYWRPcHRpb25zICYge1xuICAgIGZvbnRXZWlnaHQ/OiBzdHJpbmc7XG4gICAgZm9udFN0eWxlPzogc3RyaW5nO1xuICB9XG4pOiBQcm9taXNlPEZvbnRQcmVsb2FkUmVzdWx0PiA9PiB7XG4gIHJldHVybiBkZWZhdWx0Rm9udFByZWxvYWRlci5wcmVsb2FkRm9udChmb250RmFtaWx5LCBmb250U3JjLCBvcHRpb25zKTtcbn07XG5cbmV4cG9ydCBjb25zdCBwcmVsb2FkRm9udEJhdGNoID0gKFxuICBmb250czogQXJyYXk8e1xuICAgIGZvbnRGYW1pbHk6IHN0cmluZztcbiAgICBmb250U3JjOiBzdHJpbmc7XG4gICAgZm9udFdlaWdodD86IHN0cmluZztcbiAgICBmb250U3R5bGU/OiBzdHJpbmc7XG4gICAgb3B0aW9ucz86IEZvbnRQcmVsb2FkT3B0aW9ucztcbiAgfT5cbik6IFByb21pc2U8Rm9udFByZWxvYWRSZXN1bHRbXT4gPT4ge1xuICByZXR1cm4gZGVmYXVsdEZvbnRQcmVsb2FkZXIucHJlbG9hZEZvbnRCYXRjaChmb250cyk7XG59O1xuXG5leHBvcnQgY29uc3QgcHJlbG9hZEZvbnRzV2l0aFByb2dyZXNzID0gKFxuICBmb250czogQXJyYXk8e1xuICAgIGZvbnRGYW1pbHk6IHN0cmluZztcbiAgICBmb250U3JjOiBzdHJpbmc7XG4gICAgZm9udFdlaWdodD86IHN0cmluZztcbiAgICBmb250U3R5bGU/OiBzdHJpbmc7XG4gICAgb3B0aW9ucz86IEZvbnRQcmVsb2FkT3B0aW9ucztcbiAgfT4sXG4gIG9uUHJvZ3Jlc3M6IChsb2FkZWQ6IG51bWJlciwgdG90YWw6IG51bWJlcikgPT4gdm9pZFxuKTogUHJvbWlzZTxGb250UHJlbG9hZFJlc3VsdFtdPiA9PiB7XG4gIHJldHVybiBkZWZhdWx0Rm9udFByZWxvYWRlci5wcmVsb2FkRm9udHNXaXRoUHJvZ3Jlc3MoZm9udHMsIG9uUHJvZ3Jlc3MpO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldENhY2hlZEZvbnQgPSAoXG4gIGZvbnRGYW1pbHk6IHN0cmluZyxcbiAgZm9udFdlaWdodD86IHN0cmluZyxcbiAgZm9udFN0eWxlPzogc3RyaW5nXG4pOiBGb250RmFjZSB8IG51bGwgPT4ge1xuICByZXR1cm4gZGVmYXVsdEZvbnRQcmVsb2FkZXIuZ2V0RnJvbUNhY2hlKGZvbnRGYW1pbHksIGZvbnRXZWlnaHQsIGZvbnRTdHlsZSk7XG59O1xuXG5leHBvcnQgY29uc3QgcmVtb3ZlQ2FjaGVkRm9udCA9IChcbiAgZm9udEZhbWlseTogc3RyaW5nLFxuICBmb250V2VpZ2h0Pzogc3RyaW5nLFxuICBmb250U3R5bGU/OiBzdHJpbmdcbik6IGJvb2xlYW4gPT4ge1xuICByZXR1cm4gZGVmYXVsdEZvbnRQcmVsb2FkZXIucmVtb3ZlRnJvbUNhY2hlKGZvbnRGYW1pbHksIGZvbnRXZWlnaHQsIGZvbnRTdHlsZSk7XG59O1xuXG5leHBvcnQgY29uc3QgY2xlYXJGb250Q2FjaGUgPSAoKTogdm9pZCA9PiB7XG4gIGRlZmF1bHRGb250UHJlbG9hZGVyLmNsZWFyQ2FjaGUoKTtcbn07XG5cbmV4cG9ydCBjb25zdCBjbGVhckV4cGlyZWRGb250Q2FjaGUgPSAoKTogdm9pZCA9PiB7XG4gIGRlZmF1bHRGb250UHJlbG9hZGVyLmNsZWFyRXhwaXJlZENhY2hlKCk7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0Rm9udFByZWxvYWRlclN0YXRzID0gKCkgPT4ge1xuICByZXR1cm4gZGVmYXVsdEZvbnRQcmVsb2FkZXIuZ2V0U3RhdHMoKTtcbn07XG5cbmV4cG9ydCBjb25zdCBwcmVsb2FkQ3JpdGljYWxGb250cyA9IChcbiAgZm9udHM6IEFycmF5PHtcbiAgICBmb250RmFtaWx5OiBzdHJpbmc7XG4gICAgZm9udFNyYzogc3RyaW5nO1xuICAgIGZvbnRXZWlnaHQ/OiBzdHJpbmc7XG4gICAgZm9udFN0eWxlPzogc3RyaW5nO1xuICB9PixcbiAgb3B0aW9ucz86IEZvbnRQcmVsb2FkT3B0aW9uc1xuKTogUHJvbWlzZTxGb250UHJlbG9hZFJlc3VsdFtdPiA9PiB7XG4gIHJldHVybiBwcmVsb2FkRm9udEJhdGNoKFxuICAgIGZvbnRzLm1hcCgoZm9udCkgPT4gKHtcbiAgICAgIC4uLmZvbnQsXG4gICAgICBvcHRpb25zOiB7IC4uLm9wdGlvbnMsIHRpbWVvdXQ6IDUwMDAgfSxcbiAgICB9KSlcbiAgKTtcbn07XG5cbmV4cG9ydCBjb25zdCBwcmVsb2FkVmlld3BvcnRGb250cyA9IChcbiAgZm9udHM6IEFycmF5PHtcbiAgICBmb250RmFtaWx5OiBzdHJpbmc7XG4gICAgZm9udFNyYzogc3RyaW5nO1xuICAgIGZvbnRXZWlnaHQ/OiBzdHJpbmc7XG4gICAgZm9udFN0eWxlPzogc3RyaW5nO1xuICB9PixcbiAgb3B0aW9ucz86IEZvbnRQcmVsb2FkT3B0aW9uc1xuKTogUHJvbWlzZTxGb250UHJlbG9hZFJlc3VsdFtdPiA9PiB7XG4gIHJldHVybiBwcmVsb2FkRm9udEJhdGNoKFxuICAgIGZvbnRzLm1hcCgoZm9udCkgPT4gKHtcbiAgICAgIC4uLmZvbnQsXG4gICAgICBvcHRpb25zOiB7IC4uLm9wdGlvbnMsIHRpbWVvdXQ6IDEwMDAwIH0sXG4gICAgfSkpXG4gICk7XG59O1xuXG5leHBvcnQgY29uc3QgcHJlbG9hZEJlbG93Rm9sZEZvbnRzID0gKFxuICBmb250czogQXJyYXk8e1xuICAgIGZvbnRGYW1pbHk6IHN0cmluZztcbiAgICBmb250U3JjOiBzdHJpbmc7XG4gICAgZm9udFdlaWdodD86IHN0cmluZztcbiAgICBmb250U3R5bGU/OiBzdHJpbmc7XG4gIH0+LFxuICBvcHRpb25zPzogRm9udFByZWxvYWRPcHRpb25zXG4pOiBQcm9taXNlPEZvbnRQcmVsb2FkUmVzdWx0W10+ID0+IHtcbiAgcmV0dXJuIHByZWxvYWRGb250QmF0Y2goXG4gICAgZm9udHMubWFwKChmb250KSA9PiAoe1xuICAgICAgLi4uZm9udCxcbiAgICAgIG9wdGlvbnM6IHsgLi4ub3B0aW9ucywgdGltZW91dDogMTUwMDAgfSxcbiAgICB9KSlcbiAgKTtcbn07XG5cbmV4cG9ydCBjb25zdCBpc0ZvbnRMb2FkZWQgPSAoZm9udEZhbWlseTogc3RyaW5nKTogYm9vbGVhbiA9PiB7XG4gIHJldHVybiBkb2N1bWVudC5mb250cy5jaGVjayhgMTZweCAke2ZvbnRGYW1pbHl9YCk7XG59O1xuXG5leHBvcnQgY29uc3Qgd2FpdEZvckZvbnRMb2FkID0gKGZvbnRGYW1pbHk6IHN0cmluZywgdGltZW91dDogbnVtYmVyID0gMTAwMDApOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgaWYgKGlzRm9udExvYWRlZChmb250RmFtaWx5KSkge1xuICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjaGVja0ludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgaWYgKGlzRm9udExvYWRlZChmb250RmFtaWx5KSkge1xuICAgICAgICBjbGVhckludGVydmFsKGNoZWNrSW50ZXJ2YWwpO1xuICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgfVxuICAgIH0sIDEwMCk7XG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNsZWFySW50ZXJ2YWwoY2hlY2tJbnRlcnZhbCk7XG4gICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICB9LCB0aW1lb3V0KTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0QXZhaWxhYmxlRm9udHMgPSAoKTogc3RyaW5nW10gPT4ge1xuICBjb25zdCBmb250cyA9IGRvY3VtZW50LmZvbnRzLnZhbHVlcygpO1xuICBjb25zdCBmb250RmFtaWxpZXMgPSBuZXcgU2V0PHN0cmluZz4oKTtcblxuICBmb3IgKGNvbnN0IGZvbnQgb2YgZm9udHMpIHtcbiAgICBmb250RmFtaWxpZXMuYWRkKGZvbnQuZmFtaWx5KTtcbiAgfVxuXG4gIHJldHVybiBBcnJheS5mcm9tKGZvbnRGYW1pbGllcyk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gIEZvbnRQcmVsb2FkZXIsXG4gIGNyZWF0ZUZvbnRQcmVsb2FkZXIsXG4gIGRlZmF1bHRGb250UHJlbG9hZGVyLFxuICBwcmVsb2FkRm9udCxcbiAgcHJlbG9hZEZvbnRCYXRjaCxcbiAgcHJlbG9hZEZvbnRzV2l0aFByb2dyZXNzLFxuICBnZXRDYWNoZWRGb250LFxuICByZW1vdmVDYWNoZWRGb250LFxuICBjbGVhckZvbnRDYWNoZSxcbiAgY2xlYXJFeHBpcmVkRm9udENhY2hlLFxuICBnZXRGb250UHJlbG9hZGVyU3RhdHMsXG4gIHByZWxvYWRDcml0aWNhbEZvbnRzLFxuICBwcmVsb2FkVmlld3BvcnRGb250cyxcbiAgcHJlbG9hZEJlbG93Rm9sZEZvbnRzLFxuICBpc0ZvbnRMb2FkZWQsXG4gIHdhaXRGb3JGb250TG9hZCxcbiAgZ2V0QXZhaWxhYmxlRm9udHMsXG59O1xuIl0sInZlcnNpb24iOjN9