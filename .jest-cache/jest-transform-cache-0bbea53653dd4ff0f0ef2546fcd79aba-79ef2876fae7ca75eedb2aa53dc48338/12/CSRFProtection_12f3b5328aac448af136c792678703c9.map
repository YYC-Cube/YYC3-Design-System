{"file":"/Users/yanyu/Downloads/yyc3-Design-System/src/security/CSRFProtection.tsx","mappings":"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","names":[],"sources":["/Users/yanyu/Downloads/yyc3-Design-System/src/security/CSRFProtection.tsx"],"sourcesContent":["/**\n * @file CSRF 防护模块\n * @description 提供跨站请求伪造防护功能\n * @module security/CSRFProtection\n * @author YYC³\n * @version 1.0.0\n * @created 2026-02-19\n */\n\nimport React, { createContext, useContext, useState, useCallback, useEffect, useRef } from 'react';\n\ntype CSRFRequestBody = string | Document | Blob | ArrayBuffer | FormData | URLSearchParams | null;\n\nexport interface CSRFToken {\n  value: string;\n  expires: number;\n  headerName: string;\n  parameterName: string;\n}\n\nexport interface CSRFConfig {\n  tokenName?: string;\n  headerName?: string;\n  parameterName?: string;\n  tokenLength?: number;\n  expirationTime?: number;\n  storageType?: 'memory' | 'session' | 'local' | 'cookie';\n  regenerateOnLoad?: boolean;\n  doubleSubmitCookie?: boolean;\n  requireSamesite?: 'strict' | 'lax' | 'none';\n  requireSecure?: boolean;\n  allowMethodOverride?: string[];\n  ignorePaths?: string[];\n  customValidator?: (token: string) => boolean;\n  onTokenExpiry?: () => void;\n  onValidationError?: (error: CSRFValidationError) => void;\n}\n\nexport interface CSRFValidationError {\n  type: 'missing_token' | 'invalid_token' | 'expired_token' | 'mismatch';\n  token?: string;\n  expected?: string;\n  message: string;\n  timestamp: number;\n}\n\nexport interface RequestConfig {\n  method?: string;\n  headers?: Record<string, string>;\n  body?: BodyInit | null;\n  cache?: RequestCache;\n  credentials?: RequestCredentials;\n  mode?: RequestMode;\n  redirect?: RequestRedirect;\n  referrer?: string;\n  referrerPolicy?: ReferrerPolicy;\n  integrity?: string;\n  keepalive?: boolean;\n  signal?: AbortSignal | null;\n}\n\ntype BodyInit =\n  | Blob\n  | ArrayBuffer\n  | ArrayBufferView\n  | FormData\n  | URLSearchParams\n  | ReadableStream<Uint8Array>\n  | string;\ntype RequestCache =\n  | 'default'\n  | 'force-cache'\n  | 'no-cache'\n  | 'no-store'\n  | 'only-if-cached'\n  | 'reload';\ntype RequestCredentials = 'include' | 'omit' | 'same-origin';\ntype RequestMode = 'cors' | 'navigate' | 'no-cors' | 'same-origin';\ntype RequestRedirect = 'error' | 'follow' | 'manual';\ntype ReferrerPolicy =\n  | ''\n  | 'no-referrer'\n  | 'no-referrer-when-downgrade'\n  | 'origin'\n  | 'origin-when-cross-origin'\n  | 'same-origin'\n  | 'strict-origin'\n  | 'strict-origin-when-cross-origin'\n  | 'unsafe-url';\n\nexport interface CSRFContextType {\n  token: string | null;\n  generateToken: () => Promise<string>;\n  validateToken: (token: string) => boolean;\n  refreshTokens: () => void;\n  clearTokens: () => void;\n  addToRequest: (request: RequestConfig) => RequestConfig;\n  addToForm: (form: HTMLFormElement) => void;\n  addToURL: (url: string) => string;\n  config: CSRFConfig;\n}\n\nconst CSRFContext = createContext<CSRFContextType | undefined>(undefined);\n\nconst DEFAULT_CONFIG: CSRFConfig = {\n  tokenName: 'csrf-token',\n  headerName: 'X-CSRF-Token',\n  parameterName: 'csrf_token',\n  tokenLength: 32,\n  expirationTime: 3600000,\n  storageType: 'memory',\n  regenerateOnLoad: true,\n  doubleSubmitCookie: true,\n  requireSamesite: 'strict',\n  requireSecure: true,\n  allowMethodOverride: ['GET', 'HEAD', 'OPTIONS', 'TRACE'],\n  ignorePaths: [],\n};\n\nconst generateRandomToken = (length: number = 32): string => {\n  const array = new Uint8Array(length);\n  crypto.getRandomValues(array);\n  return Array.from(array, (byte) => byte.toString(16).padStart(2, '0')).join('');\n};\n\nexport const CSRFProvider: React.FC<{\n  children: React.ReactNode;\n  config?: Partial<CSRFConfig>;\n  serverEndpoint?: string;\n}> = ({ children, config = {}, serverEndpoint }) => {\n  const currentConfig = useRef<CSRFConfig>({ ...DEFAULT_CONFIG, ...config });\n  const [token, setToken] = useState<string | null>(null);\n  const [tokens, setTokens] = useState<Map<string, CSRFToken>>(new Map());\n  const tokenRef = useRef<string | null>(null);\n\n  const generateToken = useCallback(async (): Promise<string> => {\n    if (serverEndpoint) {\n      try {\n        const response = await fetch(serverEndpoint, {\n          method: 'POST',\n          credentials: 'include',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        });\n\n        if (response.ok) {\n          const data = await response.json();\n          const newToken = data.token || data.csrf_token;\n          setToken(newToken);\n          tokenRef.current = newToken;\n          return newToken;\n        }\n      } catch (error) {\n        console.error('Failed to fetch CSRF token from server:', error);\n      }\n    }\n\n    const newToken = generateRandomToken(currentConfig.current.tokenLength);\n    const expires = Date.now() + currentConfig.current.expirationTime!;\n\n    setToken(newToken);\n    tokenRef.current = newToken;\n\n    const tokenData: CSRFToken = {\n      value: newToken,\n      expires,\n      headerName: currentConfig.current.headerName!,\n      parameterName: currentConfig.current.parameterName!,\n    };\n\n    setTokens((prev) => new Map(prev).set(newToken, tokenData));\n\n    return newToken;\n  }, [serverEndpoint]);\n\n  const validateToken = useCallback(\n    (inputToken: string): boolean => {\n      if (!inputToken) {\n        const error: CSRFValidationError = {\n          type: 'missing_token',\n          message: 'CSRF token is missing',\n          timestamp: Date.now(),\n        };\n        currentConfig.current.onValidationError?.(error);\n        return false;\n      }\n\n      const tokenData = tokens.get(inputToken);\n\n      if (!tokenData) {\n        const error: CSRFValidationError = {\n          type: 'invalid_token',\n          token: inputToken,\n          message: 'CSRF token is invalid',\n          timestamp: Date.now(),\n        };\n        currentConfig.current.onValidationError?.(error);\n        return false;\n      }\n\n      if (Date.now() > tokenData.expires) {\n        const error: CSRFValidationError = {\n          type: 'expired_token',\n          token: inputToken,\n          message: 'CSRF token has expired',\n          timestamp: Date.now(),\n        };\n        currentConfig.current.onValidationError?.(error);\n        currentConfig.current.onTokenExpiry?.();\n        return false;\n      }\n\n      if (tokenData.value !== inputToken) {\n        const error: CSRFValidationError = {\n          type: 'mismatch',\n          token: inputToken,\n          expected: tokenData.value,\n          message: 'CSRF token does not match',\n          timestamp: Date.now(),\n        };\n        currentConfig.current.onValidationError?.(error);\n        return false;\n      }\n\n      if (currentConfig.current.customValidator) {\n        return currentConfig.current.customValidator(inputToken);\n      }\n\n      return true;\n    },\n    [tokens]\n  );\n\n  const refreshTokens = useCallback(() => {\n    generateToken();\n  }, [generateToken]);\n\n  const clearTokens = useCallback(() => {\n    setToken(null);\n    tokenRef.current = null;\n    setTokens(new Map());\n  }, []);\n\n  const addToRequest = useCallback(\n    (request: RequestConfig): RequestConfig => {\n      const currentToken = tokenRef.current || token;\n      if (!currentToken) return request;\n\n      return {\n        ...request,\n        headers: {\n          ...request.headers,\n          [currentConfig.current.headerName!]: currentToken,\n        },\n      };\n    },\n    [token]\n  );\n\n  const addToForm = useCallback(\n    (form: HTMLFormElement): void => {\n      const currentToken = tokenRef.current || token;\n      if (!currentToken) return;\n\n      let input = form.querySelector(\n        `input[name=\"${currentConfig.current.parameterName}\"]`\n      ) as HTMLInputElement;\n\n      if (!input) {\n        input = document.createElement('input');\n        input.type = 'hidden';\n        input.name = currentConfig.current.parameterName!;\n        form.appendChild(input);\n      }\n\n      input.value = currentToken;\n    },\n    [token]\n  );\n\n  const addToURL = useCallback(\n    (url: string): string => {\n      const currentToken = tokenRef.current || token;\n      if (!currentToken) return url;\n\n      try {\n        const urlObj = new URL(url, window.location.origin);\n        urlObj.searchParams.set(currentConfig.current.parameterName!, currentToken);\n        return urlObj.toString();\n      } catch {\n        return url;\n      }\n    },\n    [token]\n  );\n\n  const contextValue: CSRFContextType = {\n    token,\n    generateToken,\n    validateToken,\n    refreshTokens,\n    clearTokens,\n    addToRequest,\n    addToForm,\n    addToURL,\n    config: currentConfig.current,\n  };\n\n  useEffect(() => {\n    if (currentConfig.current.regenerateOnLoad) {\n      generateToken();\n    }\n  }, [generateToken]);\n\n  useEffect(() => {\n    if (currentConfig.current.storageType === 'session') {\n      sessionStorage.setItem(currentConfig.current.tokenName!, token || '');\n    } else if (currentConfig.current.storageType === 'local') {\n      localStorage.setItem(currentConfig.current.tokenName!, token || '');\n    }\n  }, [token]);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const now = Date.now();\n      let needsRefresh = false;\n\n      tokens.forEach((tokenData, tokenKey) => {\n        if (now > tokenData.expires) {\n          setTokens((prev) => {\n            const next = new Map(prev);\n            next.delete(tokenKey);\n            return next;\n          });\n          needsRefresh = true;\n        }\n      });\n\n      if (needsRefresh) {\n        generateToken();\n      }\n    }, currentConfig.current.expirationTime! / 2);\n\n    return () => clearInterval(interval);\n  }, [tokens, generateToken]);\n\n  return <CSRFContext.Provider value={contextValue}>{children}</CSRFContext.Provider>;\n};\n\nexport const useCSRF = (): CSRFContextType => {\n  const context = useContext(CSRFContext);\n  if (!context) {\n    throw new Error('useCSRF must be used within a CSRFProvider');\n  }\n  return context;\n};\n\nexport const CSRFProtectedForm: React.FC<\n  {\n    children: React.ReactNode;\n    onSubmit: (e: React.FormEvent<HTMLFormElement>) => void;\n    method?: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n    action?: string;\n    className?: string;\n  } & React.FormHTMLAttributes<HTMLFormElement>\n> = ({ children, onSubmit, method = 'POST', action, className, ...props }) => {\n  const { addToForm } = useCSRF();\n  const formRef = useRef<HTMLFormElement>(null);\n\n  useEffect(() => {\n    if (formRef.current) {\n      addToForm(formRef.current);\n    }\n  }, [addToForm]);\n\n  const handleSubmit = useCallback(\n    (e: React.FormEvent<HTMLFormElement>) => {\n      e.preventDefault();\n      onSubmit(e);\n    },\n    [onSubmit]\n  );\n\n  return (\n    <form\n      ref={formRef}\n      method={method}\n      action={action}\n      onSubmit={handleSubmit}\n      className={className}\n      {...props}\n    >\n      {children}\n    </form>\n  );\n};\n\nexport const CSRFProtectedFetch = async (\n  url: string,\n  options: RequestConfig = {},\n  csrfContext: CSRFContextType\n): Promise<Response> => {\n  const protectedOptions = csrfContext.addToRequest(options);\n  return fetch(url, protectedOptions as RequestInit);\n};\n\nexport const withCSRFProtection = <P extends object>(\n  Component: React.ComponentType<P>,\n  config?: Partial<CSRFConfig>\n) => {\n  const WrappedComponent = (props: P) => (\n    <CSRFProvider config={config}>\n      <Component {...props} />\n    </CSRFProvider>\n  );\n\n  WrappedComponent.displayName = `withCSRFProtection(${Component.displayName || Component.name})`;\n  return WrappedComponent;\n};\n\nexport const createCSRFMiddleware = (csrfContext: CSRFContextType) => {\n  return {\n    fetch: (url: string, options?: RequestConfig): Promise<Response> => {\n      return CSRFProtectedFetch(url, options || {}, csrfContext);\n    },\n    XMLHttpRequest: () => {\n      const xhr = new XMLHttpRequest();\n      const originalOpen = xhr.open.bind(xhr);\n      const originalSetRequestHeader = xhr.setRequestHeader.bind(xhr);\n\n      xhr.open = function (\n        method: string,\n        url: string | URL,\n        async?: boolean,\n        user?: string | null,\n        password?: string | null\n      ) {\n        let urlStr: string;\n        if (typeof url === 'string') {\n          urlStr = url;\n        } else {\n          urlStr = url.toString();\n        }\n        return originalOpen(method, urlStr, async ?? true, user ?? null, password ?? null);\n      };\n\n      xhr.setRequestHeader = function (name: string, value: string) {\n        return originalSetRequestHeader(name, value);\n      };\n\n      const originalSend = xhr.send.bind(xhr);\n      xhr.send = function (body?: CSRFRequestBody) {\n        const token = csrfContext.token;\n        if (token) {\n          this.setRequestHeader(csrfContext.config.headerName!, token);\n        }\n        return originalSend(body ?? null);\n      };\n\n      return xhr;\n    },\n  };\n};\n\nexport const validateCSRFToken = (\n  request: Request,\n  token: string | null,\n  config: CSRFConfig\n): boolean => {\n  const method = request.method.toUpperCase();\n  const safeMethods = ['GET', 'HEAD', 'OPTIONS', 'TRACE'];\n\n  if (safeMethods.includes(method)) {\n    return true;\n  }\n\n  if (!token) {\n    return false;\n  }\n\n  const headerToken = request.headers.get(config.headerName!);\n  const url = new URL(request.url);\n  const paramToken = url.searchParams.get(config.parameterName!);\n\n  return headerToken === token || paramToken === token;\n};\n\nexport const createStrictConfig = (): Partial<CSRFConfig> => ({\n  tokenLength: 64,\n  expirationTime: 1800000,\n  requireSamesite: 'strict',\n  requireSecure: true,\n  doubleSubmitCookie: true,\n  regenerateOnLoad: true,\n  storageType: 'session',\n});\n\nexport const createModerateConfig = (): Partial<CSRFConfig> => ({\n  tokenLength: 32,\n  expirationTime: 3600000,\n  requireSamesite: 'lax',\n  requireSecure: true,\n  doubleSubmitCookie: true,\n  regenerateOnLoad: false,\n  storageType: 'memory',\n});\n\nexport const createPermissiveConfig = (): Partial<CSRFConfig> => ({\n  tokenLength: 16,\n  expirationTime: 7200000,\n  requireSamesite: 'lax',\n  requireSecure: false,\n  doubleSubmitCookie: false,\n  regenerateOnLoad: false,\n  storageType: 'local',\n});\n\nexport default {\n  CSRFProvider,\n  useCSRF,\n  CSRFProtectedForm,\n  CSRFProtectedFetch,\n  withCSRFProtection,\n  createCSRFMiddleware,\n  validateCSRFToken,\n  createStrictConfig,\n  createModerateConfig,\n  createPermissiveConfig,\n};\n"],"version":3}