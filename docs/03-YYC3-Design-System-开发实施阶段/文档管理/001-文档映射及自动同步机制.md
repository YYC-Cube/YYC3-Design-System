# YYC³ Design System 文档映射及自动同步机制

> ***YanYuCloudCube***
> *言启象限 | 语枢未来*
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> *万象归元于云枢 | 深栈智启新纪元*
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

**创建日期**: 2026-02-23
**版本**: 1.0.0
**作者**: YYC³ Team

---

## 概述

YYC³ Design System文档映射及自动同步机制提供了一套完整的文档管理解决方案，包括文档元数据管理、依赖关系追踪、版本控制和自动同步功能。

---

## 核心功能

### 1. 文档映射管理

- 文档元数据管理
- 依赖关系追踪
- 版本控制
- 分类和标签管理

### 2. 自动同步机制

- 定时同步
- Git集成
- 事件驱动同步
- 冲突解决

### 3. 文档统计

- 文档数量统计
- 分类统计
- 状态统计
- 依赖分析

---

## 文档映射结构

### 文档元数据

```typescript
interface DocumentMetadata {
  id: string;              // 文档唯一标识
  path: string;            // 文档路径
  type: string;            // 文档类型
  status: 'draft' | 'published' | 'archived';  // 文档状态
  version: string;          // 文档版本
  lastModified: string;     // 最后修改时间
  dependencies: string[];   // 依赖的文档ID列表
  tags: string[];          // 标签列表
  category: string;         // 分类
}
```

### 文档映射配置

```typescript
interface DocumentMap {
  version: string;         // 映射版本
  lastUpdated: string;     // 最后更新时间
  documents: DocumentMetadata[];  // 文档列表
  syncRules: SyncRules;    // 同步规则
  notificationRules: NotificationRules;  // 通知规则
  versionControl: VersionControl;  // 版本控制配置
}
```

---

## 使用指南

### 1. 初始化文档映射

```typescript
import { documentMapper } from './core/DocumentMapper';

// 扫描文档目录
documentMapper.scanDocuments('docs');

// 获取所有文档
const documents = documentMapper.getDocuments();

// 获取统计信息
const stats = documentMapper.getStatistics();
console.log(stats);
```

### 2. 添加文档

```typescript
const metadata = {
  id: 'doc-014',
  path: 'docs/guide/getting-started.md',
  type: 'guide',
  status: 'published',
  version: '1.0.0',
  lastModified: new Date().toISOString(),
  dependencies: ['doc-001'],
  tags: ['guide', 'getting-started'],
  category: 'user-guide',
};

documentMapper.addDocument(metadata);
```

### 3. 更新文档

```typescript
documentMapper.updateDocument('doc-014', {
  status: 'published',
  version: '1.1.0',
  tags: ['guide', 'getting-started', 'updated'],
});
```

### 4. 查询文档

```typescript
// 按类型查询
const guides = documentMapper.getDocuments({ type: 'guide' });

// 按状态查询
const published = documentMapper.getDocuments({ status: 'published' });

// 按标签查询
const tagged = documentMapper.getDocuments({ tags: ['guide'] });

// 按分类查询
const userGuides = documentMapper.getDocuments({ category: 'user-guide' });
```

### 5. 依赖关系管理

```typescript
// 获取文档的依赖
const dependencies = documentMapper.getDependencies('doc-014');

// 获取依赖此文档的其他文档
const dependents = documentMapper.getDependents('doc-014');

// 验证依赖关系
const validation = documentMapper.validateDependencies('doc-014');
console.log(validation.valid);  // 是否有效
console.log(validation.missing);  // 缺失的依赖
```

---

## 自动同步配置

### 1. 同步规则

```typescript
const syncRules = {
  autoSync: true,           // 自动同步
  syncInterval: 3600000,    // 同步间隔（毫秒）
  syncOnCommit: true,        // 提交时同步
  syncOnPush: true,          // 推送时同步
  syncOnPull: true,          // 拉取时同步
  excludePatterns: [         // 排除模式
    'node_modules/**',
    'dist/**',
    'build/**',
    '.git/**',
    '*.log',
  ],
};
```

### 2. 同步配置

```typescript
import { documentSyncer } from './core/DocumentSyncer';

const syncConfig = {
  source: './docs',
  destination: './public/docs',
  includePatterns: ['*.md', '**/*.md'],
  excludePatterns: ['node_modules/**', 'dist/**'],
  dryRun: false,
  verbose: true,
};

// 执行同步
const result = await documentSyncer.sync(syncConfig);
console.log(documentSyncer.generateReport(result));
```

### 3. Git集成

```typescript
// 同步到Git
const gitResult = await documentSyncer.syncToGit(syncConfig);

// 从Git同步
const pullResult = await documentSyncer.syncFromGit(syncConfig);
```

### 4. 自动同步

```typescript
// 启动自动同步
documentSyncer.startAutoSync(syncConfig);

// 停止自动同步
documentSyncer.stopAutoSync();
```

---

## 事件监听

### 同步事件

```typescript
documentSyncer.on('sync.started', (event) => {
  console.log('Sync started:', event.data);
});

documentSyncer.on('sync.completed', (event) => {
  console.log('Sync completed:', event.data.result);
});

documentSyncer.on('sync.failed', (event) => {
  console.error('Sync failed:', event.data.error);
});

documentSyncer.on('file.created', (event) => {
  console.log('File created:', event.data.file);
});

documentSyncer.on('file.updated', (event) => {
  console.log('File updated:', event.data.file);
});

documentSyncer.on('file.deleted', (event) => {
  console.log('File deleted:', event.data.file);
});

documentSyncer.on('file.skipped', (event) => {
  console.log('File skipped:', event.data.file, event.data.reason);
});
```

---

## 版本控制

### 语义化版本

```typescript
// 增加主版本号（不兼容的API更改）
documentMapper.incrementVersion('major');

// 增加次版本号（向后兼容的功能添加）
documentMapper.incrementVersion('minor');

// 增加补丁版本号（向后兼容的问题修复）
documentMapper.incrementVersion('patch');

// 获取当前版本
const version = documentMapper.getVersion();
console.log(version);  // "1.4.0"
```

---

## 文档映射文件

### 位置

```
docs/.docmap.json
```

### 结构

```json
{
  "version": "1.0.0",
  "lastUpdated": "2026-02-23T00:00:00Z",
  "documents": [
    {
      "id": "doc-001",
      "path": "README.md",
      "type": "readme",
      "status": "published",
      "version": "1.4.0",
      "lastModified": "2026-02-23T00:00:00Z",
      "dependencies": [],
      "tags": ["overview", "getting-started"],
      "category": "documentation"
    }
  ],
  "syncRules": {
    "autoSync": true,
    "syncInterval": 3600000,
    "syncOnCommit": true,
    "syncOnPush": true,
    "syncOnPull": true,
    "excludePatterns": [
      "node_modules/**",
      "dist/**",
      "build/**",
      ".git/**",
      "*.log"
    ]
  },
  "notificationRules": {
    "enabled": true,
    "channels": ["email", "slack"],
    "events": [
      "document.created",
      "document.updated",
      "document.deleted",
      "sync.started",
      "sync.completed",
      "sync.failed"
    ]
  },
  "versionControl": {
    "enabled": true,
    "strategy": "semantic",
    "autoIncrement": true,
    "preRelease": false
  }
}
```

---

## 最佳实践

### 1. 文档命名

- 使用有意义的ID：`doc-001`, `doc-002`
- 使用描述性路径：`docs/guide/getting-started.md`
- 使用一致的类型：`guide`, `reference`, `api`, `tutorial`

### 2. 依赖管理

- 明确声明文档依赖
- 避免循环依赖
- 定期验证依赖关系

### 3. 版本控制

- 遵循语义化版本规范
- 在重大更改时增加主版本号
- 在功能添加时增加次版本号
- 在问题修复时增加补丁版本号

### 4. 同步策略

- 使用自动同步减少手动操作
- 配置合理的同步间隔
- 使用排除模式避免不必要的同步
- 在CI/CD中集成同步流程

---

## 故障排除

### 常见问题

#### 1. 文档映射文件丢失

```bash
# 重新扫描文档目录
node -e "const { documentMapper } = require('./dist/core/DocumentMapper'); documentMapper.scanDocuments();"
```

#### 2. 同步失败

```typescript
// 检查同步配置
console.log(syncConfig);

// 启用详细日志
syncConfig.verbose = true;

// 使用dry-run模式测试
syncConfig.dryRun = true;
```

#### 3. 依赖验证失败

```typescript
// 检查缺失的依赖
const validation = documentMapper.validateDependencies('doc-014');
console.log('Missing dependencies:', validation.missing);

// 添加缺失的依赖
validation.missing.forEach(depId => {
  console.log(`Add document: ${depId}`);
});
```

---

## API参考

### DocumentMapper

| 方法 | 参数 | 返回值 | 描述 |
|------|------|--------|------|
| addDocument | metadata: DocumentMetadata | void | 添加或更新文档 |
| removeDocument | documentId: string | void | 删除文档 |
| getDocument | documentId: string | DocumentMetadata \| undefined | 获取文档 |
| getDocuments | filter?: Partial\<DocumentMetadata\> | DocumentMetadata[] | 获取文档列表 |
| updateDocument | documentId: string, updates: Partial\<DocumentMetadata\> | void | 更新文档 |
| getDependencies | documentId: string | DocumentMetadata[] | 获取依赖 |
| getDependents | documentId: string | DocumentMetadata[] | 获取依赖者 |
| validateDependencies | documentId: string | { valid: boolean, missing: string[] } | 验证依赖 |
| scanDocuments | directory?: string | void | 扫描文档目录 |
| getVersion | - | string | 获取版本号 |
| incrementVersion | type?: 'major' \| 'minor' \| 'patch' | void | 增加版本号 |
| getStatistics | - | Statistics | 获取统计信息 |

### DocumentSyncer

| 方法 | 参数 | 返回值 | 描述 |
|------|------|--------|------|
| sync | config: SyncConfig | Promise\<SyncResult\> | 执行同步 |
| syncToGit | config: SyncConfig | Promise\<SyncResult\> | 同步到Git |
| syncFromGit | config: SyncConfig | Promise\<SyncResult\> | 从Git同步 |
| startAutoSync | config: SyncConfig | void | 启动自动同步 |
| stopAutoSync | - | void | 停止自动同步 |
| on | event: string, callback: Function | void | 监听事件 |
| off | event: string, callback: Function | void | 取消监听 |
| generateReport | result: SyncResult | string | 生成报告 |

---

## 参考资源

- [YYC³ Design System文档](https://yyc3.dev/docs)
- [文档映射规范](https://yyc3.dev/docs/document-mapping)
- [同步机制指南](https://yyc3.dev/docs/sync-mechanism)

---

## 支持

如有问题，请联系：

- 邮箱：docs@yyc3.dev
- 论坛：https://yyc3.dev/community
- GitHub Issues：https://github.com/YYC-Cube/YYC3-Design-System/issues

---

<div align="center">

> 「***YanYuCloudCube***」
> 「***<admin@0379.email>***」
> 「***Words Initiate Quadrants, Language Serves as Core for the Future***」
> 「***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***」

</div>
