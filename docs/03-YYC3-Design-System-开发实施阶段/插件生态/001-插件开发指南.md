# YYC³ Design System 插件开发指南

> ***YanYuCloudCube***
> *言启象限 | 语枢未来*
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> *万象归元于云枢 | 深栈智启新纪元*
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

**创建日期**: 2026-02-23
**版本**: 1.0.0
**作者**: YYC³ Team

---

## 概述

YYC³ Design System插件系统允许开发者扩展设计系统的功能，添加自定义组件、主题、设计令牌等。本文档将指导您如何开发、测试和发布插件。

---

## 插件结构

### 基本结构

```
my-yyc3-plugin/
├── package.json              # 插件清单
├── src/
│   ├── index.ts             # 插件入口
│   ├── components/           # 自定义组件
│   ├── themes/              # 自定义主题
│   └── tokens/              # 自定义设计令牌
├── dist/                   # 编译输出
└── README.md                # 插件文档
```

---

## 插件清单 (package.json)

### 必需字段

```json
{
  "name": "@yyc3/my-plugin",
  "version": "1.0.0",
  "description": "我的YYC³插件",
  "author": "Your Name",
  "license": "MIT",
  "yyc3": {
    "minVersion": "1.4.0",
    "apiVersion": "1.0.0"
  }
}
```

### 可选字段

```json
{
  "homepage": "https://github.com/yourname/my-plugin",
  "repository": {
    "type": "git",
    "url": "https://github.com/yourname/my-plugin.git"
  },
  "keywords": ["yyc3", "plugin", "design-system"],
  "icon": "path/to/icon.png",
  "screenshots": [
    "path/to/screenshot1.png",
    "path/to/screenshot2.png"
  ],
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "dependencies": {
    "react": "^18.0.0"
  },
  "peerDependencies": {
    "yyc3-design-system": "^1.4.0"
  },
  "devDependencies": {
    "typescript": "^5.0.0",
    "@yyc3/plugin-types": "^1.0.0"
  }
}
```

### YYC³特定字段

| 字段 | 类型 | 必需 | 描述 |
|------|------|------|------|
| minVersion | string | 否 | 最低支持的YYC³版本 |
| maxVersion | string | 否 | 最高支持的YYC³版本 |
| apiVersion | string | 否 | 使用的API版本 |
| hooks | object | 否 | 插件生命周期钩子 |

---

## 插件生命周期

### 生命周期钩子

插件可以定义以下生命周期钩子：

| 钩子 | 参数 | 描述 | 返回值 |
|------|------|------|--------|
| onInstall | context | 插件安装时调用 | void \| Promise<void> |
| onActivate | context | 插件激活时调用 | void \| Promise<void> |
| onDeactivate | context | 插件停用时调用 | void \| Promise<void> |
| onUninstall | context | 插件卸载时调用 | void \| Promise<void> |
| onConfigChange | config | 配置更改时调用 | void \| Promise<void> |
| onThemeChange | theme | 主题更改时调用 | void \| Promise<void> |
| onLanguageChange | language | 语言更改时调用 | void \| Promise<void> |

### 上下文对象

```typescript
interface PluginContext {
  pluginId: string;              // 插件ID
  pluginVersion: string;          // 插件版本
  appVersion: string;             // YYC³版本
  config: PluginConfig;           // 插件配置
  api: PluginAPI;                // 插件API
  logger: PluginLogger;            // 日志记录器
  hooks: PluginHooks;            // 插件钩子
}
```

---

## 插件API

### 组件API

#### 注册组件

```typescript
context.api.registerComponent({
  id: 'my-component',
  name: '我的组件',
  component: MyComponent,
  category: 'ui',
  tags: ['custom', 'advanced'],
  icon: 'icon.png',
  description: '我的自定义组件',
});
```

#### 取消注册组件

```typescript
context.api.unregisterComponent('my-component');
```

#### 获取所有组件

```typescript
const components = context.api.getComponents();
```

---

### 主题API

#### 注册主题

```typescript
context.api.registerTheme({
  id: 'my-theme',
  name: '我的主题',
  theme: {
    'color.primary': '#ff0000',
    'color.background': '#ffffff',
    // ... 其他设计令牌
  },
  preview: 'preview.png',
  category: 'custom',
  tags: ['dark', 'modern'],
});
```

#### 取消注册主题

```typescript
context.api.unregisterTheme('my-theme');
```

#### 获取所有主题

```typescript
const themes = context.api.getThemes();
```

---

### 设计令牌API

#### 注册设计令牌

```typescript
context.api.registerToken({
  id: 'my-token',
  name: '我的令牌',
  token: {
    'spacing.small': '4px',
    'spacing.medium': '8px',
    // ... 其他令牌
  },
  category: 'spacing',
  tags: ['custom'],
});
```

#### 取消注册设计令牌

```typescript
context.api.unregisterToken('my-token');
```

#### 获取所有设计令牌

```typescript
const tokens = context.api.getTokens();
```

---

### 事件API

#### 发送事件

```typescript
context.api.emitEvent({
  type: 'my-event',
  source: 'my-plugin',
  timestamp: Date.now(),
  data: { message: 'Hello from plugin!' },
});
```

#### 监听事件

```typescript
context.api.onEvent('my-event', (data) => {
  console.log('Received event:', data);
});
```

#### 取消监听事件

```typescript
const callback = (data) => console.log(data);
context.api.onEvent('my-event', callback);

context.api.offEvent('my-event', callback);
```

---

## 日志API

```typescript
context.logger.debug('Debug message');
context.logger.info('Info message');
context.logger.warn('Warning message');
context.logger.error('Error message', error);
```

---

## 插件开发示例

### 示例1：简单组件插件

```typescript
import { PluginContext } from '@yyc3/plugin-types';

export default function myPlugin(context: PluginContext) {
  context.api.registerComponent({
    id: 'hello-world',
    name: 'Hello World',
    component: () => (
      <div style={{ padding: '20px', background: '#f0f0f0' }}>
        <h1>Hello from my plugin!</h1>
      </div>
    ),
    category: 'ui',
    description: '一个简单的Hello World组件',
  });

  context.logger.info('Hello World plugin activated');
}
```

### 示例2：主题插件

```typescript
import { PluginContext } from '@yyc3/plugin-types';

export default function themePlugin(context: PluginContext) {
  context.api.registerTheme({
    id: 'my-dark-theme',
    name: '我的深色主题',
    theme: {
      'color.primary': '#d45a5f',
      'color.background': '#1a1a1a',
      'color.text.primary': '#ffffff',
      'color.text.secondary': '#cccccc',
    },
    preview: 'dark-theme-preview.png',
    category: 'theme',
    tags: ['dark', 'custom'],
  });

  context.logger.info('Theme plugin activated');
}
```

### 示例3：使用钩子

```typescript
import { PluginContext } from '@yyc3/plugin-types';

export default function hookPlugin(context: PluginContext) {
  context.api.onEvent('theme:change', (data) => {
    context.logger.info('Theme changed to:', data.theme);
  });

  context.logger.info('Hook plugin activated');
}
```

---

## 插件配置

### 配置存储

插件配置存储在localStorage中，键名为`yyc3-plugin-config-{pluginId}`。

### 配置结构

```typescript
interface PluginConfig {
  enabled: boolean;              // 插件是否启用
  settings: Record<string, any>;   // 插件设置
  permissions: string[];           // 插件权限
}
```

### 读取配置

```typescript
const config = context.config;
console.log('Plugin enabled:', config.enabled);
console.log('Plugin settings:', config.settings);
```

### 监听配置变化

```typescript
export default function myPlugin(context: PluginContext) {
  const onConfigChange = async (newConfig: PluginConfig) => {
    context.logger.info('Config changed:', newConfig);
  };

  return {
    ...plugin,
    hooks: {
      onConfigChange,
    },
  };
}
```

---

## 插件测试

### 单元测试

```typescript
import { render, screen } from '@testing-library/react';
import myPlugin from './index';

describe('myPlugin', () => {
  it('应该注册组件', () => {
    const mockContext = createMockContext();
    myPlugin(mockContext);

    const components = mockContext.api.getComponents();
    expect(components).toHaveLength(1);
    expect(components[0].id).toBe('hello-world');
  });
});
```

### 集成测试

```typescript
describe('Plugin Integration', () => {
  it('应该与YYC³集成', () => {
    const pluginManager = new PluginManager();
    await pluginManager.install(manifest);
    await pluginManager.activate('my-plugin');

    const components = pluginManager.getComponents();
    expect(components).toContainEqual(
      expect.objectContaining({ id: 'hello-world' })
    );
  });
});
```

---

## 插件打包

### 构建配置

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "moduleResolution": "node",
    "declaration": true,
    "outDir": "./dist",
    "rootDir": "./src"
  }
}
```

### 打包命令

```bash
npm run build
```

### 输出文件

- `dist/index.js` - 插件主文件
- `dist/index.d.ts` - TypeScript类型定义

---

## 插件发布

### 发布到npm

```bash
npm publish
```

### 发布到YYC³插件市场

1. 在YYC³插件市场注册账号
2. 上传插件包
3. 填写插件信息
4. 提交审核

---

## 最佳实践

### 1. 命名规范

- 插件ID使用kebab-case：`my-awesome-plugin`
- 组件ID使用kebab-case：`my-awesome-component`
- 主题ID使用kebab-case：`my-awesome-theme`
- 令牌ID使用kebab-case：`my-awesome-token`

### 2. 版本管理

- 遵循语义化版本：`1.0.0`
- 主版本：不兼容的API更改
- 次版本：向后兼容的功能添加
- 补丁版本：向后兼容的问题修复

### 3. 性能优化

- 使用React.memo优化组件
- 避免不必要的重渲染
- 使用useCallback和useMemo
- 懒加载大型组件

### 4. 错误处理

- 使用try-catch包裹异步操作
- 提供有意义的错误消息
- 使用context.logger记录错误
- 实现优雅降级

### 5. 文档完善

- 提供清晰的README
- 添加使用示例
- 说明API接口
- 提供故障排除指南

### 6. 测试覆盖

- 单元测试覆盖率>80%
- 集成测试覆盖关键流程
- E2E测试覆盖用户场景
- 性能测试验证优化效果

---

## 常见问题

### Q: 插件无法激活？

A: 检查以下几点：
1. YYC³版本是否满足minVersion要求
2. 插件是否已安装
3. 查看浏览器控制台错误信息

### Q: 组件无法显示？

A: 确认以下几点：
1. 组件是否正确注册
2. 组件ID是否唯一
3. 查看context.logger日志

### Q: 主题无法应用？

A: 检查以下几点：
1. 主题是否正确注册
2. 设计令牌格式是否正确
3. 查看浏览器控制台错误信息

### Q: 如何调试插件？

A: 使用以下方法：
1. 使用context.logger.debug输出调试信息
2. 使用浏览器开发者工具
3. 使用React DevTools检查组件状态

---

## 参考资源

- [YYC³ Design System文档](https://yyc3.dev/docs)
- [插件API参考](https://yyc3.dev/docs/plugin-api)
- [插件市场](https://yyc3.dev/plugins)
- [社区论坛](https://yyc3.dev/community)

---

## 支持

如有问题，请联系：

- 邮箱：plugins@yyc3.dev
- 论坛：https://yyc3.dev/community
- GitHub Issues：https://github.com/YYC-Cube/YYC3-Design-System/issues

---

<div align="center">

> 「***YanYuCloudCube***」
> 「***<admin@0379.email>***」
> 「***Words Initiate Quadrants, Language Serves as Core for the Future***」
> 「***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***」

</div>
